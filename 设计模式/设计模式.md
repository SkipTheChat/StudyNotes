>  é‡ç‚¹æŒæ¡ï¼šé€‚é…å™¨æ¨¡å¼ï¼Œè£…é¥°æ¨¡å¼ï¼Œè§‚å¯Ÿè€…æ¨¡å¼ï¼Œå•ä¾‹æ¨¡å¼ï¼Œå·¥å‚æ¨¡å¼ï¼Œç­–ç•¥æ¨¡å¼ï¼Œæ¨¡æ¿æ¨¡å¼ï¼Œä»£ç†æ¨¡å¼

[æ¨èåšå®¢](https://www.cnblogs.com/WindSun/category/1376525.html)



# ğŸƒ åˆ›å»ºå‹

## 1 å•ä¾‹æ¨¡å¼ï¼ˆSingletonï¼‰

å•ä¾‹æ¨¡å¼æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š  

1. å•ä¾‹ç±»åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹ã€‚  
2. å•ä¾‹ç±»å¿…é¡»è‡ªå·±åˆ›å»ºè‡ªå·±çš„å”¯ä¸€å®ä¾‹ã€‚  
3. å•ä¾‹ç±»å¿…é¡»ç»™æ‰€æœ‰å…¶ä»–å¯¹è±¡æä¾›è¿™ä¸€å®ä¾‹ã€‚ 



é€‚ç”¨åœºæ™¯ï¼š

åœ¨è®¡ç®—æœºç³»ç»Ÿä¸­ï¼Œçº¿ç¨‹æ± ã€ç¼“å­˜ã€æ—¥å¿—å¯¹è±¡ã€å¯¹è¯æ¡†ã€æ‰“å°æœºã€æ˜¾å¡çš„é©±åŠ¨ç¨‹åºå¯¹è±¡å¸¸è¢«è®¾è®¡æˆå•ä¾‹ã€‚è¿™äº›åº”ç”¨éƒ½æˆ–å¤šæˆ–å°‘å…·æœ‰èµ„æºç®¡ç†å™¨çš„åŠŸèƒ½ã€‚



### 

### 1.1 æ‡’æ±‰å¼

#### 1.1.1 çº¿ç¨‹ä¸å®‰å…¨

ä»¥ä¸‹å®ç°ä¸­ï¼Œç§æœ‰é™æ€å˜é‡ singleè¢«å»¶è¿Ÿå®ä¾‹åŒ–ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œå¦‚æœæ²¡æœ‰ç”¨åˆ°è¯¥ç±»ï¼Œé‚£ä¹ˆå°±ä¸ä¼šå®ä¾‹åŒ– singleï¼Œä»è€ŒèŠ‚çº¦èµ„æºã€‚

è¿™ä¸ªå®ç°åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ˜¯ä¸å®‰å…¨çš„ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹èƒ½å¤ŸåŒæ—¶è¿›å…¥ `if (single== null)` ï¼Œå¹¶ä¸”æ­¤æ—¶ singleä¸º nullï¼Œé‚£ä¹ˆä¼šæœ‰å¤šä¸ªçº¿ç¨‹æ‰§è¡Œ `single= new Singleton();` è¯­å¥ï¼Œè¿™å°†å¯¼è‡´å®ä¾‹åŒ–å¤šæ¬¡ Singletonã€‚

```java
public class Singleton {
    private static Singleton single=null;
    private Singleton() {}
    //é™æ€å·¥å‚æ–¹æ³• 
    public static Singleton getInstance() {
         if (single == null) {  
             single = new Singleton();
         }  
        return single;
    }
}
```



#### 1.1.2 synchronized-çº¿ç¨‹å®‰å…¨

ä½†æ˜¯å½“ä¸€ä¸ªçº¿ç¨‹è¿›å…¥è¯¥æ–¹æ³•ä¹‹åï¼Œå…¶å®ƒè¯•å›¾è¿›å…¥è¯¥æ–¹æ³•çš„çº¿ç¨‹éƒ½å¿…é¡»ç­‰å¾…ï¼Œå³ä½¿ singleå·²ç»è¢«å®ä¾‹åŒ–äº†ã€‚è¿™ä¼šè®©çº¿ç¨‹é˜»å¡æ—¶é—´è¿‡é•¿ï¼Œå› æ­¤è¯¥æ–¹æ³•æœ‰æ€§èƒ½é—®é¢˜ï¼Œä¸æ¨èä½¿ç”¨ã€‚

```java
public class Singleton {
    private Singleton() {}
    private static Singleton single=null;
    //é™æ€å·¥å‚æ–¹æ³• 
    public static synchronized Singleton getInstance() {
         if (single == null) {  
             single = new Singleton();
         }  
        return single;
    }
}
```



#### 1.1.3 åŒé‡æ ¡éªŒé”-çº¿ç¨‹å®‰å…¨

singleåªéœ€è¦è¢«å®ä¾‹åŒ–ä¸€æ¬¡ï¼Œä¹‹åå°±å¯ä»¥ç›´æ¥ä½¿ç”¨äº†ã€‚åŠ é”æ“ä½œåªéœ€è¦å¯¹å®ä¾‹åŒ–é‚£éƒ¨åˆ†çš„ä»£ç è¿›è¡Œï¼Œåªæœ‰å½“ singleæ²¡æœ‰è¢«å®ä¾‹åŒ–æ—¶ï¼Œæ‰éœ€è¦è¿›è¡ŒåŠ é”ã€‚

åŒé‡æ ¡éªŒé”å…ˆåˆ¤æ–­ singleæ˜¯å¦å·²ç»è¢«å®ä¾‹åŒ–ï¼Œå¦‚æœæ²¡æœ‰è¢«å®ä¾‹åŒ–ï¼Œé‚£ä¹ˆæ‰å¯¹å®ä¾‹åŒ–è¯­å¥è¿›è¡ŒåŠ é”ã€‚

```java
 public class Singleton {
    private volatile static Singleton single=null;
    private Singleton() {}
     
   public static Singleton getInstance() {
        if (single == null) {  
            synchronized (Singleton.class) {  
               if (single == null) {  
                  single = new Singleton(); 
               }  
            }  
        }  
        return single; 
    }
}
```



è€ƒè™‘ä¸‹é¢çš„å®ç°ï¼Œä¹Ÿå°±æ˜¯åªä½¿ç”¨äº†ä¸€ä¸ª if è¯­å¥ã€‚åœ¨ single== null çš„æƒ…å†µä¸‹ï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹éƒ½æ‰§è¡Œäº† if è¯­å¥ï¼Œé‚£ä¹ˆä¸¤ä¸ªçº¿ç¨‹éƒ½ä¼šè¿›å…¥ if è¯­å¥å—å†…ã€‚è™½ç„¶åœ¨ if è¯­å¥å—å†…æœ‰åŠ é”æ“ä½œï¼Œä½†æ˜¯ä¸¤ä¸ªçº¿ç¨‹éƒ½ä¼šæ‰§è¡Œ `single= new Singleton();` è¿™æ¡è¯­å¥ï¼Œåªæ˜¯å…ˆåçš„é—®é¢˜ï¼Œé‚£ä¹ˆå°±ä¼šè¿›è¡Œä¸¤æ¬¡å®ä¾‹åŒ–ã€‚å› æ­¤å¿…é¡»ä½¿ç”¨åŒé‡æ ¡éªŒé”ï¼Œä¹Ÿå°±æ˜¯éœ€è¦ä½¿ç”¨ä¸¤ä¸ª if è¯­å¥ï¼šç¬¬ä¸€ä¸ª if è¯­å¥ç”¨æ¥é¿å… singleå·²ç»è¢«å®ä¾‹åŒ–ä¹‹åçš„åŠ é”æ“ä½œï¼Œè€Œç¬¬äºŒä¸ª if è¯­å¥è¿›è¡Œäº†åŠ é”ï¼Œæ‰€ä»¥åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ï¼Œå°±ä¸ä¼šå‡ºç° single== null æ—¶ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œå®ä¾‹åŒ–æ“ä½œã€‚

```java
if (single == null) {
    synchronized (Singleton.class) {
        single = new Singleton();
    }
}
```



singleé‡‡ç”¨ **volatile** å…³é”®å­—ä¿®é¥°ä¹Ÿæ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œ `single= new Singleton();` è¿™æ®µä»£ç å…¶å®æ˜¯åˆ†ä¸ºä¸‰æ­¥æ‰§è¡Œï¼š

1. ä¸º singleåˆ†é…å†…å­˜ç©ºé—´
2. åˆå§‹åŒ– single
3. å°† singleæŒ‡å‘åˆ†é…çš„å†…å­˜åœ°å€

ä½†æ˜¯ç”±äº JVM å…·æœ‰æŒ‡ä»¤é‡æ’çš„ç‰¹æ€§ï¼Œæ‰§è¡Œé¡ºåºæœ‰å¯èƒ½å˜æˆ 1>3>2ã€‚æŒ‡ä»¤é‡æ’åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹ä¸ä¼šå‡ºç°é—®é¢˜ï¼Œä½†æ˜¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¼šå¯¼è‡´ä¸€ä¸ªçº¿ç¨‹è·å¾—è¿˜æ²¡æœ‰åˆå§‹åŒ–çš„å®ä¾‹ã€‚ä¾‹å¦‚ï¼Œçº¿ç¨‹ T1 æ‰§è¡Œäº† 1 å’Œ 3ï¼Œæ­¤æ—¶ T2 è°ƒç”¨ getInstance() åå‘ç° singleä¸ä¸ºç©ºï¼Œå› æ­¤è¿”å› singleï¼Œä½†æ­¤æ—¶ singleè¿˜æœªè¢«åˆå§‹åŒ–ã€‚

**ä½¿ç”¨ volatile å¯ä»¥ç¦æ­¢ JVM çš„æŒ‡ä»¤é‡æ’ï¼Œä¿è¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¹Ÿèƒ½æ­£å¸¸è¿è¡Œã€‚**





#### 1.1.4 é™æ€å†…éƒ¨ç±»å®ç°

å½“ Singleton ç±»è¢«åŠ è½½æ—¶ï¼Œé™æ€å†…éƒ¨ç±» LazyHolderæ²¡æœ‰è¢«åŠ è½½è¿›å†…å­˜ã€‚åªæœ‰å½“è°ƒç”¨ `getInstance()` æ–¹æ³•ä»è€Œè§¦å‘ `LazyHolder.INSTANCE` æ—¶ LazyHolder æ‰ä¼šè¢«åŠ è½½ï¼Œæ­¤æ—¶åˆå§‹åŒ– INSTANCE å®ä¾‹ï¼Œå¹¶ä¸” JVM èƒ½ç¡®ä¿ INSTANCE åªè¢«å®ä¾‹åŒ–ä¸€æ¬¡ã€‚

è¿™ç§æ–¹å¼ä¸ä»…å…·æœ‰å»¶è¿Ÿåˆå§‹åŒ–çš„å¥½å¤„ï¼Œè€Œä¸”ç”± JVM æä¾›äº†å¯¹çº¿ç¨‹å®‰å…¨çš„æ”¯æŒã€‚

>è¿™ç§æ¯”ä¸Šé¢sychronizedå’ŒåŒé‡æ£€ç´¢é”æ–¹æ³•éƒ½å¥½ä¸€äº›ï¼Œæ—¢å®ç°äº†çº¿ç¨‹å®‰å…¨ï¼Œåˆé¿å…äº†åŒæ­¥å¸¦æ¥çš„æ€§èƒ½å½±å“ã€‚ 

```java
public class Singleton {  
    private static class LazyHolder {  
       private static final Singleton INSTANCE = new Singleton();  
    }  
    private Singleton (){}  
    public static final Singleton getInstance() {  
       return LazyHolder.INSTANCE;  
    }  
}  
```

#### 



### 1.2 é¥¿æ±‰å¼-çº¿ç¨‹å®‰å…¨

çº¿ç¨‹ä¸å®‰å…¨é—®é¢˜ä¸»è¦æ˜¯ç”±äº singleè¢«å®ä¾‹åŒ–å¤šæ¬¡ï¼Œé‡‡å–ç›´æ¥å®ä¾‹åŒ– single çš„æ–¹å¼å°±ä¸ä¼šäº§ç”Ÿçº¿ç¨‹ä¸å®‰å…¨é—®é¢˜ã€‚

ä½†æ˜¯ç›´æ¥å®ä¾‹åŒ–çš„æ–¹å¼ä¹Ÿä¸¢å¤±äº†å»¶è¿Ÿå®ä¾‹åŒ–å¸¦æ¥çš„èŠ‚çº¦èµ„æºçš„å¥½å¤„ã€‚

```java
//é¥¿æ±‰å¼å•ä¾‹ç±».åœ¨ç±»åˆå§‹åŒ–æ—¶ï¼Œå·²ç»è‡ªè¡Œå®ä¾‹åŒ– 
public class Singleton1 {
    private Singleton1() {}
    private static final Singleton1 single = new Singleton1();
    //é™æ€å·¥å‚æ–¹æ³• 
    public static Singleton1 getInstance() {
        return single;
    }
}
```





### 1.3 æšä¸¾å®ç°å•ä¾‹

```java
public enum Singleton {

    INSTANCE;

    public void doSomething() {
        System.out.println("doSomething");
    }

}
```

```java
public class Main {
    public static void main(String[] args) {
        //è°ƒç”¨æ–¹æ³•
        Singleton.INSTANCE.doSomething();
    }

}
```

**è¯¥å®ç°å¯ä»¥é˜²æ­¢åå°„æ”»å‡»ã€‚æšä¸¾æ˜¯finalä¿®é¥°çš„ã€‚**





## 2 å·¥å‚æ¨¡å¼

  å·¥å‚æ¨¡å¼ä¸»è¦æ˜¯ä¸ºåˆ›å»ºå¯¹è±¡æä¾›è¿‡æ¸¡æ¥å£ï¼Œä»¥ä¾¿å°†åˆ›å»ºå¯¹è±¡çš„å…·ä½“è¿‡ç¨‹å±è”½éš”ç¦»èµ·æ¥ï¼Œè¾¾åˆ°æé«˜çµæ´»æ€§çš„ç›®çš„ã€‚ 
å·¥å‚æ¨¡å¼å¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼š 

1. ç®€å•å·¥å‚æ¨¡å¼ï¼ˆSimple Factoryï¼‰ 

2. å·¥å‚æ–¹æ³•æ¨¡å¼ï¼ˆFactory Methodï¼‰ 
3. æŠ½è±¡å·¥å‚æ¨¡å¼ï¼ˆAbstract Factoryï¼‰ 

è¿™ä¸‰ç§æ¨¡å¼ä»ä¸Šåˆ°ä¸‹é€æ­¥æŠ½è±¡ï¼Œå¹¶ä¸”æ›´å…·ä¸€èˆ¬æ€§ã€‚ 
GOFåœ¨ã€Šè®¾è®¡æ¨¡å¼ã€‹ä¸€ä¹¦ä¸­å°†å·¥å‚æ¨¡å¼åˆ†ä¸ºä¸¤ç±»ï¼šå·¥å‚æ–¹æ³•æ¨¡å¼ä¸æŠ½è±¡å·¥å‚æ¨¡å¼

å°†ç®€å•å·¥å‚æ¨¡å¼çœ‹ä¸ºå·¥å‚æ–¹æ³•æ¨¡å¼çš„ä¸€ç§ç‰¹ä¾‹ï¼Œä¸¤è€…å½’ä¸ºä¸€ç±»ã€‚ 



**åŒºåˆ« ï¼š**

* å·¥å‚æ–¹æ³•æ¨¡å¼ï¼š

  ä¸€ä¸ªæŠ½è±¡äº§å“ç±»ï¼Œå¯ä»¥æ´¾ç”Ÿå‡ºå¤šä¸ªå…·ä½“äº§å“ç±»ã€‚   
  ä¸€ä¸ªæŠ½è±¡å·¥å‚ç±»ï¼Œå¯ä»¥æ´¾ç”Ÿå‡ºå¤šä¸ªå…·ä½“å·¥å‚ç±»ã€‚   
  æ¯ä¸ªå…·ä½“å·¥å‚ç±»åªèƒ½åˆ›å»ºä¸€ä¸ªå…·ä½“äº§å“ç±»çš„å®ä¾‹ã€‚

* æŠ½è±¡å·¥å‚æ¨¡å¼ï¼š

  å¤šä¸ªæŠ½è±¡äº§å“ç±»ï¼Œæ¯ä¸ªæŠ½è±¡äº§å“ç±»å¯ä»¥æ´¾ç”Ÿå‡ºå¤šä¸ªå…·ä½“äº§å“ç±»ã€‚   
  ä¸€ä¸ªæŠ½è±¡å·¥å‚ç±»ï¼Œå¯ä»¥æ´¾ç”Ÿå‡ºå¤šä¸ªå…·ä½“å·¥å‚ç±»ã€‚   
  æ¯ä¸ªå…·ä½“å·¥å‚ç±»å¯ä»¥åˆ›å»ºå¤šä¸ªå…·ä½“äº§å“ç±»çš„å®ä¾‹ã€‚   





### 2.1 ç®€å•å·¥å‚æ¨¡å¼

### intent

ç®€å•å·¥å‚æŠŠå®ä¾‹åŒ–çš„æ“ä½œå•ç‹¬æ”¾åˆ°ä¸€ä¸ªç±»ä¸­ï¼Œè¿™ä¸ªç±»å°±æˆä¸ºç®€å•å·¥å‚ç±»ï¼Œè®©ç®€å•å·¥å‚ç±»æ¥å†³å®šåº”è¯¥ç”¨å“ªä¸ªå…·ä½“å­ç±»æ¥å®ä¾‹åŒ–ã€‚

### Class Diagram

![](./assets/1.1.png)



### Implementation

äº§å“ç±»ï¼š 

```java
abstract class BMW {
	public BMW(){
		
	}
}
```

```java
public class BMW320 extends BMW {
	public BMW320() {
		System.out.println("åˆ¶é€ -->BMW320");
	}
}
public class BMW523 extends BMW{
	public BMW523(){
		System.out.println("åˆ¶é€ -->BMW523");
	}
}
```



å·¥å‚ç±»ï¼š 

```java
public class Factory {
	public BMW createBMW(int type) {
		switch (type) {
		
		case 320:
			return new BMW320();
 
		case 523:
			return new BMW523();
 
		default:
			break;
		}
		return null;
	}
}
```

å®¢æˆ·ç±»ï¼š 

```java
public class Customer {
	public static void main(String[] args) {
		Factory factory = new Factory();
		BMW bmw320 = factory.createBMW(320);
		BMW bmw523 = factory.createBMW(523);
	}
}
```



### 2.2 å·¥å‚æ–¹æ³•æ¨¡å¼

### intent

å®šä¹‰äº†ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„å·¥å‚æ¥å£ï¼Œå·¥å‚æ¥å®ä¾‹åŒ–å¯¹è±¡ï¼Œä½†ç”±å­ç±»å†³å®šè¦å®ä¾‹åŒ–å“ªä¸ªç±»ã€‚å·¥å‚æ–¹æ³•æŠŠå®ä¾‹åŒ–æ“ä½œæ¨è¿Ÿåˆ°å­ç±»ã€‚

ä¸ç®€å•å·¥å‚ä¸åŒï¼Œè¿™é‡Œç»™å·¥å‚å®šä¹‰äº†ä¸€ä¸ªæ¥å£ï¼Œå¹¶ä¸”å®šä¹‰äº†å¤šä¸ªä¸åŒå·¥å‚ï¼Œæ¯ä¸ªå·¥å‚è´Ÿè´£ä¸€æ¬¾äº§å“ã€‚



### Class Diagram



![](./assets/1.2.png)



### Implementation

 äº§å“ç±»ï¼š 

```java
abstract class BMW {
	public BMW(){
		
	}
}
```

```java
public class BMW320 extends BMW {
	public BMW320() {
		System.out.println("åˆ¶é€ -->BMW320");
	}
}
public class BMW523 extends BMW{
	public BMW523(){
		System.out.println("åˆ¶é€ -->BMW523");
	}
}
```

  

åˆ›å»ºå·¥å‚ç±»ï¼š 

```java
interface FactoryBMW {
	BMW createBMW();
}
```



```java
public class FactoryBMW320 implements FactoryBMW{
 
	@Override
	public BMW320 createBMW() {
 
		return new BMW320();
	}
 
}
public class FactoryBMW523 implements FactoryBMW {
	@Override
	public BMW523 createBMW() {
 
		return new BMW523();
	}
}
```

å®¢æˆ·ç±»ï¼š 

```java
public class Customer {
	public static void main(String[] args) {
		FactoryBMW320 factoryBMW320 = new FactoryBMW320();
		BMW320 bmw320 = factoryBMW320.createBMW();
 
		FactoryBMW523 factoryBMW523 = new FactoryBMW523();
		BMW523 bmw523 = factoryBMW523.createBMW();
	}
}
```



### 2.3 æŠ½è±¡å·¥å‚æ¨¡å¼ 

### intent

æŠ½è±¡å·¥å‚æ¨¡å¼åˆ›å»ºçš„æ˜¯å¯¹è±¡å®¶æ—ï¼Œä¹Ÿå°±æ˜¯å¾ˆå¤šå¯¹è±¡è€Œä¸æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸”è¿™äº›å¯¹è±¡æ˜¯ç›¸å…³çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¿…é¡»ä¸€èµ·åˆ›å»ºå‡ºæ¥ã€‚è€Œå·¥å‚æ–¹æ³•æ¨¡å¼åªæ˜¯ç”¨äºåˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œè¿™å’ŒæŠ½è±¡å·¥å‚æ¨¡å¼æœ‰å¾ˆå¤§ä¸åŒã€‚

ä½†æ˜¯åœ¨æ•´ä½“åˆ›å»ºæ¨¡å¼ä¸Šï¼Œç¬¦åˆå·¥å‚æ–¹æ³•æ¨¡å¼çš„å®šä¹‰ã€‚



### Class Diagram

![](./assets/1.3.png)

### Implementation

äº§å“ç±»ï¼š 

```java
//å‘åŠ¨æœºä»¥åŠå‹å·  
public interface Engine {  
 
}  
public class EngineA extends Engine{  
    public EngineA(){  
        System.out.println("åˆ¶é€ -->EngineA");  
    }  
}  
public class EngineBextends Engine{  
    public EngineB(){  
        System.out.println("åˆ¶é€ -->EngineB");  
    }  
}  
 
//ç©ºè°ƒä»¥åŠå‹å·  
public interface Aircondition {  
 
}  
public class AirconditionA extends Aircondition{  
    public AirconditionA(){  
        System.out.println("åˆ¶é€ -->AirconditionA");  
    }  
}  
public class AirconditionB extends Aircondition{  
    public AirconditionB(){  
        System.out.println("åˆ¶é€ -->AirconditionB");  
    }  
} 
```



 åˆ›å»ºå·¥å‚ç±»ï¼š 

```java
//åˆ›å»ºå·¥å‚çš„æ¥å£  
public interface AbstractFactory {  
    //åˆ¶é€ å‘åŠ¨æœº
    public Engine createEngine();
    //åˆ¶é€ ç©ºè°ƒ 
    public Aircondition createAircondition(); 
}  
 
 
//ä¸ºå®é©¬320ç³»åˆ—ç”Ÿäº§é…ä»¶  
public class FactoryBMW320 implements AbstractFactory{  
      
    @Override  
    public Engine createEngine() {    
        return new EngineA();  
    }  
    @Override  
    public Aircondition createAircondition() {  
        return new AirconditionA();  
    }  
}  
//å®é©¬523ç³»åˆ—
public class FactoryBMW523 implements AbstractFactory {  
  
     @Override  
    public Engine createEngine() {    
        return new EngineB();  
    }  
    @Override  
    public Aircondition createAircondition() {  
        return new AirconditionB();  
    }  
 
 
} 
```

å®¢æˆ·: 

```java
public class Customer {  
    public static void main(String[] args){  
        //ç”Ÿäº§å®é©¬320ç³»åˆ—é…ä»¶
        FactoryBMW320 factoryBMW320 = new FactoryBMW320();  
        factoryBMW320.createEngine();
        factoryBMW320.createAircondition();
          
        //ç”Ÿäº§å®é©¬523ç³»åˆ—é…ä»¶  
        FactoryBMW523 factoryBMW523 = new FactoryBMW523();  
        factoryBMW320.createEngine();
        factoryBMW320.createAircondition();
    }  
}
```





## 3 ç”Ÿæˆå™¨/å»ºé€ è€…æ¨¡å¼ï¼ˆBuilderï¼‰

### intent

åˆ›å»ºè€…æ¨¡å¼åˆå«å»ºé€ è€…æ¨¡å¼ï¼Œæ˜¯å°†ä¸€ä¸ªå¤æ‚çš„å¯¹è±¡çš„**æ„å»º**ä¸å®ƒçš„**è¡¨ç¤º**åˆ†ç¦»ï¼Œä½¿å¾—åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºã€‚åˆ›å»ºè€…æ¨¡å¼éšè—äº†å¤æ‚å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ï¼Œå®ƒæŠŠå¤æ‚å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹åŠ ä»¥æŠ½è±¡ï¼Œé€šè¿‡å­ç±»ç»§æ‰¿æˆ–è€…é‡è½½çš„æ–¹å¼ï¼ŒåŠ¨æ€çš„åˆ›å»ºå…·æœ‰å¤åˆå±æ€§çš„å¯¹è±¡ã€‚



### Class Diagram



![](./assets/1.4.png)



 **å»ºé€ è€…æ¨¡å¼ä¸»è¦æ¶‰åŠå‡ ä¸ªè§’è‰²ï¼š**

ã€€1. æŒ‡æŒ¥è€…ï¼ˆDirectorï¼‰ï¼Œè´Ÿè´£å’Œå®¢æˆ·ï¼ˆClientï¼‰å¯¹è¯

ã€€2. ä¹‹åæŒ‡æŒ¥è€…å°†å®¢æˆ·çš„äº§å“éœ€æ±‚åˆ’åˆ†ä¸ºæ¯”è¾ƒç¨³å®šçš„å»ºé€ è¿‡ç¨‹ï¼ˆAbstractBuilderï¼‰

ã€€3. æŒ‡æŒ¥è€…æŒ‡æŒ¥å…·ä½“çš„å»ºé€ è€…ï¼ˆConcreteBuilderï¼‰å¹²æ´»

ã€€4. è·å–å»ºé€ è€…å»ºé€ çš„äº§å“ç»™å®¢æˆ·



[æ¨èç¤ºä¾‹](https://blog.csdn.net/u010102390/article/details/80179754)



### Implementation

å®ç°ç®€æ˜“StringBuilder

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€æ˜“çš„ StringBuilder å®ç°ï¼Œå‚è€ƒäº† JDK 1.8 æºç ã€‚

å»ºé€ è€…ï¼š

```java
public class AbstractStringBuilder {
    protected char[] value;

    protected int count;

    public AbstractStringBuilder(int capacity) {
        count = 0;
        value = new char[capacity];
    }

    public AbstractStringBuilder append(char c) {
        ensureCapacityInternal(count + 1);
        value[count++] = c;
        return this;
    }

    private void ensureCapacityInternal(int minimumCapacity) {
        // overflow-conscious code
        if (minimumCapacity - value.length > 0)
            expandCapacity(minimumCapacity);
    }

    void expandCapacity(int minimumCapacity) {
        int newCapacity = value.length * 2 + 2;
        if (newCapacity - minimumCapacity < 0)
            newCapacity = minimumCapacity;
        if (newCapacity < 0) {
            if (minimumCapacity < 0) // overflow
                throw new OutOfMemoryError();
            newCapacity = Integer.MAX_VALUE;
        }
        value = Arrays.copyOf(value, newCapacity);
    }
}
```



æŒ‡æŒ¥è€…ï¼š

```java
public class StringBuilder extends AbstractStringBuilder {
    public StringBuilder() {
        super(16);
    }

    @Override
    public String toString() {
        // Create a copy, don't share the array
        return new String(value, 0, count);
    }
}
```



```java
public class Client {
    public static void main(String[] args) {
        StringBuilder sb = new StringBuilder();
        final int count = 26;
        for (int i = 0; i < count; i++) {
            sb.append((char) ('a' + i));
        }
        System.out.println(sb.toString());
    }
}
```

```html
abcdefghijklmnopqrstuvwxyz
```





## 4  åŸå‹æ¨¡å¼ï¼ˆPrototypeï¼‰

### intent

ä½¿ç”¨åŸå‹å®ä¾‹æŒ‡å®šè¦åˆ›å»ºå¯¹è±¡çš„ç±»å‹ï¼Œé€šè¿‡å¤åˆ¶è¿™ä¸ªåŸå‹æ¥åˆ›å»ºæ–°å¯¹è±¡ã€‚

### Class Diagram

![](./assets/1.5.png)



### Implementation

```java
public abstract class Prototype {
    abstract Prototype myClone();
}
```

```java
public class ConcretePrototype extends Prototype {

    private String filed;

    public ConcretePrototype(String filed) {
        this.filed = filed;
    }

    @Override
    Prototype myClone() {
        return new ConcretePrototype(filed);
    }

    @Override
    public String toString() {
        return filed;
    }
}
```

```java
public class Client {
    public static void main(String[] args) {
        Prototype prototype = new ConcretePrototype("abc");
        Prototype clone = prototype.myClone();
        //prototype!=clone,ä»–ä»¬æ˜¯ä¸¤ä¸ªä¸åŒçš„å¯¹è±¡ï¼Œåªæ˜¯å†…å®¹ä¸€æ ·ã€‚
    }
}
```



### JDK

- [java.lang.Object#clone()](http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#clone%28%29)



# :christmas_tree: è¡Œä¸ºå‹

## 1 è´£ä»»é“¾æ¨¡å¼

### intent

ä½¿å¤šä¸ªå¯¹è±¡éƒ½æœ‰æœºä¼šå¤„ç†è¯·æ±‚ï¼Œä»è€Œé¿å…è¯·æ±‚çš„å‘é€è€…å’Œæ¥æ”¶è€…ä¹‹é—´çš„è€¦åˆå…³ç³»ã€‚å°†è¿™äº›å¯¹è±¡è¿æˆä¸€æ¡é“¾ï¼Œå¹¶æ²¿ç€è¿™æ¡é“¾å‘é€è¯¥è¯·æ±‚ï¼Œç›´åˆ°æœ‰ä¸€ä¸ªå¯¹è±¡å¤„ç†å®ƒä¸ºæ­¢ã€‚

### Class Diagram

![](./assets/1.6.png)



[æ¨èä»£ç ](https://www.cnblogs.com/fengyumeng/p/10839570.html)

### Implementation

Handle:è´Ÿè´£åˆ¤æ–­successorï¼ˆè¯·æ±‚ï¼‰çš„ç±»å‹ï¼Œç„¶åè°ƒç”¨åˆé€‚çš„æ–¹æ³•ã€‚

ä¹Ÿå°±æ˜¯è´Ÿè´£è¯·æ±‚è½¬å‘

```java
public abstract class Handler {

    protected Handler successor;


    public Handler(Handler successor) {
        this.successor = successor;
    }


    protected abstract void handleRequest(Request request);
}
```



å…·ä½“è¯·æ±‚å¤„ç†ç±»ï¼š

```java
public class ConcreteHandler1 extends Handler {

    public ConcreteHandler1(Handler successor) {
        super(successor);
    }


    @Override
    protected void handleRequest(Request request) {
        if (request.getType() == RequestType.TYPE1) {
            System.out.println(request.getName() + " is handle by ConcreteHandler1");
            return;
        }
        if (successor != null) {
            successor.handleRequest(request);
        }
    }
}
```



```java
public class ConcreteHandler2 extends Handler {

    public ConcreteHandler2(Handler successor) {
        super(successor);
    }


    @Override
    protected void handleRequest(Request request) {
        if (request.getType() == RequestType.TYPE2) {
            System.out.println(request.getName() + " is handle by ConcreteHandler2");
            return;
        }
        if (successor != null) {
            successor.handleRequest(request);
        }
    }
}
```



è¯·æ±‚ç±»ï¼š

```java
public class Request {

    private RequestType type;
    private String name;


    public Request(RequestType type, String name) {
        this.type = type;
        this.name = name;
    }


    public RequestType getType() {
        return type;
    }


    public String getName() {
        return name;
    }
}

```



```java
public enum RequestType {
    TYPE1, TYPE2
}
```



å®¢æˆ·ç«¯ç±»ï¼š

```java
public class Client {

    public static void main(String[] args) {

        Handler handler1 = new ConcreteHandler1(null);
        Handler handler2 = new ConcreteHandler2(handler1);

        Request request1 = new Request(RequestType.TYPE1, "request1");
        handler2.handleRequest(request1);

        Request request2 = new Request(RequestType.TYPE2, "request2");
        handler2.handleRequest(request2);
    }
}
```



### JDK

- [java.util.logging.Logger#log()](http://docs.oracle.com/javase/8/docs/api/java/util/logging/Logger.html#log%28java.util.logging.Level,%20java.lang.String%29)
- [Apache Commons Chain](https://commons.apache.org/proper/commons-chain/index.html)
- [javax.servlet.Filter#doFilter()](http://docs.oracle.com/javaee/7/api/javax/servlet/Filter.html#doFilter-javax.servlet.ServletRequest-javax.servlet.ServletResponse-javax.servlet.FilterChain-)



## 2 å‘½ä»¤æ¨¡å¼

### intent

**å°†å‘½ä»¤å°è£…æˆå¯¹è±¡ä¸­ï¼Œå…·æœ‰ä»¥ä¸‹ä½œç”¨ï¼š**

- ä½¿ç”¨å‘½ä»¤æ¥å‚æ•°åŒ–å…¶å®ƒå¯¹è±¡
- å°†å‘½ä»¤æ”¾å…¥é˜Ÿåˆ—ä¸­è¿›è¡Œæ’é˜Ÿ
- å°†å‘½ä»¤çš„æ“ä½œè®°å½•åˆ°æ—¥å¿—ä¸­
- æ”¯æŒå¯æ’¤é”€çš„æ“ä½œ



**æ¨¡å—è¯´æ˜ï¼š**

- Command:æŠ½è±¡å‘½ä»¤æ¥å£.
- Receiverï¼šå‘½ä»¤æ¥æ”¶è€…ï¼Œä¹Ÿå°±æ˜¯å‘½ä»¤çœŸæ­£çš„æ‰§è¡Œè€…
- Invokerï¼šé€šè¿‡å®ƒæ¥è°ƒç”¨å‘½ä»¤
- Clientï¼šå¯ä»¥è®¾ç½®å‘½ä»¤ä¸å‘½ä»¤çš„æ¥æ”¶è€…



**ä¼˜ç‚¹:**

- é™ä½è€¦åˆåº¦.
- æ–°å¢ä¸€ä¸ªå‘½ä»¤/ä¸€ç»„å‘½ä»¤ç®€å•.
- è°ƒç”¨åŒä¸€æ–¹æ³•å®ç°ä¸åŒåŠŸèƒ½.

**ç¼ºç‚¹ï¼š**

- ä¼šäº§ç”Ÿè¿‡å¤šå…·ä½“å‘½ä»¤ç±».

### Class Diagram



![](./assets/1.7.png)



### Implementation

è®¾è®¡ä¸€ä¸ªé¥æ§å™¨ï¼Œå¯ä»¥æ§åˆ¶ç”µç¯å¼€å…³ã€‚

<img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/e6bded8e-41a0-489a-88a6-638e88ab7666.jpg"/> 



å‘½ä»¤æ¥å£ï¼š

```java
public interface Command {
    void execute();
}
```

å…·ä½“çš„å•ä¸ªåŠŸèƒ½å®ç°ï¼š

```java
public class LightOnCommand implements Command {
    Light light;

    public LightOnCommand(Light light) {
        this.light = light;
    }

    @Override
    public void execute() {
        light.on();
    }
}
```

```java
public class LightOffCommand implements Command {
    Light light;

    public LightOffCommand(Light light) {
        this.light = light;
    }

    @Override
    public void execute() {
        light.off();
    }
}
```

æ‰€æœ‰åŠŸèƒ½çš„å°è£…ï¼š

```java
public class Light {

    public void on() {
        System.out.println("Light is on!");
    }

    public void off() {
        System.out.println("Light is off!");
    }
}
```

è°ƒç”¨å‘½ä»¤å®ç°åŠŸèƒ½ï¼š

```java
/**
 * é¥æ§å™¨
 */
public class Invoker {
    private Command[] onCommands;
    private Command[] offCommands;
    private final int slotNum = 7;

    public Invoker() {
        this.onCommands = new Command[slotNum];
        this.offCommands = new Command[slotNum];
    }

    public void setOnCommand(Command command, int slot) {
        onCommands[slot] = command;
    }

    public void setOffCommand(Command command, int slot) {
        offCommands[slot] = command;
    }

    public void onButtonWasPushed(int slot) {
        onCommands[slot].execute();
    }

    public void offButtonWasPushed(int slot) {
        offCommands[slot].execute();
    }
}
```

å®¢æˆ·ç«¯ï¼š

```java
public class Client {
    public static void main(String[] args) {
        Invoker invoker = new Invoker();
        Light light = new Light();
        Command lightOnCommand = new LightOnCommand(light);
        Command lightOffCommand = new LightOffCommand(light);
        invoker.setOnCommand(lightOnCommand, 0);
        invoker.setOffCommand(lightOffCommand, 0);
        invoker.onButtonWasPushed(0);
        invoker.offButtonWasPushed(0);
    }
}
```



### JDK

- [java.lang.Runnable](http://docs.oracle.com/javase/8/docs/api/java/lang/Runnable.html)
- [Netflix Hystrix](https://github.com/Netflix/Hystrix/wiki)
- [javax.swing.Action](http://docs.oracle.com/javase/8/docs/api/javax/swing/Action.html)



## 3 è§£é‡Šå™¨æ¨¡å¼

### intent

ä¸ºè¯­è¨€åˆ›å»ºè§£é‡Šå™¨ï¼Œé€šå¸¸ç”±è¯­è¨€çš„è¯­æ³•å’Œè¯­æ³•åˆ†ææ¥å®šä¹‰ã€‚

**ä¸»è¦ä¼˜ç‚¹ï¼š**

-  **æ˜“äºæ”¹å˜å’Œæ‰©å±•æ–‡æ³•**ã€‚ç”±äºåœ¨è§£é‡Šå™¨æ¨¡å¼ä¸­ä½¿ç”¨ç±»æ¥è¡¨ç¤ºè¯­è¨€çš„æ–‡æ³•è§„åˆ™ï¼Œå› æ­¤å¯ä»¥é€šè¿‡ç»§æ‰¿ç­‰æœºåˆ¶æ¥æ”¹å˜æˆ–æ‰©å±•æ–‡æ³•ã€‚
- æ¯ä¸€æ¡æ–‡æ³•è§„åˆ™éƒ½å¯ä»¥è¡¨ç¤ºä¸ºä¸€ä¸ªç±»ï¼Œå› æ­¤å¯ä»¥**æ–¹ä¾¿åœ°å®ç°ä¸€ä¸ªç®€å•çš„è¯­è¨€**ã€‚
-  **å®ç°æ–‡æ³•è¾ƒä¸ºå®¹æ˜“**ã€‚åœ¨æŠ½è±¡è¯­æ³•æ ‘ä¸­æ¯ä¸€ä¸ªè¡¨è¾¾å¼èŠ‚ç‚¹ç±»çš„å®ç°æ–¹å¼éƒ½æ˜¯ç›¸ä¼¼çš„ï¼Œè¿™äº›ç±»çš„ä»£ç ç¼–å†™éƒ½ä¸ä¼šç‰¹åˆ«å¤æ‚ï¼Œè¿˜å¯ä»¥é€šè¿‡ä¸€äº›å·¥å…·è‡ªåŠ¨ç”ŸæˆèŠ‚ç‚¹ç±»ä»£ç ã€‚
-  **å¢åŠ æ–°çš„è§£é‡Šè¡¨è¾¾å¼è¾ƒä¸ºæ–¹ä¾¿**ã€‚å¦‚æœç”¨æˆ·éœ€è¦å¢åŠ æ–°çš„è§£é‡Šè¡¨è¾¾å¼åªéœ€è¦å¯¹åº”å¢åŠ ä¸€ä¸ªæ–°çš„ç»ˆç»“ç¬¦è¡¨è¾¾å¼æˆ–éç»ˆç»“ç¬¦è¡¨è¾¾å¼ç±»ï¼ŒåŸæœ‰è¡¨è¾¾å¼ç±»ä»£ç æ— é¡»ä¿®æ”¹ï¼Œç¬¦åˆ "å¼€é—­åŸåˆ™"ã€‚

**ä¸»è¦ç¼ºç‚¹ï¼š**

-  **å¯¹äºå¤æ‚æ–‡æ³•éš¾ä»¥ç»´æŠ¤**ã€‚åœ¨è§£é‡Šå™¨æ¨¡å¼ä¸­ï¼Œæ¯ä¸€æ¡è§„åˆ™è‡³å°‘éœ€è¦å®šä¹‰ä¸€ä¸ªç±»ï¼Œå› æ­¤å¦‚æœä¸€ä¸ªè¯­è¨€åŒ…å«å¤ªå¤šæ–‡æ³•è§„åˆ™ï¼Œç±»çš„ä¸ªæ•°å°†ä¼šæ€¥å‰§å¢åŠ ï¼Œå¯¼è‡´ç³»ç»Ÿéš¾ä»¥ç®¡ç†å’Œç»´æŠ¤ï¼Œæ­¤æ—¶å¯ä»¥è€ƒè™‘ä½¿ç”¨è¯­æ³•åˆ†æç¨‹åºç­‰æ–¹å¼æ¥å–ä»£è§£é‡Šå™¨æ¨¡å¼ã€‚
-  **æ‰§è¡Œæ•ˆç‡è¾ƒä½**ã€‚ç”±äºåœ¨è§£é‡Šå™¨æ¨¡å¼ä¸­ä½¿ç”¨äº†å¤§é‡çš„å¾ªç¯å’Œé€’å½’è°ƒç”¨ï¼Œå› æ­¤åœ¨è§£é‡Šè¾ƒä¸ºå¤æ‚çš„å¥å­æ—¶å…¶é€Ÿåº¦å¾ˆæ…¢ï¼Œè€Œä¸”ä»£ç çš„è°ƒè¯•è¿‡ç¨‹ä¹Ÿæ¯”è¾ƒéº»çƒ¦ã€‚

**é€‚ç”¨åœºæ™¯ï¼š**

- å¯ä»¥å°†ä¸€ä¸ªéœ€è¦è§£é‡Šæ‰§è¡Œçš„è¯­è¨€ä¸­çš„å¥å­è¡¨ç¤ºä¸ºä¸€ä¸ªæŠ½è±¡è¯­æ³•æ ‘ã€‚
- ä¸€äº›é‡å¤å‡ºç°çš„é—®é¢˜å¯ä»¥ç”¨ä¸€ç§ç®€å•çš„è¯­è¨€æ¥è¿›è¡Œè¡¨è¾¾ã€‚
- ä¸€ä¸ªè¯­è¨€çš„æ–‡æ³•è¾ƒä¸ºç®€å•ã€‚
- å¯¹æ‰§è¡Œæ•ˆç‡è¦æ±‚ä¸é«˜ã€‚

###  Class Diagram

![](./assets/1.26.png)

### Implementation

 ä»¥ä¸‹æ˜¯ä¸€ä¸ªè§„åˆ™æ£€éªŒå™¨å®ç°ï¼Œå…·æœ‰ and å’Œ or è§„åˆ™ï¼Œé€šè¿‡è§„åˆ™å¯ä»¥æ„å»ºä¸€é¢—è§£ææ ‘ï¼Œç”¨æ¥æ£€éªŒä¸€ä¸ªæ–‡æœ¬æ˜¯å¦æ»¡è¶³è§£ææ ‘å®šä¹‰çš„è§„åˆ™ã€‚

ä¾‹å¦‚ä¸€é¢—è§£ææ ‘ä¸º D And (A Or (B C))ï¼Œæ–‡æœ¬ "D A" æ»¡è¶³è¯¥è§£ææ ‘å®šä¹‰çš„è§„åˆ™ã€‚

è¿™é‡Œçš„ Context æŒ‡çš„æ˜¯ Stringã€‚

```java
public abstract class Expression {
    public abstract boolean interpret(String str);
}
```

```java
public class TerminalExpression extends Expression {

    private String literal = null;

    public TerminalExpression(String str) {
        literal = str;
    }

    public boolean interpret(String str) {
        StringTokenizer st = new StringTokenizer(str);
        while (st.hasMoreTokens()) {
            String test = st.nextToken();
            if (test.equals(literal)) {
                return true;
            }
        }
        return false;
    }
}
```

```java
public class AndExpression extends Expression {

    private Expression expression1 = null;
    private Expression expression2 = null;

    public AndExpression(Expression expression1, Expression expression2) {
        this.expression1 = expression1;
        this.expression2 = expression2;
    }

    public boolean interpret(String str) {
        return expression1.interpret(str) && expression2.interpret(str);
    }
}
```

```java
public class OrExpression extends Expression {
    private Expression expression1 = null;
    private Expression expression2 = null;

    public OrExpression(Expression expression1, Expression expression2) {
        this.expression1 = expression1;
        this.expression2 = expression2;
    }

    public boolean interpret(String str) {
        return expression1.interpret(str) || expression2.interpret(str);
    }
}
```

```java
public class Client {

    /**
     * æ„å»ºè§£ææ ‘
     */
    public static Expression buildInterpreterTree() {
        // Literal
        Expression terminal1 = new TerminalExpression("A");
        Expression terminal2 = new TerminalExpression("B");
        Expression terminal3 = new TerminalExpression("C");
        Expression terminal4 = new TerminalExpression("D");
        // B C
        Expression alternation1 = new OrExpression(terminal2, terminal3);
        // A Or (B C)
        Expression alternation2 = new OrExpression(terminal1, alternation1);
        // D And (A Or (B C))
        return new AndExpression(terminal4, alternation2);
    }

    public static void main(String[] args) {
        Expression define = buildInterpreterTree();
        String context1 = "D A";
        String context2 = "A B";
        System.out.println(define.interpret(context1));
        System.out.println(define.interpret(context2));
    }
}
```

```html
true
false
```

### JDK

- [java.util.Pattern](http://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html)
- [java.text.Normalizer](http://docs.oracle.com/javase/8/docs/api/java/text/Normalizer.html)
- All subclasses of [java.text.Format](http://docs.oracle.com/javase/8/docs/api/java/text/Format.html)
- [javax.el.ELResolver](http://docs.oracle.com/javaee/7/api/javax/el/ELResolver.html)

 



## 4 è¿­ä»£å™¨

### intent

æä¾›ä¸€ç§æ–¹æ³•é¡ºåºè®¿é—®ä¸€ä¸ªé›†åˆå¯¹è±¡ä¸­çš„å„ç§å…ƒç´ ï¼Œè€Œåˆä¸æš´éœ²è¯¥å¯¹è±¡çš„å†…éƒ¨è¡¨ç¤º. 

- Aggregate æ˜¯èšåˆç±»ï¼Œå…¶ä¸­ createIterator() æ–¹æ³•å¯ä»¥äº§ç”Ÿä¸€ä¸ª Iteratorï¼›
- Iterator ä¸»è¦å®šä¹‰äº† hasNext() å’Œ next() æ–¹æ³•ã€‚
- Client ç»„åˆäº† Aggregateï¼Œä¸ºäº†è¿­ä»£éå† Aggregateï¼Œä¹Ÿéœ€è¦ç»„åˆ Iteratorã€‚



### Class Diagram



![](./assets/1.8.png)

###  

### Implementation

```java
public interface Aggregate {
    Iterator createIterator();
}
```

```java
public class ConcreteAggregate implements Aggregate {

    private Integer[] items;

    public ConcreteAggregate() {
        items = new Integer[10];
        for (int i = 0; i < items.length; i++) {
            items[i] = i;
        }
    }

    @Override
    public Iterator createIterator() {
        return new ConcreteIterator<Integer>(items);
    }
}
```

```java
public interface Iterator<Item> {

    Item next();

    boolean hasNext();
}
```

```java
public class ConcreteIterator<Item> implements Iterator {

    private Item[] items;
    private int position = 0;

    public ConcreteIterator(Item[] items) {
        this.items = items;
    }

    @Override
    public Object next() {
        return items[position++];
    }

    @Override
    public boolean hasNext() {
        return position < items.length;
    }
}
```

```java
public class Client {

    public static void main(String[] args) {
        Aggregate aggregate = new ConcreteAggregate();
        Iterator<Integer> iterator = aggregate.createIterator();
        while (iterator.hasNext()) {
            System.out.println(iterator.next());
        }
    }
}
```

### JDK

- [java.util.Iterator](http://docs.oracle.com/javase/8/docs/api/java/util/Iterator.html)
- [java.util.Enumeration](http://docs.oracle.com/javase/8/docs/api/java/util/Enumeration.html)

 

 

## 5 ä¸­ä»‹è€…

### intent

é›†ä¸­ç›¸å…³å¯¹è±¡ä¹‹é—´å¤æ‚çš„æ²Ÿé€šå’Œæ§åˆ¶æ–¹å¼ã€‚

**èƒŒæ™¯ï¼š**åœ¨é¢å‘å¯¹è±¡çš„è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæ ¹æ®**â€œå•ä¸€èŒè´£åŸåˆ™â€**ï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡å°†å¯¹è±¡ç»†åŒ–ï¼Œä½¿å…¶åªè´Ÿè´£æˆ–å‘ˆå•ä¸€èŒè´£ã€‚å¯¹äºä¸€ä¸ªæ¨¡å—å’Œç³»ç»Ÿï¼Œå¯èƒ½ç”±å¤šä¸ªå¯¹è±¡æ„æˆï¼Œè¿™äº›å¯¹è±¡ä¹‹é—´å¯èƒ½å­˜åœ¨ç›¸äº’è°ƒç”¨çš„æƒ…å†µï¼Œè¿™æ ·ä¼šå¤æ‚åŒ–å¯¹è±¡ä¹‹é—´çš„è”ç³»ã€‚

**ä½œç”¨ï¼š**ä¸­ä»‹è€…æ¨¡å¼é€šè¿‡å¼•å…¥ä¸­ä»‹è€…å¯¹è±¡ï¼Œå°†ç³»ç»Ÿå†…éƒ¨çš„ç»“æ„ç”±ç½‘çŠ¶ç»“æ„è½¬åŒ–ä¸ºæ˜ŸçŠ¶ç»“æ„ï¼Œä½¿å¾—ç³»ç»Ÿä¸­æœ‰å…³å¯¹è±¡å¼•ç”¨å…¶å®ƒçš„å¯¹è±¡çš„æ•°é‡å‡å°‘åˆ°æœ€å°‘ã€‚é™ä½æ¨¡å—å†…éƒ¨ä¹‹é—´ç±»çš„ç›¸äº’å¼•ç”¨ï¼Œé˜²æ­¢å‡ºç°ç³»ç»Ÿæˆ–æ¨¡å—å†…éƒ¨è¿‡åº¦è€¦åˆã€‚ 

**ä¼˜ç‚¹ï¼š**

1. ç®€åŒ–äº†å¯¹è±¡ä¹‹é—´çš„å…³ç³»ï¼Œå°†ç³»ç»Ÿå†…éƒ¨çš„å„ä¸ªå¯¹è±¡ä¹‹é—´çš„äº¤äº’è¿›è¡Œäº†å°è£…ï¼Œä½¿å¾—å„ä¸ªç±»ä¹‹é—´å…³ç³»è§£è€¦ï¼Œä½¿å¾—ç³»ç»Ÿæˆä¸ºä½è€¦åˆç³»ç»Ÿã€‚
2. å‡å°‘å­ç±»çš„ç”Ÿæˆã€‚
3. è¾ƒå°‘åŒäº‹ç±»çš„è®¾è®¡å’Œå®ç°ã€‚

**ç¼ºç‚¹ï¼š**

ç”±äºä¸­ä»‹è€…å¯¹è±¡å°è£…äº†å„ä¸ªç±»ä¹‹é—´çš„äº¤äº’ï¼Œä¼šå¯¼è‡´ä¸­ä»‹è€…ç±»æœ¬èº«çš„å¤æ‚æ€§ä¸Šå‡ï¼Œä¸­ä»‹è€…ç±»æœ¬èº«çš„ç»´æŠ¤ä¼šå˜å¾—å¤æ‚ã€‚

 

### Class Diagram

- Mediatorï¼šä¸­ä»‹è€…ï¼Œå®šä¹‰ä¸€ä¸ªæ¥å£ç”¨äºä¸å„åŒäº‹ï¼ˆColleagueï¼‰å¯¹è±¡é€šä¿¡ã€‚
- Colleagueï¼šåŒäº‹ï¼Œç›¸å…³å¯¹è±¡

![](./assets/1.9.png)



### Implementation

Alarmï¼ˆé—¹é’Ÿï¼‰ã€CoffeePotï¼ˆå’–å•¡å£¶ï¼‰ã€Calendarï¼ˆæ—¥å†ï¼‰ã€Sprinklerï¼ˆå–·å¤´ï¼‰æ˜¯ä¸€ç»„ç›¸å…³çš„å¯¹è±¡ï¼Œåœ¨æŸä¸ªå¯¹è±¡çš„äº‹ä»¶äº§ç”Ÿæ—¶éœ€è¦å»æ“ä½œå…¶å®ƒå¯¹è±¡ï¼Œå½¢æˆäº†ä¸‹é¢è¿™ç§ä¾èµ–ç»“æ„ï¼š

![](./assets/1.10.jpg)

ä½¿ç”¨ä¸­ä»‹è€…æ¨¡å¼å¯ä»¥å°†å¤æ‚çš„ä¾èµ–ç»“æ„å˜æˆæ˜Ÿå½¢ç»“æ„ï¼š

![](./assets/1.11.jpg) </div><br>

```java
public abstract class Colleague {
    public abstract void onEvent(Mediator mediator);
}
```

```java
public class Alarm extends Colleague {

    @Override
    public void onEvent(Mediator mediator) {
        mediator.doEvent("alarm");
    }

    public void doAlarm() {
        System.out.println("doAlarm()");
    }
}
```

```java
public class CoffeePot extends Colleague {
    @Override
    public void onEvent(Mediator mediator) {
        mediator.doEvent("coffeePot");
    }

    public void doCoffeePot() {
        System.out.println("doCoffeePot()");
    }
}
```

```java
public class Calender extends Colleague {
    @Override
    public void onEvent(Mediator mediator) {
        mediator.doEvent("calender");
    }

    public void doCalender() {
        System.out.println("doCalender()");
    }
}
```

```java
public class Sprinkler extends Colleague {
    @Override
    public void onEvent(Mediator mediator) {
        mediator.doEvent("sprinkler");
    }

    public void doSprinkler() {
        System.out.println("doSprinkler()");
    }
}
```

```java
public abstract class Mediator {
    public abstract void doEvent(String eventType);
}
```

```java
public class ConcreteMediator extends Mediator {
    private Alarm alarm;
    private CoffeePot coffeePot;
    private Calender calender;
    private Sprinkler sprinkler;

    public ConcreteMediator(Alarm alarm, CoffeePot coffeePot, Calender calender, Sprinkler sprinkler) {
        this.alarm = alarm;
        this.coffeePot = coffeePot;
        this.calender = calender;
        this.sprinkler = sprinkler;
    }

    @Override
    public void doEvent(String eventType) {
        switch (eventType) {
            case "alarm":
                doAlarmEvent();
                break;
            case "coffeePot":
                doCoffeePotEvent();
                break;
            case "calender":
                doCalenderEvent();
                break;
            default:
                doSprinklerEvent();
        }
    }

    public void doAlarmEvent() {
        alarm.doAlarm();
        coffeePot.doCoffeePot();
        calender.doCalender();
        sprinkler.doSprinkler();
    }

    public void doCoffeePotEvent() {
        // ...
    }

    public void doCalenderEvent() {
        // ...
    }

    public void doSprinklerEvent() {
        // ...
    }
}
```

```java
public class Client {
    public static void main(String[] args) {
        Alarm alarm = new Alarm();
        CoffeePot coffeePot = new CoffeePot();
        Calender calender = new Calender();
        Sprinkler sprinkler = new Sprinkler();
        Mediator mediator = new ConcreteMediator(alarm, coffeePot, calender, sprinkler);
        // é—¹é’Ÿäº‹ä»¶åˆ°è¾¾ï¼Œè°ƒç”¨ä¸­ä»‹è€…å°±å¯ä»¥æ“ä½œç›¸å…³å¯¹è±¡
        alarm.onEvent(mediator);
    }
}
```

```java
doAlarm()
doCoffeePot()
doCalender()
doSprinkler()
```

### JDK

- All scheduleXXX() methods of [java.util.Timer](http://docs.oracle.com/javase/8/docs/api/java/util/Timer.html)
- [java.util.concurrent.Executor#execute()](http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Executor.html#execute-java.lang.Runnable-)
- submit() and invokeXXX() methods of [java.util.concurrent.ExecutorService](http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ExecutorService.html)
- scheduleXXX() methods of [java.util.concurrent.ScheduledExecutorService](http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ScheduledExecutorService.html)
- [java.lang.reflect.Method#invoke()](http://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Method.html#invoke-java.lang.Object-java.lang.Object...-)



## 6 å¤‡å¿˜å½•

[æ¨èåšå®¢](https://blog.csdn.net/wwwdc1012/article/details/83353580)

### Intent

åœ¨ä¸è¿åå°è£…çš„æƒ…å†µä¸‹è·å¾—å¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œä»è€Œåœ¨éœ€è¦æ—¶å¯ä»¥å°†å¯¹è±¡æ¢å¤åˆ°æœ€åˆçŠ¶æ€ã€‚

å¤‡å¿˜å½•æ¨¡å¼ç»å¸¸å¯ä»¥é‡åˆ°ï¼Œè­¬å¦‚ä¸‹é¢è¿™äº›åœºæ™¯ï¼š

- æµè§ˆå™¨å›é€€ï¼šæµè§ˆå™¨ä¸€èˆ¬æœ‰æµè§ˆè®°å½•ï¼Œå½“æˆ‘ä»¬åœ¨ä¸€ä¸ªç½‘é¡µä¸Šç‚¹å‡»å‡ æ¬¡é“¾æ¥ä¹‹åï¼Œå¯åœ¨å·¦ä¸Šè§’ç‚¹å‡»å·¦ç®­å¤´å›é€€åˆ°ä¸Šä¸€æ¬¡çš„é¡µé¢ï¼Œç„¶åä¹Ÿå¯ä»¥ç‚¹å‡»å³ç®­å¤´é‡æ–°å›åˆ°å½“å‰é¡µé¢
- **æ•°æ®åº“å¤‡ä»½ä¸è¿˜åŸ**ï¼šä¸€èˆ¬çš„æ•°æ®åº“éƒ½æ”¯æŒå¤‡ä»½ä¸è¿˜åŸæ“ä½œï¼Œå¤‡ä»½å³å°†å½“å‰å·²æœ‰çš„æ•°æ®æˆ–è€…è®°å½•ä¿ç•™ï¼Œè¿˜åŸå³å°†å·²ç»ä¿ç•™çš„æ•°æ®æ¢å¤åˆ°å¯¹åº”çš„è¡¨ä¸­

- ç¼–è¾‘å™¨æ’¤é”€ä¸é‡åšï¼šåœ¨ç¼–è¾‘å™¨ä¸Šç¼–è¾‘æ–‡å­—ï¼Œå†™é”™æ—¶å¯ä»¥æŒ‰å¿«æ·é”® Ctrl + z æ’¤é”€ï¼Œæ’¤é”€åå¯ä»¥æŒ‰ Ctrl + y é‡åš

- **è™šæ‹Ÿæœºç”Ÿæˆå¿«ç…§ä¸æ¢å¤**ï¼šè™šæ‹Ÿæœºå¯ä»¥ç”Ÿæˆä¸€ä¸ªå¿«ç…§ï¼Œå½“è™šæ‹Ÿæœºå‘ç”Ÿé”™è¯¯æ—¶å¯ä»¥æ¢å¤åˆ°å¿«ç…§çš„æ ·å­

- Gitç‰ˆæœ¬ç®¡ç†ï¼šGitæ˜¯æœ€å¸¸è§çš„ç‰ˆæœ¬ç®¡ç†è½¯ä»¶ï¼Œæ¯æäº¤ä¸€ä¸ªæ–°ç‰ˆæœ¬ï¼Œå®é™…ä¸ŠGitå°±ä¼šæŠŠå®ƒä»¬è‡ªåŠ¨ä¸²æˆä¸€æ¡æ—¶é—´çº¿ï¼Œæ¯ä¸ªç‰ˆæœ¬éƒ½æœ‰ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œä½¿ç”¨ git reset --hard ç‰ˆæœ¬å· å³å¯å›åˆ°æŒ‡å®šçš„ç‰ˆæœ¬ï¼Œè®©ä»£ç æ—¶ç©ºç©¿æ¢­å›åˆ°è¿‡å»æŸä¸ªå†å²æ—¶åˆ»

- æ£‹ç‰Œæ¸¸æˆæ‚”æ£‹ï¼šåœ¨æ£‹ç‰Œæ¸¸æˆä¸­ï¼Œæœ‰æ—¶ä¸‹å¿«äº†å¯ä»¥æ‚”æ£‹ï¼Œå›é€€åˆ°ä¸Šä¸€æ­¥é‡æ–°ä¸‹



**ä¸»è¦ä¼˜ç‚¹å¦‚ä¸‹ï¼š**

- å®ƒæä¾›äº†ä¸€ç§çŠ¶æ€æ¢å¤çš„å®ç°æœºåˆ¶ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥æ–¹ä¾¿åœ°å›åˆ°ä¸€ä¸ªç‰¹å®šçš„å†å²æ­¥éª¤ï¼Œå½“æ–°çš„çŠ¶æ€æ— æ•ˆæˆ–è€…å­˜åœ¨é—®é¢˜æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æš‚æ—¶å­˜å‚¨èµ·æ¥çš„å¤‡å¿˜å½•å°†çŠ¶æ€å¤åŸã€‚
- å¤‡å¿˜å½•å®ç°äº†å¯¹ä¿¡æ¯çš„å°è£…ï¼Œä¸€ä¸ªå¤‡å¿˜å½•å¯¹è±¡æ˜¯ä¸€ç§åŸå‘å™¨å¯¹è±¡çŠ¶æ€çš„è¡¨ç¤ºï¼Œä¸ä¼šè¢«å…¶ä»–ä»£ç æ‰€æ”¹åŠ¨ã€‚å¤‡å¿˜å½•ä¿å­˜äº†åŸå‘å™¨çš„çŠ¶æ€ï¼Œé‡‡ç”¨åˆ—è¡¨ã€å †æ ˆç­‰é›†åˆæ¥å­˜å‚¨å¤‡å¿˜å½•å¯¹è±¡å¯ä»¥å®ç°å¤šæ¬¡æ’¤é”€æ“ä½œã€‚

**ä¸»è¦ç¼ºç‚¹å¦‚ä¸‹ï¼š**

* èµ„æºæ¶ˆè€—è¿‡å¤§ï¼Œå¦‚æœéœ€è¦ä¿å­˜çš„åŸå‘å™¨ç±»çš„æˆå‘˜å˜é‡å¤ªå¤šï¼Œå°±ä¸å¯é¿å…éœ€è¦å ç”¨å¤§é‡çš„å­˜å‚¨ç©ºé—´ï¼Œæ¯ä¿å­˜ä¸€æ¬¡å¯¹è±¡çš„çŠ¶æ€éƒ½éœ€è¦æ¶ˆè€—ä¸€å®šçš„ç³»ç»Ÿèµ„æºã€‚





### Class Diagram

- Originatorï¼šåŸå§‹å¯¹è±¡
- Caretakerï¼šè´Ÿè´£ä¿å­˜å¥½å¤‡å¿˜å½•
- Menentoï¼šå¤‡å¿˜å½•ï¼Œå­˜å‚¨åŸå§‹å¯¹è±¡çš„çš„çŠ¶æ€ã€‚å¤‡å¿˜å½•å®é™…ä¸Šæœ‰ä¸¤ä¸ªæ¥å£ï¼Œä¸€ä¸ªæ˜¯æä¾›ç»™ Caretaker çš„çª„æ¥å£ï¼šå®ƒåªèƒ½å°†å¤‡å¿˜å½•ä¼ é€’ç»™å…¶å®ƒå¯¹è±¡ï¼›ä¸€ä¸ªæ˜¯æä¾›ç»™ Originator çš„å®½æ¥å£ï¼Œå…è®¸å®ƒè®¿é—®åˆ°å…ˆå‰çŠ¶æ€æ‰€éœ€çš„æ‰€æœ‰æ•°æ®ã€‚ç†æƒ³æƒ…å†µæ˜¯åªå…è®¸ Originator è®¿é—®æœ¬å¤‡å¿˜å½•çš„å†…éƒ¨çŠ¶æ€ã€‚

![](./assets/1.17.png) 

### Implementation

ä»¥ä¸‹å®ç°äº†ä¸€ä¸ªç®€å•è®¡ç®—å™¨ç¨‹åºï¼Œå¯ä»¥è¾“å…¥ä¸¤ä¸ªå€¼ï¼Œç„¶åè®¡ç®—è¿™ä¸¤ä¸ªå€¼çš„å’Œã€‚å¤‡å¿˜å½•æ¨¡å¼å…è®¸å°†è¿™ä¸¤ä¸ªå€¼å­˜å‚¨èµ·æ¥ï¼Œç„¶ååœ¨æŸä¸ªæ—¶åˆ»ç”¨å­˜å‚¨çš„çŠ¶æ€è¿›è¡Œæ¢å¤ã€‚

å®ç°å‚è€ƒï¼š[Memento Pattern - Calculator Example - Java Sourcecode](https://www.oodesign.com/memento-pattern-calculator-example-java-sourcecode.html)

Originatorï¼š

```java
/**
 * Originator Interface
 */
public interface Calculator {

    // Create Memento
    PreviousCalculationToCareTaker backupLastCalculation();

    // setMemento
    void restorePreviousCalculation(PreviousCalculationToCareTaker memento);

    int getCalculationResult();

    void setFirstNumber(int firstNumber);

    void setSecondNumber(int secondNumber);
}
```

```java
/**
 * Originator Implementation
 */
public class CalculatorImp implements Calculator {

    private int firstNumber;
    private int secondNumber;

    @Override
    public PreviousCalculationToCareTaker backupLastCalculation() {
        // create a memento object used for restoring two numbers
        return new PreviousCalculationImp(firstNumber, secondNumber);
    }

    @Override
    public void restorePreviousCalculation(PreviousCalculationToCareTaker memento) {
        this.firstNumber = ((PreviousCalculationToOriginator) memento).getFirstNumber();
        this.secondNumber = ((PreviousCalculationToOriginator) memento).getSecondNumber();
    }

    @Override
    public int getCalculationResult() {
        // result is adding two numbers
        return firstNumber + secondNumber;
    }

    @Override
    public void setFirstNumber(int firstNumber) {
        this.firstNumber = firstNumber;
    }

    @Override
    public void setSecondNumber(int secondNumber) {
        this.secondNumber = secondNumber;
    }
}
```

Mementoæš´éœ²ç»™Originatorçš„æ¥å£ï¼š

```java
/**
 * Memento Interface to Originator
 *
 * This interface allows the originator to restore its state
 */
public interface PreviousCalculationToOriginator {
    int getFirstNumber();
    int getSecondNumber();
}
```

Mementoæš´éœ²ç»™CalculatorOperatorçš„æ¥å£ï¼š

```java
/**
 *  Memento interface to CalculatorOperator (Caretaker)
 */
public interface PreviousCalculationToCareTaker {
    // no operations permitted for the caretaker
}
```



åŒæ—¶ç»§æ‰¿ä¸¤ä¸ªæ¥å£ï¼Œä¿å­˜äº†æ•°æ®

```java
/**
 * Memento Object Implementation
 * <p>
 * Note that this object implements both interfaces to Originator and CareTaker
 */
public class PreviousCalculationImp implements PreviousCalculationToCareTaker,
        PreviousCalculationToOriginator {

    private int firstNumber;
    private int secondNumber;

    public PreviousCalculationImp(int firstNumber, int secondNumber) {
        this.firstNumber = firstNumber;
        this.secondNumber = secondNumber;
    }

    @Override
    public int getFirstNumber() {
        return firstNumber;
    }

    @Override
    public int getSecondNumber() {
        return secondNumber;
    }
}
```



```java
/**
 * CareTaker object
 */
public class Client {

    public static void main(String[] args) {
        // program starts
        Calculator calculator = new CalculatorImp();

        // assume user enters two numbers
        calculator.setFirstNumber(10);
        calculator.setSecondNumber(100);

        // find result
        System.out.println(calculator.getCalculationResult());

        // Store result of this calculation in case of error
        PreviousCalculationToCareTaker memento = calculator.backupLastCalculation();

        // user enters a number
        calculator.setFirstNumber(17);

        // user enters a wrong second number and calculates result
        calculator.setSecondNumber(-290);

        // calculate result
        System.out.println(calculator.getCalculationResult());

        // user hits CTRL + Z to undo last operation and see last result
        calculator.restorePreviousCalculation(memento);

        // result restored
        System.out.println(calculator.getCalculationResult());
    }
}
```

```html
110
-273
110
```

### JDK

- java.io.Serializable



## 7 è§‚å¯Ÿè€…

### Intent

è§‚å¯Ÿè€…æ¨¡å¼å®šä¹‰äº†å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å°†å¾—åˆ°é€šçŸ¥ï¼Œå¹¶è‡ªåŠ¨æ›´æ–°ã€‚ 

ä¸»é¢˜ï¼ˆSubjectï¼‰æ˜¯è¢«è§‚å¯Ÿçš„å¯¹è±¡ï¼Œè€Œå…¶æ‰€æœ‰ä¾èµ–è€…ï¼ˆObserverï¼‰ç§°ä¸ºè§‚å¯Ÿè€…ã€‚

![](./assets/1.12.jpg)

### Class Diagram

ä¸»é¢˜ï¼ˆSubjectï¼‰å…·æœ‰æ³¨å†Œå’Œç§»é™¤è§‚å¯Ÿè€…ã€å¹¶é€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…çš„åŠŸèƒ½ï¼Œä¸»é¢˜æ˜¯é€šè¿‡ç»´æŠ¤ä¸€å¼ è§‚å¯Ÿè€…åˆ—è¡¨æ¥å®ç°è¿™äº›æ“ä½œçš„ã€‚

è§‚å¯Ÿè€…ï¼ˆObserverï¼‰çš„æ³¨å†ŒåŠŸèƒ½éœ€è¦è°ƒç”¨ä¸»é¢˜çš„ registerObserver() æ–¹æ³•ã€‚

![](./assets/1.13.png) </div><br>

### Implementation

å¤©æ°”æ•°æ®å¸ƒå‘Šæ¿ä¼šåœ¨å¤©æ°”ä¿¡æ¯å‘ç”Ÿæ”¹å˜æ—¶æ›´æ–°å…¶å†…å®¹ï¼Œå¸ƒå‘Šæ¿æœ‰å¤šä¸ªï¼Œå¹¶ä¸”åœ¨å°†æ¥ä¼šç»§ç»­å¢åŠ ã€‚

![](./assets/1.13.jpg)





```java
public interface Subject {
    void registerObserver(Observer o);

    void removeObserver(Observer o);

    void notifyObserver();
}
```

```java
public class WeatherData implements Subject {
    //è§‚å¯Ÿè€…
    private List<Observer> observers;
    private float temperature;
    private float humidity;
    private float pressure;

    public WeatherData() {
        observers = new ArrayList<>();
    }

    public void setMeasurements(float temperature, float humidity, float pressure) {
        this.temperature = temperature;
        this.humidity = humidity;
        this.pressure = pressure;
        notifyObserver();
    }

    @Override
    public void registerObserver(Observer o) {
        observers.add(o);
    }

    @Override
    public void removeObserver(Observer o) {
        int i = observers.indexOf(o);
        if (i >= 0) {
            observers.remove(i);
        }
    }

    //é€šçŸ¥è§‚å¯Ÿè€…æ‰€æœ‰çš„æ”¹å˜
    @Override
    public void notifyObserver() {
        for (Observer o : observers) {
            o.update(temperature, humidity, pressure);
        }
    }
}
```

```java
public interface Observer {
    void update(float temp, float humidity, float pressure);
}
```

```java
public class StatisticsDisplay implements Observer {

    public StatisticsDisplay(Subject weatherData) {
        weatherData.reisterObserver(this);
    }

    @Override
    public void update(float temp, float humidity, float pressure) {
        System.out.println("StatisticsDisplay.update: " + temp + " " + humidity + " " + pressure);
    }
}
```

```java
public class CurrentConditionsDisplay implements Observer {

    public CurrentConditionsDisplay(Subject weatherData) {
        weatherData.registerObserver(this);
    }

    @Override
    public void update(float temp, float humidity, float pressure) {
        System.out.println("CurrentConditionsDisplay.update: " + temp + " " + humidity + " " + pressure);
    }
}
```



æµ‹è¯•ï¼š

```java
public class WeatherStation {
    public static void main(String[] args) {
        WeatherData weatherData = new WeatherData();
        CurrentConditionsDisplay currentConditionsDisplay = new CurrentConditionsDisplay(weatherData);
        StatisticsDisplay statisticsDisplay = new StatisticsDisplay(weatherData);

        weatherData.setMeasurements(0, 0, 0);
        weatherData.setMeasurements(1, 1, 1);
    }
}
```



```html
CurrentConditionsDisplay.update: 0.0 0.0 0.0
StatisticsDisplay.update: 0.0 0.0 0.0
CurrentConditionsDisplay.update: 1.0 1.0 1.0
StatisticsDisplay.update: 1.0 1.0 1.0
```



### EXTEND

è§‚å¯Ÿè€…æ¨¡å¼çš„ä¸€ä¸ªæ‰©å±•åº”ç”¨æ˜¯å‘å¸ƒè®¢é˜…æ¨¡å¼ã€‚

![](./assets/1.14.png)

**è§‚å¯Ÿè€…æ¨¡å¼ï¼š**è§‚å¯Ÿè€…ï¼ˆObserverï¼‰ç›´æ¥è®¢é˜…ï¼ˆSubscribeï¼‰ä¸»é¢˜ï¼ˆSubjectï¼‰ï¼Œè€Œå½“ä¸»é¢˜è¢«æ¿€æ´»çš„æ—¶å€™ï¼Œä¼šè§¦å‘ï¼ˆFire Eventï¼‰è§‚å¯Ÿè€…é‡Œçš„äº‹ä»¶ã€‚ 

**å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼š**è®¢é˜…è€…ï¼ˆSubscriberï¼‰æŠŠè‡ªå·±æƒ³è®¢é˜…çš„äº‹ä»¶æ³¨å†Œï¼ˆSubscribeï¼‰åˆ°è°ƒåº¦ä¸­å¿ƒï¼ˆTopicï¼‰ï¼Œå½“å‘å¸ƒè€…ï¼ˆPublisherï¼‰å‘å¸ƒè¯¥äº‹ä»¶ï¼ˆPublish  topicï¼‰åˆ°è°ƒåº¦ä¸­å¿ƒï¼Œä¹Ÿå°±æ˜¯è¯¥äº‹ä»¶è§¦å‘æ—¶ï¼Œç”±è°ƒåº¦ä¸­å¿ƒç»Ÿä¸€è°ƒåº¦ï¼ˆFire Eventï¼‰è®¢é˜…è€…æ³¨å†Œåˆ°è°ƒåº¦ä¸­å¿ƒçš„å¤„ç†ä»£ç ã€‚

åŒºåˆ«ï¼š

è§‚å¯Ÿè€…æ¨¡å¼å’Œå‘å¸ƒè®¢é˜…æ¨¡å¼æœ€å¤§çš„åŒºåˆ«å°±æ˜¯å‘å¸ƒè®¢é˜…æ¨¡å¼æœ‰ä¸ªäº‹ä»¶è°ƒåº¦ä¸­å¿ƒã€‚

è§‚å¯Ÿè€…æ¨¡å¼ç”±å…·ä½“ç›®æ ‡è°ƒåº¦ï¼Œæ¯ä¸ªè¢«è®¢é˜…çš„ç›®æ ‡é‡Œé¢éƒ½éœ€è¦æœ‰å¯¹è§‚å¯Ÿè€…çš„å¤„ç†ï¼Œè¿™ç§å¤„ç†æ–¹å¼æ¯”è¾ƒç›´æ¥ç²—æš´ï¼Œä½†æ˜¯ä¼šé€ æˆä»£ç çš„å†—ä½™ã€‚

è€Œå‘å¸ƒè®¢é˜…æ¨¡å¼ä¸­ç»Ÿä¸€ç”±è°ƒåº¦ä¸­å¿ƒè¿›è¡Œå¤„ç†ï¼Œè®¢é˜…è€…å’Œå‘å¸ƒè€…äº’ä¸å¹²æ‰°ï¼Œæ¶ˆé™¤äº†å‘å¸ƒè€…å’Œè®¢é˜…è€…ä¹‹é—´çš„ä¾èµ–ã€‚è¿™æ ·ä¸€æ–¹é¢å®ç°äº†è§£è€¦ï¼Œè¿˜æœ‰å°±æ˜¯å¯ä»¥å®ç°æ›´ç»†ç²’åº¦çš„ä¸€äº›æ§åˆ¶ã€‚æ¯”å¦‚å‘å¸ƒè€…å‘å¸ƒäº†å¾ˆå¤šæ¶ˆæ¯ï¼Œä½†æ˜¯ä¸æƒ³æ‰€æœ‰çš„è®¢é˜…è€…éƒ½æ¥æ”¶åˆ°ï¼Œå°±å¯ä»¥åœ¨è°ƒåº¦ä¸­å¿ƒåšä¸€äº›å¤„ç†ï¼Œç±»ä¼¼äºæƒé™æ§åˆ¶ä¹‹ç±»çš„ã€‚è¿˜å¯ä»¥åšä¸€äº›èŠ‚æµæ“ä½œã€‚



### JDK

- [java.util.Observer](http://docs.oracle.com/javase/8/docs/api/java/util/Observer.html)
- [java.util.EventListener](http://docs.oracle.com/javase/8/docs/api/java/util/EventListener.html)
- [javax.servlet.http.HttpSessionBindingListener](http://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpSessionBindingListener.html)
- [RxJava](https://github.com/ReactiveX/RxJava)



## 8 çŠ¶æ€

### Intent

å…è®¸å¯¹è±¡åœ¨å†…éƒ¨çŠ¶æ€æ”¹å˜æ—¶æ”¹å˜å®ƒçš„è¡Œä¸ºï¼Œå¯¹è±¡çœ‹èµ·æ¥å¥½åƒä¿®æ”¹äº†å®ƒæ‰€å±çš„ç±»ã€‚

çŠ¶æ€æ¨¡å¼æœ€ä¸»è¦çš„å¥½å¤„å°±æ˜¯æŠŠçŠ¶æ€çš„åˆ¤æ–­ä¸æ§åˆ¶æ”¾åˆ°äº†å…¶æœåŠ¡ç«¯çš„å†…éƒ¨ï¼Œä½¿å¾—å®¢æˆ·ç«¯ä¸éœ€è¦å»å†™å¾ˆå¤šä»£ç åˆ¤æ–­ï¼Œæ¥æ§åˆ¶è‡ªå·±çš„èŠ‚ç‚¹è·³è½¬ï¼Œè€Œä¸”è¿™æ ·å®ç°çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ¯ä¸ªèŠ‚ç‚¹éƒ½åˆ†å¼€æ¥å¤„ç†ï¼Œå½“æµç¨‹æµè½¬åˆ°æŸä¸ªèŠ‚ç‚¹çš„æ—¶å€™ï¼Œå¯ä»¥å»å†™è‡ªå·±çš„èŠ‚ç‚¹æµè½¬æ–¹æ³•ã€‚å½“ç„¶çŠ¶æ€æ¨¡å¼çš„ç¼ºç‚¹ä¹Ÿå¾ˆå¤šï¼Œæ¯”å¦‚ç±»çš„è€¦åˆåº¦æ¯”è¾ƒé«˜ï¼ŒåŸºæœ¬ä¸Šä¸‰ä¸ªç±»è¦åŒæ—¶å»å†™ï¼Œè€Œä¸”ä¼šåˆ›å»ºå¾ˆå¤šçš„èŠ‚ç‚¹ç±»ã€‚



åº”ç”¨åœºæ™¯ï¼šç°åœ¨é‡åˆ°äº†è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼šè¦å°†ä¸€ç³»åˆ—æ“ä½œè‡ªåŠ¨åŒ–ï¼Œå…¶ä¸­æ¶‰åŠåˆ°ä¸€äº›çŠ¶æ€ä»¥åŠçŠ¶æ€çš„è½¬ç§»ã€‚çŠ¶æ€æœ‰4ç§ï¼šåˆå§‹çŠ¶æ€0ï¼Œç¬¬ä¸€æ­¥Aï¼Œç¬¬äºŒæ­¥Bï¼Œç¬¬ä¸‰æ­¥Cã€‚å…¶ä¸­è¿™å‡ ä¸ªçŠ¶æ€é—´çš„è½¬ç§»å…³ç³»å°±ç•¥å»äº†ï¼ŒæŠ½è±¡å‡ºæ¥æ˜¯è¿™æ ·çš„ï¼šæ— è®ºä»å“ªç§çŠ¶æ€è½¬ç§»åˆ°ç›®æ ‡çŠ¶æ€ï¼Œåšå‡ºçš„è¡Œä¸ºéƒ½æ˜¯è¡¨ç¤ºâ€œåˆ°ç›®æ ‡çŠ¶æ€â€æ‰€åšçš„è¡Œä¸ºï¼Œå³ä¸ä¸Šä¸€æ­¥çŠ¶æ€æ— å…³ï¼Œåªä¸ç›®æ ‡çŠ¶æ€æœ‰å…³ã€‚

æåˆ°çŠ¶æ€æ¨¡å¼ï¼Œè®©æˆ‘æƒ³åˆ°äº†å·¥ä½œæµï¼Œå·¥ä½œæµå°±æ˜¯æ§åˆ¶ä¸€ä¸ªä¸€ä¸ªçš„èŠ‚ç‚¹çŠ¶æ€æ¥å®ç°èŠ‚ç‚¹çš„è·³è½¬ï¼Œæœ€åæ¥æ§åˆ¶æµç¨‹ã€‚ 

 ![](./assets/1.18.png)



### Class Diagram

 ![](./assets/1.15.png)

### Implementation

ç³–æœé”€å”®æœºæœ‰å¤šç§çŠ¶æ€ï¼Œæ¯ç§çŠ¶æ€ä¸‹é”€å”®æœºæœ‰ä¸åŒçš„è¡Œä¸ºï¼ŒçŠ¶æ€å¯ä»¥å‘ç”Ÿè½¬ç§»ï¼Œä½¿å¾—é”€å”®æœºçš„è¡Œä¸ºä¹Ÿå‘ç”Ÿæ”¹å˜ã€‚

![](./assets/1.16.jpg)



```java
public interface State {
    /**
     * æŠ•å…¥ 25 åˆ†é’±
     */
    void insertQuarter();

    /**
     * é€€å› 25 åˆ†é’±
     */
    void ejectQuarter();

    /**
     * è½¬åŠ¨æ›²æŸ„
     */
    void turnCrank();

    /**
     * å‘æ”¾ç³–æœ
     */
    void dispense();
}
```



```java
public class GumballMachine {
private State soldOutState;
private State noQuarterState;
private State hasQuarterState;
private State soldState;

private State state;
private int count = 0;

public GumballMachine(int numberGumballs) {
    count = numberGumballs;
    soldOutState = new SoldOutState(this);
    noQuarterState = new NoQuarterState(this);
    hasQuarterState = new HasQuarterState(this);
    soldState = new SoldState(this);

    if (numberGumballs > 0) {
        state = noQuarterState;
    } else {
        state = soldOutState;
    }
}

public void insertQuarter() {
    state.insertQuarter();
}

public void ejectQuarter() {
    state.ejectQuarter();
}

public void turnCrank() {
    state.turnCrank();
    state.dispense();
}

public void setState(State state) {
    this.state = state;
}

public void releaseBall() {
    System.out.println("A gumball comes rolling out the slot...");
    if (count != 0) {
        count -= 1;
    }
}

public State getSoldOutState() {
    return soldOutState;
}

public State getNoQuarterState() {
    return noQuarterState;
}

public State getHasQuarterState() {
    return hasQuarterState;
}

public State getSoldState() {
    return soldState;
}

public int getCount() {
    return count;
}
}
```



```java
public class HasQuarterState implements State {

    private GumballMachine gumballMachine;

    public HasQuarterState(GumballMachine gumballMachine) {
        this.gumballMachine = gumballMachine;
    }

    @Override
    public void insertQuarter() {
        System.out.println("You can't insert another quarter");
    }

    @Override
    public void ejectQuarter() {
        System.out.println("Quarter returned");
        gumballMachine.setState(gumballMachine.getNoQuarterState());
    }

    @Override
    public void turnCrank() {
        System.out.println("You turned...");
        gumballMachine.setState(gumballMachine.getSoldState());
    }

    @Override
    public void dispense() {
        System.out.println("No gumball dispensed");
    }
}
```

```java
public class NoQuarterState implements State {

    GumballMachine gumballMachine;

    public NoQuarterState(GumballMachine gumballMachine) {
        this.gumballMachine = gumballMachine;
    }

    @Override
    public void insertQuarter() {
        System.out.println("You insert a quarter");
        gumballMachine.setState(gumballMachine.getHasQuarterState());
    }

    @Override
    public void ejectQuarter() {
        System.out.println("You haven't insert a quarter");
    }

    @Override
    public void turnCrank() {
        System.out.println("You turned, but there's no quarter");
    }

    @Override
    public void dispense() {
        System.out.println("You need to pay first");
    }
}
```

```java
public class SoldOutState implements State {

    GumballMachine gumballMachine;

    public SoldOutState(GumballMachine gumballMachine) {
        this.gumballMachine = gumballMachine;
    }

    @Override
    public void insertQuarter() {
        System.out.println("You can't insert a quarter, the machine is sold out");
    }

    @Override
    public void ejectQuarter() {
        System.out.println("You can't eject, you haven't inserted a quarter yet");
    }

    @Override
    public void turnCrank() {
        System.out.println("You turned, but there are no gumballs");
    }

    @Override
    public void dispense() {
        System.out.println("No gumball dispensed");
    }
}
```

```java
public class SoldState implements State {

    GumballMachine gumballMachine;

    public SoldState(GumballMachine gumballMachine) {
        this.gumballMachine = gumballMachine;
    }

    @Override
    public void insertQuarter() {
        System.out.println("Please wait, we're already giving you a gumball");
    }

    @Override
    public void ejectQuarter() {
        System.out.println("Sorry, you already turned the crank");
    }

    @Override
    public void turnCrank() {
        System.out.println("Turning twice doesn't get you another gumball!");
    }

    @Override
    public void dispense() {
        gumballMachine.releaseBall();
        if (gumballMachine.getCount() > 0) {
            gumballMachine.setState(gumballMachine.getNoQuarterState());
        } else {
            System.out.println("Oops, out of gumballs");
            gumballMachine.setState(gumballMachine.getSoldOutState());
        }
    }
}
```



```java
public class Client {

    public static void main(String[] args) {
        GumballMachine gumballMachine = new GumballMachine(5);

        gumballMachine.insertQuarter();
        gumballMachine.turnCrank();

        gumballMachine.insertQuarter();
        gumballMachine.ejectQuarter();
        gumballMachine.turnCrank();

        gumballMachine.insertQuarter();
        gumballMachine.turnCrank();
        gumballMachine.insertQuarter();
        gumballMachine.turnCrank();
        gumballMachine.ejectQuarter();

        gumballMachine.insertQuarter();
        gumballMachine.insertQuarter();
        gumballMachine.turnCrank();
        gumballMachine.insertQuarter();
        gumballMachine.turnCrank();
        gumballMachine.insertQuarter();
        gumballMachine.turnCrank();
    }
}
```

```html
You insert a quarter
You turned...
A gumball comes rolling out the slot...
You insert a quarter
Quarter returned
You turned, but there's no quarter
You need to pay first
You insert a quarter
You turned...
A gumball comes rolling out the slot...
You insert a quarter
You turned...
A gumball comes rolling out the slot...
You haven't insert a quarter
You insert a quarter
You can't insert another quarter
You turned...
A gumball comes rolling out the slot...
You insert a quarter
You turned...
A gumball comes rolling out the slot...
Oops, out of gumballs
You can't insert a quarter, the machine is sold out
You turned, but there are no gumballs
No gumball dispensed
```



## 9 ç­–ç•¥

### Intent

å®šä¹‰ä¸€ç³»åˆ—ç®—æ³•ï¼Œå°è£…æ¯ä¸ªç®—æ³•ï¼Œå¹¶ä½¿å®ƒä»¬å¯ä»¥äº’æ¢ã€‚

ç­–ç•¥æ¨¡å¼å¯ä»¥è®©ç®—æ³•ç‹¬ç«‹äºä½¿ç”¨å®ƒçš„å®¢æˆ·ç«¯ã€‚

### Class Diagram

- Strategy æ¥å£å®šä¹‰äº†ä¸€ä¸ªç®—æ³•æ—ï¼Œå®ƒä»¬éƒ½å®ç°äº†  behavior() æ–¹æ³•ã€‚
- Context æ˜¯ä½¿ç”¨åˆ°è¯¥ç®—æ³•æ—çš„ç±»ï¼Œå…¶ä¸­çš„ doSomething() æ–¹æ³•ä¼šè°ƒç”¨ behavior()ï¼ŒsetStrategy(Strategy) æ–¹æ³•å¯ä»¥åŠ¨æ€åœ°æ”¹å˜ strategy å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´èƒ½åŠ¨æ€åœ°æ”¹å˜ Context æ‰€ä½¿ç”¨çš„ç®—æ³•ã€‚

![](./assets/1.19.png)



**ä¸çŠ¶æ€æ¨¡å¼çš„æ¯”è¾ƒ**

çŠ¶æ€æ¨¡å¼çš„ç±»å›¾å’Œç­–ç•¥æ¨¡å¼ç±»ä¼¼ï¼Œå¹¶ä¸”éƒ½æ˜¯èƒ½å¤ŸåŠ¨æ€æ”¹å˜å¯¹è±¡çš„è¡Œä¸ºã€‚ä½†æ˜¯çŠ¶æ€æ¨¡å¼æ˜¯é€šè¿‡çŠ¶æ€è½¬ç§»æ¥æ”¹å˜ Context æ‰€ç»„åˆçš„ State å¯¹è±¡ï¼Œè€Œç­–ç•¥æ¨¡å¼æ˜¯é€šè¿‡ Context æœ¬èº«çš„å†³ç­–æ¥æ”¹å˜ç»„åˆçš„ Strategy å¯¹è±¡ã€‚æ‰€è°“çš„çŠ¶æ€è½¬ç§»ï¼Œæ˜¯æŒ‡ Context åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ç”±äºä¸€äº›æ¡ä»¶å‘ç”Ÿæ”¹å˜è€Œä½¿å¾— State å¯¹è±¡å‘ç”Ÿæ”¹å˜ï¼Œæ³¨æ„å¿…é¡»è¦æ˜¯åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ã€‚

çŠ¶æ€æ¨¡å¼ä¸»è¦æ˜¯ç”¨æ¥è§£å†³çŠ¶æ€è½¬ç§»çš„é—®é¢˜ï¼Œå½“çŠ¶æ€å‘ç”Ÿè½¬ç§»äº†ï¼Œé‚£ä¹ˆ Context å¯¹è±¡å°±ä¼šæ”¹å˜å®ƒçš„è¡Œä¸ºï¼›è€Œç­–ç•¥æ¨¡å¼ä¸»è¦æ˜¯ç”¨æ¥å°è£…ä¸€ç»„å¯ä»¥äº’ç›¸æ›¿ä»£çš„ç®—æ³•æ—ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®éœ€è¦åŠ¨æ€åœ°å»æ›¿æ¢ Context ä½¿ç”¨çš„ç®—æ³•ã€‚

### Implementation

è®¾è®¡ä¸€ä¸ªé¸­å­ï¼Œå®ƒå¯ä»¥åŠ¨æ€åœ°æ”¹å˜å«å£°ã€‚è¿™é‡Œçš„ç®—æ³•æ—æ˜¯é¸­å­çš„å«å£°è¡Œä¸ºã€‚

```java
public interface QuackBehavior {
    void quack();
}
```

```java
public class Quack implements QuackBehavior {
    @Override
    public void quack() {
        System.out.println("quack!");
    }
}
```

```java
public class Squeak implements QuackBehavior{
    @Override
    public void quack() {
        System.out.println("squeak!");
    }
}
```

```java
public class Duck {

    private QuackBehavior quackBehavior;

    public void performQuack() {
        if (quackBehavior != null) {
            quackBehavior.quack();
        }
    }

    public void setQuackBehavior(QuackBehavior quackBehavior) {
        this.quackBehavior = quackBehavior;
    }
}
```

```java
public class Client {

    public static void main(String[] args) {
        Duck duck = new Duck();
        duck.setQuackBehavior(new Squeak());
        duck.performQuack();
        duck.setQuackBehavior(new Quack());
        duck.performQuack();
    }
}
```

```html
squeak!
quack!
```

### JDK

- java.util.Comparator#compare()
- javax.servlet.http.HttpServlet
- javax.servlet.Filter#doFilter()



## 10 æ¨¡æ¿æ–¹æ³•

### Intent

å®šä¹‰ç®—æ³•æ¡†æ¶ï¼Œå¹¶å°†ä¸€äº›æ­¥éª¤çš„å®ç°å»¶è¿Ÿåˆ°å­ç±»ã€‚

é€šè¿‡æ¨¡æ¿æ–¹æ³•ï¼Œå­ç±»å¯ä»¥é‡æ–°å®šä¹‰ç®—æ³•çš„æŸäº›æ­¥éª¤ï¼Œè€Œä¸ç”¨æ”¹å˜ç®—æ³•çš„ç»“æ„ã€‚

### Class Diagram

![](./assets/1.20.png)

### Implementation

å†²å’–å•¡å’Œå†²èŒ¶éƒ½æœ‰ç±»ä¼¼çš„æµç¨‹ï¼Œä½†æ˜¯æŸäº›æ­¥éª¤ä¼šæœ‰ç‚¹ä¸ä¸€æ ·ï¼Œè¦æ±‚å¤ç”¨é‚£äº›ç›¸åŒæ­¥éª¤çš„ä»£ç ã€‚

![](./assets/1.21.png)

```java
public abstract class CaffeineBeverage {

    final void prepareRecipe() {
        boilWater();
        brew();
        pourInCup();
        addCondiments();
    }

    abstract void brew();

    abstract void addCondiments();

    void boilWater() {
        System.out.println("boilWater");
    }

    void pourInCup() {
        System.out.println("pourInCup");
    }
}
```

```java
public class Coffee extends CaffeineBeverage {
    @Override
    void brew() {
        System.out.println("Coffee.brew");
    }

    @Override
    void addCondiments() {
        System.out.println("Coffee.addCondiments");
    }
}
```

```java
public class Tea extends CaffeineBeverage {
    @Override
    void brew() {
        System.out.println("Tea.brew");
    }

    @Override
    void addCondiments() {
        System.out.println("Tea.addCondiments");
    }
}
```

```java
public class Client {
    public static void main(String[] args) {
        CaffeineBeverage caffeineBeverage = new Coffee();
        caffeineBeverage.prepareRecipe();
        System.out.println("-----------");
        caffeineBeverage = new Tea();
        caffeineBeverage.prepareRecipe();
    }
}
```

```html
boilWater
Coffee.brew
pourInCup
Coffee.addCondiments
-----------
boilWater
Tea.brew
pourInCup
Tea.addCondiments
```

### JDK

- java.util.Collections#sort()
- java.io.InputStream#skip()
- java.io.InputStream#read()
- java.util.AbstractList#indexOf()



## 11 è®¿é—®è€…

[æ¨èåšå®¢](https://www.jianshu.com/p/1f1049d0a0f4)

### Intent

æœ€å¤æ‚çš„è®¾è®¡æ¨¡å¼ï¼Œå¹¶ä¸”ä½¿ç”¨é¢‘ç‡ä¸é«˜ï¼Œã€Šè®¾è®¡æ¨¡å¼ã€‹çš„ä½œè€…è¯„ä»·ä¸ºï¼šå¤§å¤šæƒ…å†µä¸‹ï¼Œä½ ä¸éœ€è¦ä½¿ç”¨è®¿é—®è€…æ¨¡å¼ï¼Œä½†æ˜¯ä¸€æ—¦éœ€è¦ä½¿ç”¨å®ƒæ—¶ï¼Œé‚£å°±çœŸçš„éœ€è¦ä½¿ç”¨äº†ã€‚

è®¿é—®è€…æ¨¡å¼æ˜¯ä¸€ç§å°†æ•°æ®æ“ä½œå’Œæ•°æ®ç»“æ„åˆ†ç¦»çš„è®¾è®¡æ¨¡å¼.

éœ€è¦å¯¹ä¸€ä¸ªå¯¹è±¡ç»“æ„ä¸­çš„å¯¹è±¡è¿›è¡Œå¾ˆå¤šä¸åŒçš„å¹¶ä¸”ä¸ç›¸å…³çš„æ“ä½œï¼Œè€Œéœ€è¦é¿å…è¿™äº›æ“ä½œâ€œæ±¡æŸ“â€è¿™äº›å¯¹è±¡çš„ç±»ï¼Œä¹Ÿä¸å¸Œæœ›åœ¨å¢åŠ æ–°æ“ä½œæ—¶ä¿®æ”¹è¿™äº›ç±»ã€‚ 

### Class Diagram

- Visitorï¼šè®¿é—®è€…ï¼Œä¸ºæ¯ä¸€ä¸ª ConcreteElement å£°æ˜ä¸€ä¸ª visit æ“ä½œ
- ConcreteVisitorï¼šå…·ä½“è®¿é—®è€…ï¼Œå­˜å‚¨éå†è¿‡ç¨‹ä¸­çš„ç´¯è®¡ç»“æœ
- ObjectStructureï¼šå¯¹è±¡ç»“æ„ï¼Œå¯ä»¥æ˜¯ç»„åˆç»“æ„ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªé›†åˆã€‚

![](./assets/1.22.png)

### Implementation

```java
public interface Element {
    void accept(Visitor visitor);
}
```

```java
class CustomerGroup {

    private List<Customer> customers = new ArrayList<>();

    void accept(Visitor visitor) {
        for (Customer customer : customers) {
            customer.accept(visitor);
        }
    }

    void addCustomer(Customer customer) {
        customers.add(customer);
    }
}
```

```java
public class Customer implements Element {

    private String name;
    private List<Order> orders = new ArrayList<>();

    Customer(String name) {
        this.name = name;
    }

    String getName() {
        return name;
    }

    void addOrder(Order order) {
        orders.add(order);
    }

    public void accept(Visitor visitor) {
        visitor.visit(this);
        for (Order order : orders) {
            order.accept(visitor);
        }
    }
}
```

```java
public class Order implements Element {

    private String name;
    private List<Item> items = new ArrayList();

    Order(String name) {
        this.name = name;
    }

    Order(String name, String itemName) {
        this.name = name;
        this.addItem(new Item(itemName));
    }

    String getName() {
        return name;
    }

    void addItem(Item item) {
        items.add(item);
    }

    public void accept(Visitor visitor) {
        visitor.visit(this);

        for (Item item : items) {
            item.accept(visitor);
        }
    }
}
```

```java
public class Item implements Element {

    private String name;

    Item(String name) {
        this.name = name;
    }

    String getName() {
        return name;
    }

    public void accept(Visitor visitor) {
        visitor.visit(this);
    }
}
```

```java
public interface Visitor {
    void visit(Customer customer);

    void visit(Order order);

    void visit(Item item);
}
```

```java
public class GeneralReport implements Visitor {

    private int customersNo;
    private int ordersNo;
    private int itemsNo;

    public void visit(Customer customer) {
        System.out.println(customer.getName());
        customersNo++;
    }

    public void visit(Order order) {
        System.out.println(order.getName());
        ordersNo++;
    }

    public void visit(Item item) {
        System.out.println(item.getName());
        itemsNo++;
    }

    public void displayResults() {
        System.out.println("Number of customers: " + customersNo);
        System.out.println("Number of orders:    " + ordersNo);
        System.out.println("Number of items:     " + itemsNo);
    }
}
```

```java
public class Client {
    public static void main(String[] args) {
        Customer customer1 = new Customer("customer1");
        customer1.addOrder(new Order("order1", "item1"));
        customer1.addOrder(new Order("order2", "item1"));
        customer1.addOrder(new Order("order3", "item1"));

        Order order = new Order("order_a");
        order.addItem(new Item("item_a1"));
        order.addItem(new Item("item_a2"));
        order.addItem(new Item("item_a3"));
        Customer customer2 = new Customer("customer2");
        customer2.addOrder(order);

        CustomerGroup customers = new CustomerGroup();
        customers.addCustomer(customer1);
        customers.addCustomer(customer2);

        GeneralReport visitor = new GeneralReport();
        customers.accept(visitor);
        visitor.displayResults();
    }
}
```

```html
customer1
order1
item1
order2
item1
order3
item1
customer2
order_a
item_a1
item_a2
item_a3
Number of customers: 2
Number of orders:    4
Number of items:     6
```

### JDK

- javax.lang.model.element.Element and javax.lang.model.element.ElementVisitor
- javax.lang.model.type.TypeMirror and javax.lang.model.type.TypeVisitor



## 12  ç©ºå¯¹è±¡

### Intent

ä½¿ç”¨ä»€ä¹ˆéƒ½ä¸åšçš„ç©ºå¯¹è±¡æ¥ä»£æ›¿ NULLã€‚

ä¸€ä¸ªæ–¹æ³•è¿”å› NULLï¼Œæ„å‘³ç€æ–¹æ³•çš„è°ƒç”¨ç«¯éœ€è¦å»æ£€æŸ¥è¿”å›å€¼æ˜¯å¦æ˜¯ NULLï¼Œè¿™ä¹ˆåšä¼šå¯¼è‡´éå¸¸å¤šçš„å†—ä½™çš„æ£€æŸ¥ä»£ç ã€‚å¹¶ä¸”å¦‚æœæŸä¸€ä¸ªè°ƒç”¨ç«¯å¿˜è®°äº†åšè¿™ä¸ªæ£€æŸ¥è¿”å›å€¼ï¼Œè€Œç›´æ¥ä½¿ç”¨è¿”å›çš„å¯¹è±¡ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½æŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚

### Class Diagram

![](./assets/1.23.png)

### Implementation

```java
public abstract class AbstractOperation {
    abstract void request();
}
```

```java
public class RealOperation extends AbstractOperation {
    @Override
    void request() {
        System.out.println("do something");
    }
}
```

```java
public class NullOperation extends AbstractOperation{
    @Override
    void request() {
        // do nothing
    }
}
```

```java
public class Client {
    public static void main(String[] args) {
        AbstractOperation abstractOperation = func(-1);
        abstractOperation.request();
    }

    public static AbstractOperation func(int para) {
        if (para < 0) {
            return new NullOperation();
        }
        return new RealOperation();
    }
}
```



# :mushroom: ç»“æ„å‹

## 1 é€‚é…å™¨ï¼ˆAdapterï¼‰

### Intent

è®©åŸæ¥**ä¸å…¼å®¹**çš„ä¸¤ä¸ªæ¥å£**ååŒ**å·¥ä½œ 

### Class Diagram

![](./assets/1.25.png) 

**è§’è‰²ï¼š**

- ç›®æ ‡æ¥å£ï¼šTargetï¼Œè¯¥è§’è‰²æŠŠå…¶ä»–ç±»è½¬æ¢ä¸ºæˆ‘ä»¬æœŸæœ›çš„æ¥å£
- è¢«é€‚é…è€…: Adaptee åŸæœ‰çš„æ¥å£ï¼Œä¹Ÿæ˜¯å¸Œæœ›è¢«æ”¹å˜çš„æ¥å£
- **é€‚é…å™¨**ï¼š Adapter, å°†è¢«é€‚é…è€…å’Œç›®æ ‡æ¥å£ç»„åˆåˆ°ä¸€èµ·çš„ç±»



### Implementation

é¸­å­ï¼ˆDuckï¼‰å’Œç«é¸¡ï¼ˆTurkeyï¼‰æ‹¥æœ‰ä¸åŒçš„å«å£°ï¼ŒDuck çš„å«å£°è°ƒç”¨ quack() æ–¹æ³•ï¼Œè€Œ Turkey è°ƒç”¨ gobble() æ–¹æ³•ã€‚

è¦æ±‚å°† Turkey çš„ gobble() æ–¹æ³•é€‚é…æˆ Duck çš„ quack() æ–¹æ³•ï¼Œä»è€Œè®©ç«é¸¡å†’å……é¸­å­ï¼

```java
public interface Duck {
    void quack();
}
```

```java
public interface Turkey {
    void gobble();
}
```

```java
public class WildTurkey implements Turkey {
    @Override
    public void gobble() {
        System.out.println("gobble!");
    }
}
```

```java
public class TurkeyAdapter implements Duck {
    Turkey turkey;

    public TurkeyAdapter(Turkey turkey) {
        this.turkey = turkey;
    }

    @Override
    public void quack() {
        turkey.gobble();
    }
}
```

```java
public class Client {
    public static void main(String[] args) {
        Turkey turkey = new WildTurkey();
        Duck duck = new TurkeyAdapter(turkey);
        duck.quack();
    }
}
```

### JDK

- [java.util.Arrays#asList()](http://docs.oracle.com/javase/8/docs/api/java/util/Arrays.html#asList%28T...%29)
- [java.util.Collections#list()](https://docs.oracle.com/javase/8/docs/api/java/util/Collections.html#list-java.util.Enumeration-)
- [java.util.Collections#enumeration()](https://docs.oracle.com/javase/8/docs/api/java/util/Collections.html#enumeration-java.util.Collection-)
- [javax.xml.bind.annotation.adapters.XMLAdapter](http://docs.oracle.com/javase/8/docs/api/javax/xml/bind/annotation/adapters/XmlAdapter.html#marshal-BoundType-)



## 2 æ¡¥æ¥ï¼ˆBridgeï¼‰

[æ¨èåšå®¢](https://www.cnblogs.com/WindSun/p/10260547.html)

### Intent

å°†æŠ½è±¡ä¸å®ç°åˆ†ç¦»å¼€æ¥ï¼Œä½¿å®ƒä»¬å¯ä»¥ç‹¬ç«‹å˜åŒ–ã€‚

   è®¾æƒ³å¦‚æœè¦ç»˜åˆ¶çŸ©å½¢ã€åœ†å½¢ã€æ¤­åœ†ã€æ­£æ–¹å½¢ï¼Œæˆ‘ä»¬è‡³å°‘éœ€è¦4ä¸ªå½¢çŠ¶ç±»ï¼Œä½†æ˜¯å¦‚æœç»˜åˆ¶çš„å›¾å½¢éœ€è¦å…·æœ‰ä¸åŒçš„é¢œè‰²ï¼Œå¦‚çº¢è‰²ã€ç»¿è‰²ã€è“è‰²ç­‰ï¼Œæ­¤æ—¶è‡³å°‘æœ‰å¦‚ä¸‹ä¸¤ç§è®¾è®¡æ–¹æ¡ˆï¼š

â€‹        â€¢ ç¬¬ä¸€ç§è®¾è®¡æ–¹æ¡ˆæ˜¯ä¸ºæ¯ä¸€ç§å½¢çŠ¶éƒ½æä¾›ä¸€å¥—å„ç§é¢œè‰²çš„ç‰ˆæœ¬ã€‚

![](./assets/1.28.png)

â€‹        â€¢ ç¬¬äºŒç§è®¾è®¡æ–¹æ¡ˆæ˜¯æ ¹æ®å®é™…éœ€è¦å¯¹å½¢çŠ¶å’Œé¢œè‰²è¿›è¡Œç»„åˆã€‚

![](./assets/1.29.png)

â€‹    å¯¹äºæœ‰ä¸¤ä¸ªå˜åŒ–ç»´åº¦ï¼ˆå³ä¸¤ä¸ªå˜åŒ–çš„åŸå› ï¼‰çš„ç³»ç»Ÿï¼Œé‡‡ç”¨æ–¹æ¡ˆäºŒæ¥è¿›è¡Œè®¾è®¡ç³»ç»Ÿä¸­ç±»çš„ä¸ªæ•°æ›´å°‘ï¼Œä¸”ç³»ç»Ÿæ‰©å±•æ›´ä¸ºæ–¹ä¾¿ã€‚è®¾è®¡æ–¹æ¡ˆäºŒå³æ˜¯æ¡¥æ¥æ¨¡å¼çš„åº”ç”¨ã€‚æ¡¥æ¥æ¨¡å¼å°†ç»§æ‰¿å…³ç³»è½¬æ¢ä¸ºå…³è”å…³ç³»ï¼Œä»è€Œé™ä½äº†ç±»ä¸ç±»ä¹‹é—´çš„è€¦åˆï¼Œå‡å°‘äº†ä»£ç ç¼–å†™é‡ã€‚



**ä¼˜ç¼ºç‚¹ï¼š**

**ä¼˜ç‚¹**

â€‹    â€¢ åˆ†ç¦»æŠ½è±¡æ¥å£åŠå…¶å®ç°éƒ¨åˆ†ã€‚

â€‹    â€¢ æ¡¥æ¥æ¨¡å¼æœ‰æ—¶ç±»ä¼¼äºå¤šç»§æ‰¿æ–¹æ¡ˆï¼Œä½†æ˜¯å¤šç»§æ‰¿æ–¹æ¡ˆè¿èƒŒäº†ç±»çš„å•ä¸€èŒè´£åŸåˆ™ï¼ˆå³ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå˜åŒ–çš„åŸå› ï¼‰ï¼Œå¤ç”¨æ€§æ¯”è¾ƒå·®ï¼Œè€Œä¸”å¤šç»§æ‰¿ç»“æ„ä¸­ç±»çš„ä¸ªæ•°éå¸¸åºå¤§ï¼Œæ¡¥æ¥æ¨¡å¼æ˜¯æ¯”å¤šç»§æ‰¿æ–¹æ¡ˆæ›´å¥½çš„è§£å†³æ–¹æ³•ã€‚

â€‹    â€¢ æ¡¥æ¥æ¨¡å¼æé«˜äº†ç³»ç»Ÿçš„å¯æ‰©å……æ€§ï¼Œåœ¨ä¸¤ä¸ªå˜åŒ–ç»´åº¦ä¸­ä»»æ„æ‰©å±•ä¸€ä¸ªç»´åº¦ï¼Œéƒ½ä¸éœ€è¦ä¿®æ”¹åŸæœ‰ç³»ç»Ÿã€‚

â€‹    â€¢ å®ç°ç»†èŠ‚å¯¹å®¢æˆ·é€æ˜ï¼Œå¯ä»¥å¯¹ç”¨æˆ·éšè—å®ç°ç»†èŠ‚ã€‚

**ç¼ºç‚¹**

â€‹    â€¢ æ¡¥æ¥æ¨¡å¼çš„å¼•å…¥ä¼šå¢åŠ ç³»ç»Ÿçš„ç†è§£ä¸è®¾è®¡éš¾åº¦ï¼Œç”±äºèšåˆå…³è”å…³ç³»å»ºç«‹åœ¨æŠ½è±¡å±‚ï¼Œè¦æ±‚å¼€å‘è€…é’ˆå¯¹æŠ½è±¡è¿›è¡Œè®¾è®¡ä¸ç¼–ç¨‹ã€‚

â€‹    â€¢ æ¡¥æ¥æ¨¡å¼è¦æ±‚æ­£ç¡®è¯†åˆ«å‡ºç³»ç»Ÿä¸­ä¸¤ä¸ªç‹¬ç«‹å˜åŒ–çš„ç»´åº¦ï¼Œå› æ­¤å…¶ä½¿ç”¨èŒƒå›´å…·æœ‰ä¸€å®šçš„å±€é™æ€§ã€‚



**åº”ç”¨åœºæ™¯ï¼š**

  (1) Javaè¯­è¨€é€šè¿‡Javaè™šæ‹Ÿæœºå®ç°äº†å¹³å°çš„æ— å…³æ€§ã€‚

![](./assets/1.30.png)

   (2) JDBCé©±åŠ¨ç¨‹åºä¹Ÿæ˜¯æ¡¥æ¥æ¨¡å¼çš„åº”ç”¨ä¹‹ä¸€ã€‚ä½¿ç”¨JDBCé©±åŠ¨ç¨‹åºçš„åº”ç”¨ç³»ç»Ÿå°±æ˜¯æŠ½è±¡è§’è‰²ï¼Œè€Œæ‰€ä½¿ç”¨çš„æ•°æ®åº“æ˜¯å®ç°è§’è‰²ã€‚ä¸€ä¸ªJDBCé©±åŠ¨ç¨‹åºå¯ä»¥åŠ¨æ€åœ°å°†ä¸€ä¸ªç‰¹å®šç±»å‹çš„æ•°æ®åº“ä¸ä¸€ä¸ªJavaåº”ç”¨ç¨‹åºç»‘å®šåœ¨ä¸€èµ·ï¼Œä»è€Œå®ç°æŠ½è±¡è§’è‰²ä¸å®ç°è§’è‰²çš„åŠ¨æ€è€¦åˆã€‚ 



### Class Diagram

- Abstractionï¼šå®šä¹‰æŠ½è±¡ç±»çš„æ¥å£
- Implementorï¼šå®šä¹‰å®ç°ç±»æ¥å£

 ![](./assets/1.27.png)

### Implementation

RemoteControl è¡¨ç¤ºé¥æ§å™¨ï¼ŒæŒ‡ä»£ Abstractionã€‚

TV è¡¨ç¤ºç”µè§†ï¼ŒæŒ‡ä»£ Implementorã€‚

æ¡¥æ¥æ¨¡å¼å°†é¥æ§å™¨å’Œç”µè§†åˆ†ç¦»å¼€æ¥ï¼Œä»è€Œå¯ä»¥ç‹¬ç«‹æ”¹å˜é¥æ§å™¨æˆ–è€…ç”µè§†çš„å®ç°ã€‚

```java
public abstract class TV {
    public abstract void on();

    public abstract void off();

    public abstract void tuneChannel();
}
```

```java
public class Sony extends TV {
    @Override
    public void on() {
        System.out.println("Sony.on()");
    }

    @Override
    public void off() {
        System.out.println("Sony.off()");
    }

    @Override
    public void tuneChannel() {
        System.out.println("Sony.tuneChannel()");
    }
}
```

```java
public class RCA extends TV {
    @Override
    public void on() {
        System.out.println("RCA.on()");
    }

    @Override
    public void off() {
        System.out.println("RCA.off()");
    }

    @Override
    public void tuneChannel() {
        System.out.println("RCA.tuneChannel()");
    }
}
```

```java
public abstract class RemoteControl {
    protected TV tv;

    public RemoteControl(TV tv) {
        this.tv = tv;
    }

    public abstract void on();

    public abstract void off();

    public abstract void tuneChannel();
}
```

```java
public class ConcreteRemoteControl1 extends RemoteControl {
    public ConcreteRemoteControl1(TV tv) {
        super(tv);
    }

    @Override
    public void on() {
        System.out.println("ConcreteRemoteControl1.on()");
        tv.on();
    }

    @Override
    public void off() {
        System.out.println("ConcreteRemoteControl1.off()");
        tv.off();
    }

    @Override
    public void tuneChannel() {
        System.out.println("ConcreteRemoteControl1.tuneChannel()");
        tv.tuneChannel();
    }
}
```

```java
public class ConcreteRemoteControl2 extends RemoteControl {
    public ConcreteRemoteControl2(TV tv) {
        super(tv);
    }

    @Override
    public void on() {
        System.out.println("ConcreteRemoteControl2.on()");
        tv.on();
    }

    @Override
    public void off() {
        System.out.println("ConcreteRemoteControl2.off()");
        tv.off();
    }

    @Override
    public void tuneChannel() {
        System.out.println("ConcreteRemoteControl2.tuneChannel()");
        tv.tuneChannel();
    }
}
```

```java
public class Client {
    public static void main(String[] args) {
        RemoteControl remoteControl1 = new ConcreteRemoteControl1(new RCA());
        remoteControl1.on();
        remoteControl1.off();
        remoteControl1.tuneChannel();
        RemoteControl remoteControl2 = new ConcreteRemoteControl2(new Sony());
         remoteControl2.on();
         remoteControl2.off();
         remoteControl2.tuneChannel();
    }
}
```

### JDK

- AWT (It provides an abstraction layer which maps onto the native OS the windowing support.)
- JDBC



## 3 ç»„åˆï¼ˆCompositeï¼‰

### Intent

 ç»„åˆæ¨¡å¼å…è®¸ç”¨æˆ·å°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„æ¥è¡¨ç°â€œæ•´ä½“/éƒ¨åˆ†â€çš„å±‚æ¬¡ç»“æ„ï¼Œä»è€Œèƒ½å¤Ÿä»¥ä¸€è‡´çš„æ–¹å¼å¤„ç†å•ä¸ªå¯¹è±¡ä»¥åŠå¯¹è±¡ç»„åˆã€‚å¦‚åœ¨Swingä¸­ï¼Œå®¹å™¨Containerå’Œç»„ä»¶å¦‚Buttonã€JLabelç­‰ç­‰ä¹‹é—´çš„å…³ç³»å°±æ˜¯ç»„åˆå…³ç³»ï¼Œä¸€ä¸ªå®¹å™¨ä¸­æœ‰å¤šä¸ªç»„ä»¶ï¼Œç»„åˆæ¨¡å¼æ›´å½¢è±¡çš„è¯´å°±æ˜¯ä¸€æ£µæ ‘ï¼Œæè¿°çš„æ—¶éƒ¨åˆ†-æ•´ä½“çš„å…³ç³»ã€‚ 



### Class Diagram

ç»„ä»¶ï¼ˆComponentï¼‰ç±»æ˜¯ç»„åˆç±»ï¼ˆCompositeï¼‰å’Œå¶å­ç±»ï¼ˆLeafï¼‰çš„çˆ¶ç±»ï¼Œ**å¯ä»¥æŠŠç»„åˆç±»çœ‹æˆæ˜¯æ ‘çš„ä¸­é—´èŠ‚ç‚¹**ã€‚

**ç»„åˆå¯¹è±¡æ‹¥æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªç»„ä»¶å¯¹è±¡**ï¼Œå› æ­¤ç»„åˆå¯¹è±¡çš„æ“ä½œå¯ä»¥å§”æ‰˜ç»™ç»„ä»¶å¯¹è±¡å»å¤„ç†ï¼Œè€Œç»„ä»¶å¯¹è±¡å¯ä»¥æ˜¯å¦ä¸€ä¸ªç»„åˆå¯¹è±¡æˆ–è€…å¶å­å¯¹è±¡ã€‚

![](./assets/1.31.png)

### Implementation

```java
public abstract class Component {
    protected String name;

    public Component(String name) {
        this.name = name;
    }

    public void print() {
        print(0);
    }

    abstract void print(int level);

    abstract public void add(Component component);

    abstract public void remove(Component component);
}
```

```java
public class Composite extends Component {

    private List<Component> child;

    public Composite(String name) {
        super(name);
        child = new ArrayList<>();
    }

    @Override
    void print(int level) {
        for (int i = 0; i < level; i++) {
            System.out.print("--");
        }
        System.out.println("Composite:" + name);
        for (Component component : child) {
            component.print(level + 1);
        }
    }

    @Override
    public void add(Component component) {
        child.add(component);
    }

    @Override
    public void remove(Component component) {
        child.remove(component);
    }
}
```

```java
public class Leaf extends Component {
    public Leaf(String name) {
        super(name);
    }

    @Override
    void print(int level) {
        for (int i = 0; i < level; i++) {
            System.out.print("--");
        }
        System.out.println("left:" + name);
    }

    @Override
    public void add(Component component) {
        throw new UnsupportedOperationException(); // ç‰ºç‰²é€æ˜æ€§æ¢å–å•ä¸€èŒè´£åŸåˆ™ï¼Œè¿™æ ·å°±ä¸ç”¨è€ƒè™‘æ˜¯å¶å­èŠ‚ç‚¹è¿˜æ˜¯ç»„åˆèŠ‚ç‚¹
    }

    @Override
    public void remove(Component component) {
        throw new UnsupportedOperationException();
    }
}
```

```java
public class Client {
    public static void main(String[] args) {
        Composite root = new Composite("root");
        Component node1 = new Leaf("1");
        Component node2 = new Composite("2");
        Component node3 = new Leaf("3");
        root.add(node1);
        root.add(node2);
        root.add(node3);
        Component node21 = new Leaf("21");
        Component node22 = new Composite("22");
        node2.add(node21);
        node2.add(node22);
        Component node221 = new Leaf("221");
        node22.add(node221);
        root.print();
    }
}
```

```html
Composite:root
--left:1
--Composite:2
----left:21
----Composite:22
------left:221
--left:3
```

### JDK

- javax.swing.JComponent#add(Component)
- java.awt.Container#add(Component)
- java.util.Map#putAll(Map)
- java.util.List#addAll(Collection)
- java.util.Set#addAll(Collection)



## 4. è£…é¥°/åŒ…è£…ï¼ˆDecoratorï¼‰

### Intent

ä¸ºå¯¹è±¡åŠ¨æ€æ·»åŠ åŠŸèƒ½ã€‚

### Class Diagram

è£…é¥°è€…ï¼ˆDecoratorï¼‰å’Œå…·ä½“ç»„ä»¶ï¼ˆConcreteComponentï¼‰éƒ½ç»§æ‰¿è‡ªç»„ä»¶ï¼ˆComponentï¼‰ï¼Œå…·ä½“ç»„ä»¶çš„æ–¹æ³•å®ç°ä¸éœ€è¦ä¾èµ–äºå…¶å®ƒå¯¹è±¡ï¼Œè€Œè£…é¥°è€…ç»„åˆäº†ä¸€ä¸ªç»„ä»¶ï¼Œè¿™æ ·å®ƒå¯ä»¥è£…é¥°å…¶å®ƒè£…é¥°è€…æˆ–è€…å…·ä½“ç»„ä»¶ã€‚æ‰€è°“è£…é¥°ï¼Œå°±æ˜¯æŠŠè¿™ä¸ªè£…é¥°è€…å¥—åœ¨è¢«è£…é¥°è€…ä¹‹ä¸Šï¼Œä»è€ŒåŠ¨æ€æ‰©å±•è¢«è£…é¥°è€…çš„åŠŸèƒ½ã€‚è£…é¥°è€…çš„æ–¹æ³•æœ‰ä¸€éƒ¨åˆ†æ˜¯è‡ªå·±çš„ï¼Œè¿™å±äºå®ƒçš„åŠŸèƒ½ï¼Œç„¶åè°ƒç”¨è¢«è£…é¥°è€…çš„æ–¹æ³•å®ç°ï¼Œä»è€Œä¹Ÿä¿ç•™äº†è¢«è£…é¥°è€…çš„åŠŸèƒ½ã€‚å¯ä»¥çœ‹åˆ°ï¼Œå…·ä½“ç»„ä»¶åº”å½“æ˜¯è£…é¥°å±‚æ¬¡çš„æœ€ä½å±‚ï¼Œå› ä¸ºåªæœ‰å…·ä½“ç»„ä»¶çš„æ–¹æ³•å®ç°ä¸éœ€è¦ä¾èµ–äºå…¶å®ƒå¯¹è±¡ã€‚

![](./assets/1.32.png)

### Implementation

è®¾è®¡ä¸åŒç§ç±»çš„é¥®æ–™ï¼Œé¥®æ–™å¯ä»¥æ·»åŠ é…æ–™ï¼Œæ¯”å¦‚å¯ä»¥æ·»åŠ ç‰›å¥¶ï¼Œå¹¶ä¸”æ”¯æŒåŠ¨æ€æ·»åŠ æ–°é…æ–™ã€‚æ¯å¢åŠ ä¸€ç§é…æ–™ï¼Œè¯¥é¥®æ–™çš„ä»·æ ¼å°±ä¼šå¢åŠ ï¼Œè¦æ±‚è®¡ç®—ä¸€ç§é¥®æ–™çš„ä»·æ ¼ã€‚

ä¸‹å›¾è¡¨ç¤ºåœ¨ DarkRoast é¥®æ–™ä¸Šæ–°å¢æ–°æ·»åŠ  Mocha é…æ–™ï¼Œä¹‹ååˆæ·»åŠ äº† Whip é…æ–™ã€‚DarkRoast è¢« Mocha åŒ…è£¹ï¼ŒMocha åˆè¢« Whip åŒ…è£¹ã€‚å®ƒä»¬éƒ½ç»§æ‰¿è‡ªç›¸åŒçˆ¶ç±»ï¼Œéƒ½æœ‰ cost() æ–¹æ³•ï¼Œå¤–å±‚ç±»çš„ cost() æ–¹æ³•è°ƒç”¨äº†å†…å±‚ç±»çš„ cost() æ–¹æ³•ã€‚

<div align="center"> <img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/c9cfd600-bc91-4f3a-9f99-b42f88a5bb24.jpg" width="600"/> </div><br>

```java
public interface Beverage {
    double cost();
}
```

```java
public class DarkRoast implements Beverage {
    @Override
    public double cost() {
        return 1;
    }
}
```

```java
public class HouseBlend implements Beverage {
    @Override
    public double cost() {
        return 1;
    }
}
```

```java
public abstract class CondimentDecorator implements Beverage {
    protected Beverage beverage;
}
```

```java
public class Milk extends CondimentDecorator {

    public Milk(Beverage beverage) {
        this.beverage = beverage;
    }

    @Override
    public double cost() {
        return 1 + beverage.cost();
    }
}
```

```java
public class Mocha extends CondimentDecorator {

    public Mocha(Beverage beverage) {
        this.beverage = beverage;
    }

    @Override
    public double cost() {
        return 1 + beverage.cost();
    }
}
```

```java
public class Client {

    public static void main(String[] args) {
        Beverage beverage = new HouseBlend();
        beverage = new Mocha(beverage);
        beverage = new Milk(beverage);
        System.out.println(beverage.cost());
    }
}
```

```html
3.0
```

### è®¾è®¡åŸåˆ™

ç±»åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ï¼šä¹Ÿå°±æ˜¯æ·»åŠ æ–°åŠŸèƒ½æ—¶ä¸éœ€è¦ä¿®æ”¹ä»£ç ã€‚é¥®æ–™å¯ä»¥åŠ¨æ€æ·»åŠ æ–°çš„é…æ–™ï¼Œè€Œä¸éœ€è¦å»ä¿®æ”¹é¥®æ–™çš„ä»£ç ã€‚

ä¸å¯èƒ½æŠŠæ‰€æœ‰çš„ç±»è®¾è®¡æˆéƒ½æ»¡è¶³è¿™ä¸€åŸåˆ™ï¼Œåº”å½“æŠŠè¯¥åŸåˆ™åº”ç”¨äºæœ€æœ‰å¯èƒ½å‘ç”Ÿæ”¹å˜çš„åœ°æ–¹ã€‚



### EXTENDS

è£…é¥°æ¨¡å¼åœ¨JDKä¸­æœ€ç»å…¸çš„å®ä¾‹æ˜¯Java IOã€‚



![](./assets/1.33.png)



### JDK

- java.io.BufferedInputStream(InputStream)   //æ‹¬å·é‡Œçš„æ˜¯è£…é¥°ç±»ï¼ŒBufferedInputStream æ˜¯è¢«è£…é¥°è€…
- java.io.DataInputStream(InputStream)
- java.io.BufferedOutputStream(OutputStream)
- java.util.zip.ZipOutputStream(OutputStream)
- java.util.Collections#checked[List|Map|Set|SortedSet|SortedMap]()



## 5 å¤–è§‚ï¼ˆFacadeï¼‰

### Intent

æä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ï¼Œç”¨æ¥è®¿é—®å­ç³»ç»Ÿä¸­çš„ä¸€ç¾¤æ¥å£ï¼Œä»è€Œè®©å­ç³»ç»Ÿæ›´å®¹æ˜“ä½¿ç”¨ã€‚

egï¼š

ç»„å»ºä¸€ä¸ªå®¶åº­å½±é™¢:

DVD æ’­æ”¾å™¨ã€æŠ•å½±ä»ªã€è‡ªåŠ¨å±å¹•ã€ç¯ç»•ç«‹ä½“å£°ã€çˆ†ç±³èŠ±æœº,è¦æ±‚å®Œæˆä½¿ç”¨å®¶åº­å½±é™¢çš„åŠŸèƒ½ï¼Œå…¶è¿‡ç¨‹ä¸º:

- ç›´æ¥ç”¨é¥æ§å™¨:ç»Ÿç­¹å„è®¾å¤‡å¼€å…³
- å¼€çˆ†ç±³èŠ±æœº
- æ”¾ä¸‹å±å¹•
- å¼€æŠ•å½±ä»ª
- å¼€éŸ³å“
- å¼€ DVDï¼Œé€‰ dvd
- å»æ‹¿çˆ†ç±³èŠ±
- è°ƒæš—ç¯å…‰
- æ’­æ”¾
- è§‚å½±ç»“æŸåï¼Œå…³é—­å„ç§è®¾å¤‡

![](./assets/1.34.png)



**ä½¿ç”¨å¤–è§‚æ¨¡å¼ï¼š**

![](./assets/1.35.png)





### Class Diagram

![](./assets/1.36.png)

### Implementation

è§‚çœ‹ç”µå½±éœ€è¦æ“ä½œå¾ˆå¤šç”µå™¨ï¼Œä½¿ç”¨å¤–è§‚æ¨¡å¼å®ç°ä¸€é”®çœ‹ç”µå½±åŠŸèƒ½ã€‚

```java
public class SubSystem {
    public void turnOnTV() {
        System.out.println("turnOnTV()");
    }

    public void setCD(String cd) {
        System.out.println("setCD( " + cd + " )");
    }

    public void startWatching(){
        System.out.println("startWatching()");
    }
}
```

```java
public class Facade {
    private SubSystem subSystem = new SubSystem();

    public void watchMovie() {
        subSystem.turnOnTV();
        subSystem.setCD("a movie");
        subSystem.startWatching();
    }
}
```

```java
public class Client {
    public static void main(String[] args) {
        Facade facade = new Facade();
        facade.watchMovie();
    }
}
```

### è®¾è®¡åŸåˆ™

æœ€å°‘çŸ¥è¯†åŸåˆ™ï¼šåªå’Œä½ çš„å¯†å‹è°ˆè¯ã€‚ä¹Ÿå°±æ˜¯è¯´å®¢æˆ·å¯¹è±¡æ‰€éœ€è¦äº¤äº’çš„å¯¹è±¡åº”å½“å°½å¯èƒ½å°‘ã€‚



### EXTENDS

**å¤–è§‚æ¨¡å¼åº”ç”¨äºJDBCæ•°æ®åº“æ“ä½œ** 

```java
  public class JDBCFacade {
      private Connection conn=null;
      private Statement statement=null;
      public void open(String driver,String jdbcUrl,String userName,String userPwd) {
         ......
      }
      public int executeUpdate(String sql) {
          ......
      }
     public ResultSet executeQuery(String sql) {
         ......
     }
     public void close() {
         ......
     }
 }
```





## 6. äº«å…ƒï¼ˆFlyweightï¼‰

### Intent

åˆ©ç”¨å…±äº«çš„æ–¹å¼æ¥æ”¯æŒå¤§é‡ç»†ç²’åº¦çš„å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡ä¸€éƒ¨åˆ†å†…éƒ¨çŠ¶æ€æ˜¯ç›¸åŒçš„ã€‚

### Class Diagram

- FlyweightFactoryï¼šå­˜å‚¨æ‰€æœ‰çš„ConcreteFlyerightå¯¹è±¡ã€‚å°±åƒä¸€ä¸ªå…±äº«æ± ã€‚
- Flyweightï¼šæ¥å£
- ConcreteFlyerightï¼šå…·ä½“å®ç°ç±»

![](./assets/1.37.png)

### Implementation

```java
public interface Flyweight {
    void doOperation(String extrinsicState);
}
```

```java
public class ConcreteFlyweight implements Flyweight {

    private String intrinsicState;

    public ConcreteFlyweight(String intrinsicState) {
        this.intrinsicState = intrinsicState;
    }

    @Override
    public void doOperation(String extrinsicState) {
        System.out.println("Object address: " + System.identityHashCode(this));
        System.out.println("IntrinsicState: " + intrinsicState);
        System.out.println("ExtrinsicState: " + extrinsicState);
    }
}
```

```java
public class FlyweightFactory {

    private HashMap<String, Flyweight> flyweights = new HashMap<>();

    Flyweight getFlyweight(String intrinsicState) {
        if (!flyweights.containsKey(intrinsicState)) {
            Flyweight flyweight = new ConcreteFlyweight(intrinsicState);
            flyweights.put(intrinsicState, flyweight);
        }
        return flyweights.get(intrinsicState);
    }
}
```

```java
public class Client {

    public static void main(String[] args) {
        FlyweightFactory factory = new FlyweightFactory();
        Flyweight flyweight1 = factory.getFlyweight("aa");
        Flyweight flyweight2 = factory.getFlyweight("aa");
        flyweight1.doOperation("x");
        flyweight2.doOperation("y");
    }
}
```

```html
Object address: 1163157884
IntrinsicState: aa
ExtrinsicState: x
Object address: 1163157884
IntrinsicState: aa
ExtrinsicState: y
```

### JDK

è¯´åˆ°äº«å…ƒæ¨¡å¼ï¼Œç¬¬ä¸€ä¸ªæƒ³åˆ°çš„åº”è¯¥å°±æ˜¯æ± æŠ€æœ¯äº†ï¼ŒStringå¸¸é‡æ± ã€æ•°æ®åº“è¿æ¥æ± ã€ç¼“å†²æ± ç­‰ç­‰éƒ½æ˜¯äº«å…ƒæ¨¡å¼çš„åº”ç”¨ï¼Œæ‰€ä»¥è¯´äº«å…ƒæ¨¡å¼æ˜¯æ± æŠ€æœ¯çš„é‡è¦å®ç°æ–¹å¼ã€‚ sJava åˆ©ç”¨ç¼“å­˜æ¥åŠ é€Ÿå¤§é‡å°å¯¹è±¡çš„è®¿é—®æ—¶é—´ã€‚

- java.lang.Integer#valueOf(int)
- java.lang.Boolean#valueOf(boolean)
- java.lang.Byte#valueOf(byte)
- java.lang.Character#valueOf(char)





## 7. ä»£ç†ï¼ˆProxyï¼‰

### Intent

[æ¨èåšå®¢](https://segmentfault.com/a/1190000019433930?utm_source=tag-newest)

åœ¨ç›´æ¥è®¿é—®å¯¹è±¡æ—¶å¸¦æ¥çš„é—®é¢˜ï¼Œæ¯”å¦‚è¯´ï¼šè¦è®¿é—®çš„å¯¹è±¡åœ¨è¿œç¨‹çš„æœºå™¨ä¸Šã€‚åœ¨é¢å‘å¯¹è±¡ç³»ç»Ÿä¸­ï¼Œæœ‰äº›å¯¹è±¡ç”±äºæŸäº›åŸå› ï¼ˆæ¯”å¦‚å¯¹è±¡åˆ›å»ºå¼€é”€å¾ˆå¤§ï¼Œæˆ–è€…æŸäº›æ“ä½œéœ€è¦å®‰å…¨æ§åˆ¶ï¼Œæˆ–è€…éœ€è¦è¿›ç¨‹å¤–çš„è®¿é—®ï¼‰ï¼Œç›´æ¥è®¿é—®ä¼šç»™ä½¿ç”¨è€…æˆ–è€…ç³»ç»Ÿç»“æ„å¸¦æ¥å¾ˆå¤šéº»çƒ¦ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è®¿é—®æ­¤å¯¹è±¡æ—¶åŠ ä¸Šä¸€ä¸ªå¯¹æ­¤å¯¹è±¡çš„è®¿é—®å±‚ã€‚ 



### Class Diagram

ä»£ç†æœ‰ä»¥ä¸‹å››ç±»ï¼š

- è¿œç¨‹ä»£ç†ï¼ˆRemote Proxyï¼‰ï¼šæ§åˆ¶å¯¹è¿œç¨‹å¯¹è±¡ï¼ˆä¸åŒåœ°å€ç©ºé—´ï¼‰çš„è®¿é—®ï¼Œå®ƒè´Ÿè´£å°†è¯·æ±‚åŠå…¶å‚æ•°è¿›è¡Œç¼–ç ï¼Œå¹¶å‘ä¸åŒåœ°å€ç©ºé—´ä¸­çš„å¯¹è±¡å‘é€å·²ç»ç¼–ç çš„è¯·æ±‚ã€‚
- è™šæ‹Ÿä»£ç†ï¼ˆVirtual Proxyï¼‰ï¼šæ ¹æ®éœ€è¦åˆ›å»ºå¼€é”€å¾ˆå¤§çš„å¯¹è±¡ï¼Œå®ƒå¯ä»¥ç¼“å­˜å®ä½“çš„é™„åŠ ä¿¡æ¯ï¼Œä»¥ä¾¿å»¶è¿Ÿå¯¹å®ƒçš„è®¿é—®ï¼Œä¾‹å¦‚åœ¨ç½‘ç«™åŠ è½½ä¸€ä¸ªå¾ˆå¤§å›¾ç‰‡æ—¶ï¼Œä¸èƒ½é©¬ä¸Šå®Œæˆï¼Œå¯ä»¥ç”¨è™šæ‹Ÿä»£ç†ç¼“å­˜å›¾ç‰‡çš„å¤§å°ä¿¡æ¯ï¼Œç„¶åç”Ÿæˆä¸€å¼ ä¸´æ—¶å›¾ç‰‡ä»£æ›¿åŸå§‹å›¾ç‰‡ã€‚
- ä¿æŠ¤ä»£ç†ï¼ˆProtection Proxyï¼‰ï¼šæŒ‰æƒé™æ§åˆ¶å¯¹è±¡çš„è®¿é—®ï¼Œå®ƒè´Ÿè´£æ£€æŸ¥è°ƒç”¨è€…æ˜¯å¦å…·æœ‰å®ç°ä¸€ä¸ªè¯·æ±‚æ‰€å¿…é¡»çš„è®¿é—®æƒé™ã€‚
- æ™ºèƒ½ä»£ç†ï¼ˆSmart Referenceï¼‰ï¼šå–ä»£äº†ç®€å•çš„æŒ‡é’ˆï¼Œå®ƒåœ¨è®¿é—®å¯¹è±¡æ—¶æ‰§è¡Œä¸€äº›é™„åŠ æ“ä½œï¼šè®°å½•å¯¹è±¡çš„å¼•ç”¨æ¬¡æ•°ï¼›å½“ç¬¬ä¸€æ¬¡å¼•ç”¨ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå°†å®ƒè£…å…¥å†…å­˜ï¼›åœ¨è®¿é—®ä¸€ä¸ªå®é™…å¯¹è±¡å‰ï¼Œæ£€æŸ¥æ˜¯å¦å·²ç»é”å®šäº†å®ƒï¼Œä»¥ç¡®ä¿å…¶å®ƒå¯¹è±¡ä¸èƒ½æ”¹å˜å®ƒã€‚



è§’è‰²è¯´æ˜ï¼š

* Subjectï¼šå®šä¹‰äº†RealSubjectå’ŒProxyçš„å…±ç”¨æ¥å£ï¼Œè¿™æ ·å°±åœ¨ä»»ä½•ä½¿ç”¨RealSubjectçš„åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨Porxy
* RealSubjectï¼šå®šä¹‰äº†Proxyæ‰€ä»£è¡¨çš„çš„çœŸå®å®ä½“
* Proxyï¼šä¿å­˜ä¸€ä¸ªå¼•ç”¨ä½¿å¾—ä»£ç†å¯ä»¥è®¿é—®å®ä½“ï¼Œå¹¶æä¾›ä¸€ä¸ªä¸Subjectçš„æ¥å£ç›¸åŒçš„æ¥å£ï¼Œè¿™æ ·ä»£ç†å°±å¯ä»¥ç”¨æ¥æ›¿ä»£å®ä½“



![](./assets/1.38.png)

### Implementation

ä»¥ä¸‹æ˜¯ä¸€ä¸ªè™šæ‹Ÿä»£ç†çš„å®ç°ï¼Œæ¨¡æ‹Ÿäº†å›¾ç‰‡å»¶è¿ŸåŠ è½½çš„æƒ…å†µä¸‹ä½¿ç”¨ä¸å›¾ç‰‡å¤§å°ç›¸ç­‰çš„ä¸´æ—¶å†…å®¹å»æ›¿æ¢åŸå§‹å›¾ç‰‡ï¼Œç›´åˆ°å›¾ç‰‡åŠ è½½å®Œæˆæ‰å°†å›¾ç‰‡æ˜¾ç¤ºå‡ºæ¥ã€‚

```java
public interface Image {
    void showImage();
}
```

```java
public class HighResolutionImage implements Image {

    private URL imageURL;
    private long startTime;
    private int height;
    private int width;

    public int getHeight() {
        return height;
    }

    public int getWidth() {
        return width;
    }

    public HighResolutionImage(URL imageURL) {
        this.imageURL = imageURL;
        this.startTime = System.currentTimeMillis();
        this.width = 600;
        this.height = 600;
    }

    public boolean isLoad() {
        // æ¨¡æ‹Ÿå›¾ç‰‡åŠ è½½ï¼Œå»¶è¿Ÿ 3s åŠ è½½å®Œæˆ
        long endTime = System.currentTimeMillis();
        return endTime - startTime > 3000;
    }

    @Override
    public void showImage() {
        System.out.println("Real Image: " + imageURL);
    }
}
```

```java
public class ImageProxy implements Image {

    private HighResolutionImage highResolutionImage;

    public ImageProxy(HighResolutionImage highResolutionImage) {
        this.highResolutionImage = highResolutionImage;
    }

    @Override
    public void showImage() {
        while (!highResolutionImage.isLoad()) {
            try {
                System.out.println("Temp Image: " + highResolutionImage.getWidth() + " " + highResolutionImage.getHeight());
                Thread.sleep(100);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
        highResolutionImage.showImage();
    }
}
```

```java
public class ImageViewer {

    public static void main(String[] args) throws Exception {
        String image = "http://image.jpg";
        URL url = new URL(image);
        HighResolutionImage highResolutionImage = new HighResolutionImage(url);
        ImageProxy imageProxy = new ImageProxy(highResolutionImage);
        imageProxy.showImage();
    }
}
```

### JDK

- java.lang.reflect.Proxy
- RMI
- Spring AOP

