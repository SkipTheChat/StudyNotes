>  é‡ç‚¹æŒæ¡ï¼šé€‚é…å™¨æ¨¡å¼ï¼Œè£…é¥°æ¨¡å¼ï¼Œç­–ç•¥æ¨¡å¼ï¼Œæ¨¡æ¿æ¨¡å¼ï¼Œè§‚å¯Ÿè€…æ¨¡å¼ï¼Œå•ä¾‹æ¨¡å¼ï¼Œå·¥å‚æ¨¡å¼ï¼Œä»£ç†æ¨¡å¼
>
>  springï¼šé€‚é…å™¨æ¨¡å¼ï¼ˆsprngmvcï¼‰ï¼Œä»£ç†æ¨¡å¼(AOP)ï¼Œå·¥å‚æ¨¡å¼(BeanFactory)ï¼Œå•ä¾‹æ¨¡å¼

[æ¨èåšå®¢](https://www.cnblogs.com/WindSun/category/1376525.html)



# ğŸƒ åˆ›å»ºå‹

## 1 å•ä¾‹æ¨¡å¼ï¼ˆSingletonï¼‰

å•ä¾‹æ¨¡å¼æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š  

1. å•ä¾‹ç±»åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹ã€‚  
2. å•ä¾‹ç±»å¿…é¡»è‡ªå·±åˆ›å»ºè‡ªå·±çš„å”¯ä¸€å®ä¾‹ã€‚  
3. å•ä¾‹ç±»å¿…é¡»ç»™æ‰€æœ‰å…¶ä»–å¯¹è±¡æä¾›è¿™ä¸€å®ä¾‹ã€‚ 



é€‚ç”¨åœºæ™¯ï¼š

åœ¨è®¡ç®—æœºç³»ç»Ÿä¸­ï¼Œçº¿ç¨‹æ± ã€ç¼“å­˜ã€æ—¥å¿—å¯¹è±¡ã€å¯¹è¯æ¡†ã€æ‰“å°æœºã€æ˜¾å¡çš„é©±åŠ¨ç¨‹åºå¯¹è±¡å¸¸è¢«è®¾è®¡æˆå•ä¾‹ã€‚è¿™äº›åº”ç”¨éƒ½æˆ–å¤šæˆ–å°‘å…·æœ‰èµ„æºç®¡ç†å™¨çš„åŠŸèƒ½ã€‚



### 

### 1.1 æ‡’æ±‰å¼

#### 1.1.1 çº¿ç¨‹ä¸å®‰å…¨

ä»¥ä¸‹å®ç°ä¸­ï¼Œç§æœ‰é™æ€å˜é‡ singleè¢«å»¶è¿Ÿå®ä¾‹åŒ–ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œå¦‚æœæ²¡æœ‰ç”¨åˆ°è¯¥ç±»ï¼Œé‚£ä¹ˆå°±ä¸ä¼šå®ä¾‹åŒ– singleï¼Œä»è€ŒèŠ‚çº¦èµ„æºã€‚

è¿™ä¸ªå®ç°åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ˜¯ä¸å®‰å…¨çš„ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹èƒ½å¤ŸåŒæ—¶è¿›å…¥ `if (single== null)` ï¼Œå¹¶ä¸”æ­¤æ—¶ singleä¸º nullï¼Œé‚£ä¹ˆä¼šæœ‰å¤šä¸ªçº¿ç¨‹æ‰§è¡Œ `single= new Singleton();` è¯­å¥ï¼Œè¿™å°†å¯¼è‡´å®ä¾‹åŒ–å¤šæ¬¡ Singletonã€‚

```java
public class Singleton {
    private static Singleton single=null;
    private Singleton() {}
    //é™æ€å·¥å‚æ–¹æ³• 
    public static Singleton getInstance() {
         if (single == null) {  
             single = new Singleton();
         }  
        return single;
    }
}
```



#### 1.1.2 synchronized-çº¿ç¨‹å®‰å…¨

ä½†æ˜¯å½“ä¸€ä¸ªçº¿ç¨‹è¿›å…¥è¯¥æ–¹æ³•ä¹‹åï¼Œå…¶å®ƒè¯•å›¾è¿›å…¥è¯¥æ–¹æ³•çš„çº¿ç¨‹éƒ½å¿…é¡»ç­‰å¾…ï¼Œå³ä½¿ singleå·²ç»è¢«å®ä¾‹åŒ–äº†ã€‚è¿™ä¼šè®©çº¿ç¨‹é˜»å¡æ—¶é—´è¿‡é•¿ï¼Œå› æ­¤è¯¥æ–¹æ³•æœ‰æ€§èƒ½é—®é¢˜ï¼Œä¸æ¨èä½¿ç”¨ã€‚

```java
public class Singleton {
    private Singleton() {}
    private static Singleton single=null;
    //é™æ€å·¥å‚æ–¹æ³• 
    public static synchronized Singleton getInstance() {
         if (single == null) {  
             single = new Singleton();
         }  
        return single;
    }
}
```



#### 1.1.3 åŒé‡æ ¡éªŒé”-çº¿ç¨‹å®‰å…¨

singleåªéœ€è¦è¢«å®ä¾‹åŒ–ä¸€æ¬¡ï¼Œä¹‹åå°±å¯ä»¥ç›´æ¥ä½¿ç”¨äº†ã€‚åŠ é”æ“ä½œåªéœ€è¦å¯¹å®ä¾‹åŒ–é‚£éƒ¨åˆ†çš„ä»£ç è¿›è¡Œï¼Œåªæœ‰å½“ singleæ²¡æœ‰è¢«å®ä¾‹åŒ–æ—¶ï¼Œæ‰éœ€è¦è¿›è¡ŒåŠ é”ã€‚

åŒé‡æ ¡éªŒé”å…ˆåˆ¤æ–­ singleæ˜¯å¦å·²ç»è¢«å®ä¾‹åŒ–ï¼Œå¦‚æœæ²¡æœ‰è¢«å®ä¾‹åŒ–ï¼Œé‚£ä¹ˆæ‰å¯¹å®ä¾‹åŒ–è¯­å¥è¿›è¡ŒåŠ é”ã€‚

```java
 public class Singleton {
    private volatile static Singleton single=null;
    private Singleton() {}
     
   public static Singleton getInstance() {
        if (single == null) {  
            synchronized (Singleton.class) {  
               if (single == null) {  
                  single = new Singleton(); 
               }  
            }  
        }  
        return single; 
    }
}
```



è€ƒè™‘ä¸‹é¢çš„å®ç°ï¼Œä¹Ÿå°±æ˜¯åªä½¿ç”¨äº†ä¸€ä¸ª if è¯­å¥ã€‚åœ¨ single== null çš„æƒ…å†µä¸‹ï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹éƒ½æ‰§è¡Œäº† if è¯­å¥ï¼Œé‚£ä¹ˆä¸¤ä¸ªçº¿ç¨‹éƒ½ä¼šè¿›å…¥ if è¯­å¥å—å†…ã€‚è™½ç„¶åœ¨ if è¯­å¥å—å†…æœ‰åŠ é”æ“ä½œï¼Œä½†æ˜¯ä¸¤ä¸ªçº¿ç¨‹éƒ½ä¼šæ‰§è¡Œ `single= new Singleton();` è¿™æ¡è¯­å¥ï¼Œåªæ˜¯å…ˆåçš„é—®é¢˜ï¼Œé‚£ä¹ˆå°±ä¼šè¿›è¡Œä¸¤æ¬¡å®ä¾‹åŒ–ã€‚å› æ­¤å¿…é¡»ä½¿ç”¨åŒé‡æ ¡éªŒé”ï¼Œä¹Ÿå°±æ˜¯éœ€è¦ä½¿ç”¨ä¸¤ä¸ª if è¯­å¥ï¼šç¬¬ä¸€ä¸ª if è¯­å¥ç”¨æ¥é¿å… singleå·²ç»è¢«å®ä¾‹åŒ–ä¹‹åçš„åŠ é”æ“ä½œï¼Œè€Œç¬¬äºŒä¸ª if è¯­å¥è¿›è¡Œäº†åŠ é”ï¼Œæ‰€ä»¥åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ï¼Œå°±ä¸ä¼šå‡ºç° single== null æ—¶ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œå®ä¾‹åŒ–æ“ä½œã€‚

```java
if (single == null) {
    synchronized (Singleton.class) {
        single = new Singleton();
    }
}
```



singleé‡‡ç”¨ **volatile** å…³é”®å­—ä¿®é¥°ä¹Ÿæ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œ `single= new Singleton();` è¿™æ®µä»£ç å…¶å®æ˜¯åˆ†ä¸ºä¸‰æ­¥æ‰§è¡Œï¼š

1. ä¸º singleåˆ†é…å†…å­˜ç©ºé—´
2. åˆå§‹åŒ– single
3. å°† singleæŒ‡å‘åˆ†é…çš„å†…å­˜åœ°å€

ä½†æ˜¯ç”±äº JVM å…·æœ‰æŒ‡ä»¤é‡æ’çš„ç‰¹æ€§ï¼Œæ‰§è¡Œé¡ºåºæœ‰å¯èƒ½å˜æˆ 1>3>2ã€‚æŒ‡ä»¤é‡æ’åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹ä¸ä¼šå‡ºç°é—®é¢˜ï¼Œä½†æ˜¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¼šå¯¼è‡´ä¸€ä¸ªçº¿ç¨‹è·å¾—è¿˜æ²¡æœ‰åˆå§‹åŒ–çš„å®ä¾‹ã€‚ä¾‹å¦‚ï¼Œçº¿ç¨‹ T1 æ‰§è¡Œäº† 1 å’Œ 3ï¼Œæ­¤æ—¶ T2 è°ƒç”¨ getInstance() åå‘ç° singleä¸ä¸ºç©ºï¼Œå› æ­¤è¿”å› singleï¼Œä½†æ­¤æ—¶ singleè¿˜æœªè¢«åˆå§‹åŒ–ã€‚

**ä½¿ç”¨ volatile å¯ä»¥ç¦æ­¢ JVM çš„æŒ‡ä»¤é‡æ’ï¼Œä¿è¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¹Ÿèƒ½æ­£å¸¸è¿è¡Œã€‚**





#### 1.1.4 é™æ€å†…éƒ¨ç±»å®ç°

å½“ Singleton ç±»è¢«åŠ è½½æ—¶ï¼Œé™æ€å†…éƒ¨ç±» LazyHolderæ²¡æœ‰è¢«åŠ è½½è¿›å†…å­˜ã€‚åªæœ‰å½“è°ƒç”¨ `getInstance()` æ–¹æ³•ä»è€Œè§¦å‘ `LazyHolder.INSTANCE` æ—¶ LazyHolder æ‰ä¼šè¢«åŠ è½½ï¼Œæ­¤æ—¶åˆå§‹åŒ– INSTANCE å®ä¾‹ï¼Œå¹¶ä¸” JVM èƒ½ç¡®ä¿ INSTANCE åªè¢«å®ä¾‹åŒ–ä¸€æ¬¡ã€‚

è¿™ç§æ–¹å¼ä¸ä»…å…·æœ‰å»¶è¿Ÿåˆå§‹åŒ–çš„å¥½å¤„ï¼Œè€Œä¸”ç”± JVM æä¾›äº†å¯¹çº¿ç¨‹å®‰å…¨çš„æ”¯æŒã€‚

>è¿™ç§æ¯”ä¸Šé¢sychronizedå’ŒåŒé‡æ£€ç´¢é”æ–¹æ³•éƒ½å¥½ä¸€äº›ï¼Œæ—¢å®ç°äº†çº¿ç¨‹å®‰å…¨ï¼Œåˆé¿å…äº†åŒæ­¥å¸¦æ¥çš„æ€§èƒ½å½±å“ã€‚ 

```java
public class Singleton {  
    private static class LazyHolder {  
       private static final Singleton INSTANCE = new Singleton();  
    }  
    private Singleton (){}  
    public static final Singleton getInstance() {  
       return LazyHolder.INSTANCE;  
    }  
}  
```

#### 



### 1.2 é¥¿æ±‰å¼-çº¿ç¨‹å®‰å…¨

çº¿ç¨‹ä¸å®‰å…¨é—®é¢˜ä¸»è¦æ˜¯ç”±äº singleè¢«å®ä¾‹åŒ–å¤šæ¬¡ï¼Œé‡‡å–ç›´æ¥å®ä¾‹åŒ– single çš„æ–¹å¼å°±ä¸ä¼šäº§ç”Ÿçº¿ç¨‹ä¸å®‰å…¨é—®é¢˜ã€‚

ä½†æ˜¯ç›´æ¥å®ä¾‹åŒ–çš„æ–¹å¼ä¹Ÿä¸¢å¤±äº†å»¶è¿Ÿå®ä¾‹åŒ–å¸¦æ¥çš„èŠ‚çº¦èµ„æºçš„å¥½å¤„ã€‚

```java
//é¥¿æ±‰å¼å•ä¾‹ç±».åœ¨ç±»åˆå§‹åŒ–æ—¶ï¼Œå·²ç»è‡ªè¡Œå®ä¾‹åŒ– 
public class Singleton1 {
    private Singleton1() {}
    private static final Singleton1 single = new Singleton1();
    //é™æ€å·¥å‚æ–¹æ³• 
    public static Singleton1 getInstance() {
        return single;
    }
}
```





### 1.3 æšä¸¾å®ç°å•ä¾‹

```java
public enum Singleton {

    INSTANCE;

    public void doSomething() {
        System.out.println("doSomething");
    }

}
```

```java
public class Main {
    public static void main(String[] args) {
        //è°ƒç”¨æ–¹æ³•
        Singleton.INSTANCE.doSomething();
    }

}
```

**è¯¥å®ç°å¯ä»¥é˜²æ­¢åå°„æ”»å‡»ã€‚æšä¸¾æ˜¯finalä¿®é¥°çš„ã€‚**





## 2 å·¥å‚æ¨¡å¼

  å·¥å‚æ¨¡å¼ä¸»è¦æ˜¯ä¸ºåˆ›å»ºå¯¹è±¡æä¾›è¿‡æ¸¡æ¥å£ï¼Œä»¥ä¾¿å°†åˆ›å»ºå¯¹è±¡çš„å…·ä½“è¿‡ç¨‹å±è”½éš”ç¦»èµ·æ¥ï¼Œè¾¾åˆ°æé«˜çµæ´»æ€§çš„ç›®çš„ã€‚ 
å·¥å‚æ¨¡å¼å¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼š 

1. ç®€å•å·¥å‚æ¨¡å¼ï¼ˆSimple Factoryï¼‰ 

2. å·¥å‚æ–¹æ³•æ¨¡å¼ï¼ˆFactory Methodï¼‰ 
3. æŠ½è±¡å·¥å‚æ¨¡å¼ï¼ˆAbstract Factoryï¼‰ 

è¿™ä¸‰ç§æ¨¡å¼ä»ä¸Šåˆ°ä¸‹é€æ­¥æŠ½è±¡ï¼Œå¹¶ä¸”æ›´å…·ä¸€èˆ¬æ€§ã€‚ 
GOFåœ¨ã€Šè®¾è®¡æ¨¡å¼ã€‹ä¸€ä¹¦ä¸­å°†å·¥å‚æ¨¡å¼åˆ†ä¸ºä¸¤ç±»ï¼šå·¥å‚æ–¹æ³•æ¨¡å¼ä¸æŠ½è±¡å·¥å‚æ¨¡å¼

å°†ç®€å•å·¥å‚æ¨¡å¼çœ‹ä¸ºå·¥å‚æ–¹æ³•æ¨¡å¼çš„ä¸€ç§ç‰¹ä¾‹ï¼Œä¸¤è€…å½’ä¸ºä¸€ç±»ã€‚ 



**åŒºåˆ« ï¼š**

* å·¥å‚æ–¹æ³•æ¨¡å¼ï¼š

  ä¸€ä¸ªæŠ½è±¡äº§å“ç±»ï¼Œå¯ä»¥æ´¾ç”Ÿå‡ºå¤šä¸ªå…·ä½“äº§å“ç±»ã€‚   
  ä¸€ä¸ªæŠ½è±¡å·¥å‚ç±»ï¼Œå¯ä»¥æ´¾ç”Ÿå‡ºå¤šä¸ªå…·ä½“å·¥å‚ç±»ã€‚   
  æ¯ä¸ªå…·ä½“å·¥å‚ç±»åªèƒ½åˆ›å»ºä¸€ä¸ªå…·ä½“äº§å“ç±»çš„å®ä¾‹ã€‚

* æŠ½è±¡å·¥å‚æ¨¡å¼ï¼š

  å¤šä¸ªæŠ½è±¡äº§å“ç±»ï¼Œæ¯ä¸ªæŠ½è±¡äº§å“ç±»å¯ä»¥æ´¾ç”Ÿå‡ºå¤šä¸ªå…·ä½“äº§å“ç±»ã€‚   
  ä¸€ä¸ªæŠ½è±¡å·¥å‚ç±»ï¼Œå¯ä»¥æ´¾ç”Ÿå‡ºå¤šä¸ªå…·ä½“å·¥å‚ç±»ã€‚   
  æ¯ä¸ªå…·ä½“å·¥å‚ç±»å¯ä»¥åˆ›å»ºå¤šä¸ªå…·ä½“äº§å“ç±»çš„å®ä¾‹ã€‚   





### 2.1 ç®€å•å·¥å‚æ¨¡å¼

### intent

ç®€å•å·¥å‚æŠŠå®ä¾‹åŒ–çš„æ“ä½œå•ç‹¬æ”¾åˆ°ä¸€ä¸ªç±»ä¸­ï¼Œè¿™ä¸ªç±»å°±æˆä¸ºç®€å•å·¥å‚ç±»ï¼Œè®©ç®€å•å·¥å‚ç±»æ¥å†³å®šåº”è¯¥ç”¨å“ªä¸ªå…·ä½“å­ç±»æ¥å®ä¾‹åŒ–ã€‚

### Class Diagram

![](../assets/1.1.png)



### Implementation

äº§å“ç±»ï¼š 

```java
abstract class BMW {
	public BMW(){
		
	}
}
```

```java
public class BMW320 extends BMW {
	public BMW320() {
		System.out.println("åˆ¶é€ -->BMW320");
	}
}
public class BMW523 extends BMW{
	public BMW523(){
		System.out.println("åˆ¶é€ -->BMW523");
	}
}
```



å·¥å‚ç±»ï¼š 

```java
public class Factory {
	public BMW createBMW(int type) {
		switch (type) {
		
		case 320:
			return new BMW320();
 
		case 523:
			return new BMW523();
 
		default:
			break;
		}
		return null;
	}
}
```

å®¢æˆ·ç±»ï¼š 

```java
public class Customer {
	public static void main(String[] args) {
		Factory factory = new Factory();
		BMW bmw320 = factory.createBMW(320);
		BMW bmw523 = factory.createBMW(523);
	}
}
```



### 2.2 å·¥å‚æ–¹æ³•æ¨¡å¼

### intent

å®šä¹‰äº†ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„å·¥å‚æ¥å£ï¼Œå·¥å‚æ¥å®ä¾‹åŒ–å¯¹è±¡ï¼Œä½†ç”±å­ç±»å†³å®šè¦å®ä¾‹åŒ–å“ªä¸ªç±»ã€‚å·¥å‚æ–¹æ³•æŠŠå®ä¾‹åŒ–æ“ä½œæ¨è¿Ÿåˆ°å­ç±»ã€‚

ä¸ç®€å•å·¥å‚ä¸åŒï¼Œè¿™é‡Œç»™å·¥å‚å®šä¹‰äº†ä¸€ä¸ªæ¥å£ï¼Œå¹¶ä¸”å®šä¹‰äº†å¤šä¸ªä¸åŒå·¥å‚ï¼Œæ¯ä¸ªå·¥å‚è´Ÿè´£ä¸€æ¬¾äº§å“ã€‚



### Class Diagram



![](../assets/1.2.png)



### Implementation

 äº§å“ç±»ï¼š 

```java
abstract class BMW {
	public BMW(){
		
	}
}
```

```java
public class BMW320 extends BMW {
	public BMW320() {
		System.out.println("åˆ¶é€ -->BMW320");
	}
}
public class BMW523 extends BMW{
	public BMW523(){
		System.out.println("åˆ¶é€ -->BMW523");
	}
}
```

  

åˆ›å»ºå·¥å‚ç±»ï¼š 

```java
interface FactoryBMW {
	BMW createBMW();
}
```



```java
public class FactoryBMW320 implements FactoryBMW{
 
	@Override
	public BMW320 createBMW() {
 
		return new BMW320();
	}
 
}
public class FactoryBMW523 implements FactoryBMW {
	@Override
	public BMW523 createBMW() {
 
		return new BMW523();
	}
}
```

å®¢æˆ·ç±»ï¼š 

```java
public class Customer {
	public static void main(String[] args) {
		FactoryBMW320 factoryBMW320 = new FactoryBMW320();
		BMW320 bmw320 = factoryBMW320.createBMW();
 
		FactoryBMW523 factoryBMW523 = new FactoryBMW523();
		BMW523 bmw523 = factoryBMW523.createBMW();
	}
}
```



### 2.3 æŠ½è±¡å·¥å‚æ¨¡å¼ 

### intent

æŠ½è±¡å·¥å‚æ¨¡å¼åˆ›å»ºçš„æ˜¯å¯¹è±¡å®¶æ—ï¼Œä¹Ÿå°±æ˜¯å¾ˆå¤šå¯¹è±¡è€Œä¸æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸”è¿™äº›å¯¹è±¡æ˜¯ç›¸å…³çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¿…é¡»ä¸€èµ·åˆ›å»ºå‡ºæ¥ã€‚è€Œå·¥å‚æ–¹æ³•æ¨¡å¼åªæ˜¯ç”¨äºåˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œè¿™å’ŒæŠ½è±¡å·¥å‚æ¨¡å¼æœ‰å¾ˆå¤§ä¸åŒã€‚

ä½†æ˜¯åœ¨æ•´ä½“åˆ›å»ºæ¨¡å¼ä¸Šï¼Œç¬¦åˆå·¥å‚æ–¹æ³•æ¨¡å¼çš„å®šä¹‰ã€‚



### Class Diagram

![](../assets/1.3.png)

### Implementation

```java
public class AbstractProductA {
}
```

```java
public class AbstractProductB {
}
```

```java
public class ProductA1 extends AbstractProductA {
}
```

```java
public class ProductA2 extends AbstractProductA {
}
```

```java
public class ProductB1 extends AbstractProductB {
}
```

```java
public class ProductB2 extends AbstractProductB {
}
```

```java
public abstract class AbstractFactory {
    abstract AbstractProductA createProductA();
    abstract AbstractProductB createProductB();
}
```

```java
public class ConcreteFactory1 extends AbstractFactory {
    AbstractProductA createProductA() {
        return new ProductA1();
    }

    AbstractProductB createProductB() {
        return new ProductB1();
    }
}
```

```java
public class ConcreteFactory2 extends AbstractFactory {
    AbstractProductA createProductA() {
        return new ProductA2();
    }

    AbstractProductB createProductB() {
        return new ProductB2();
    }
}
```

```java
public class Client {
    public static void main(String[] args) {
        AbstractFactory abstractFactory = new ConcreteFactory1();
        AbstractProductA productA = abstractFactory.createProductA();
        AbstractProductB productB = abstractFactory.createProductB();
        // do something with productA and productB
    }
}
```

### JDK

- [javax.xml.parsers.DocumentBuilderFactory](http://docs.oracle.com/javase/8/docs/api/javax/xml/parsers/DocumentBuilderFactory.html)
- [javax.xml.transform.TransformerFactory](http://docs.oracle.com/javase/8/docs/api/javax/xml/transform/TransformerFactory.html#newInstance--)
- [javax.xml.xpath.XPathFactory](http://docs.oracle.com/javase/8/docs/api/javax/xml/xpath/XPathFactory.html#newInstance--)



# :christmas_tree: è¡Œä¸ºå‹

## 1 è§‚å¯Ÿè€…

### Intent

è§‚å¯Ÿè€…æ¨¡å¼å®šä¹‰äº†å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å°†å¾—åˆ°é€šçŸ¥ï¼Œå¹¶è‡ªåŠ¨æ›´æ–°ã€‚ 



### Class Diagram

ä¸»é¢˜ï¼ˆSubjectï¼‰å…·æœ‰æ³¨å†Œå’Œç§»é™¤è§‚å¯Ÿè€…ã€å¹¶é€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…çš„åŠŸèƒ½ï¼Œä¸»é¢˜æ˜¯é€šè¿‡ç»´æŠ¤ä¸€å¼ è§‚å¯Ÿè€…åˆ—è¡¨æ¥å®ç°è¿™äº›æ“ä½œçš„ã€‚

è§‚å¯Ÿè€…ï¼ˆObserverï¼‰çš„æ³¨å†ŒåŠŸèƒ½éœ€è¦è°ƒç”¨ä¸»é¢˜çš„ registerObserver() æ–¹æ³•ã€‚

![](../assets/1.13.png) </div><br>

### Implementation

å¤©æ°”æ•°æ®å¸ƒå‘Šæ¿ä¼šåœ¨å¤©æ°”ä¿¡æ¯å‘ç”Ÿæ”¹å˜æ—¶æ›´æ–°å…¶å†…å®¹ï¼Œå¸ƒå‘Šæ¿æœ‰å¤šä¸ªï¼Œå¹¶ä¸”åœ¨å°†æ¥ä¼šç»§ç»­å¢åŠ ã€‚

![](../assets/1.13.jpg)





```java
public interface Subject {
    void registerObserver(Observer o);

    void removeObserver(Observer o);

    void notifyObserver();
}
```

```java
public class WeatherData implements Subject {
    //è§‚å¯Ÿè€…
    private List<Observer> observers;
    private float temperature;
    private float humidity;
    private float pressure;

    public WeatherData() {
        observers = new ArrayList<>();
    }

    public void setMeasurements(float temperature, float humidity, float pressure) {
        this.temperature = temperature;
        this.humidity = humidity;
        this.pressure = pressure;
        notifyObserver();
    }

    @Override
    public void registerObserver(Observer o) {
        observers.add(o);
    }

    @Override
    public void removeObserver(Observer o) {
        int i = observers.indexOf(o);
        if (i >= 0) {
            observers.remove(i);
        }
    }

    //é€šçŸ¥è§‚å¯Ÿè€…æ‰€æœ‰çš„æ”¹å˜
    @Override
    public void notifyObserver() {
        for (Observer o : observers) {
            o.update(temperature, humidity, pressure);
        }
    }
}
```

```java
public interface Observer {
    void update(float temp, float humidity, float pressure);
}
```

```java
public class StatisticsDisplay implements Observer {

    public StatisticsDisplay(Subject weatherData) {
        weatherData.reisterObserver(this);
    }

    @Override
    public void update(float temp, float humidity, float pressure) {
        System.out.println("StatisticsDisplay.update: " + temp + " " + humidity + " " + pressure);
    }
}
```

```java
public class CurrentConditionsDisplay implements Observer {

    public CurrentConditionsDisplay(Subject weatherData) {
        weatherData.registerObserver(this);
    }

    @Override
    public void update(float temp, float humidity, float pressure) {
        System.out.println("CurrentConditionsDisplay.update: " + temp + " " + humidity + " " + pressure);
    }
}
```



æµ‹è¯•ï¼š

```java
public class WeatherStation {
    public static void main(String[] args) {
        WeatherData weatherData = new WeatherData();
        CurrentConditionsDisplay currentConditionsDisplay = new CurrentConditionsDisplay(weatherData);
        StatisticsDisplay statisticsDisplay = new StatisticsDisplay(weatherData);

        weatherData.setMeasurements(0, 0, 0);
        weatherData.setMeasurements(1, 1, 1);
    }
}
```



```html
CurrentConditionsDisplay.update: 0.0 0.0 0.0
StatisticsDisplay.update: 0.0 0.0 0.0
CurrentConditionsDisplay.update: 1.0 1.0 1.0
StatisticsDisplay.update: 1.0 1.0 1.0
```



### åº”ç”¨åœºæ™¯

è§‚å¯Ÿè€…æ¨¡å¼çš„ä¸€ä¸ªæ‰©å±•åº”ç”¨æ˜¯å‘å¸ƒè®¢é˜…æ¨¡å¼ã€‚

![](../assets/1.14.png)

**è§‚å¯Ÿè€…æ¨¡å¼ï¼š**è§‚å¯Ÿè€…ï¼ˆObserverï¼‰ç›´æ¥è®¢é˜…ï¼ˆSubscribeï¼‰ä¸»é¢˜ï¼ˆSubjectï¼‰ï¼Œè€Œå½“ä¸»é¢˜è¢«æ¿€æ´»çš„æ—¶å€™ï¼Œä¼šè§¦å‘ï¼ˆFire Eventï¼‰è§‚å¯Ÿè€…é‡Œçš„äº‹ä»¶ã€‚ 

**å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼š**è®¢é˜…è€…ï¼ˆSubscriberï¼‰æŠŠè‡ªå·±æƒ³è®¢é˜…çš„äº‹ä»¶æ³¨å†Œï¼ˆSubscribeï¼‰åˆ°è°ƒåº¦ä¸­å¿ƒï¼ˆTopicï¼‰ï¼Œå½“å‘å¸ƒè€…ï¼ˆPublisherï¼‰å‘å¸ƒè¯¥äº‹ä»¶ï¼ˆPublish  topicï¼‰åˆ°è°ƒåº¦ä¸­å¿ƒï¼Œä¹Ÿå°±æ˜¯è¯¥äº‹ä»¶è§¦å‘æ—¶ï¼Œç”±è°ƒåº¦ä¸­å¿ƒç»Ÿä¸€è°ƒåº¦ï¼ˆFire Eventï¼‰è®¢é˜…è€…æ³¨å†Œåˆ°è°ƒåº¦ä¸­å¿ƒçš„å¤„ç†ä»£ç ã€‚

åŒºåˆ«ï¼š

è§‚å¯Ÿè€…æ¨¡å¼å’Œå‘å¸ƒè®¢é˜…æ¨¡å¼æœ€å¤§çš„åŒºåˆ«å°±æ˜¯å‘å¸ƒè®¢é˜…æ¨¡å¼æœ‰ä¸ªäº‹ä»¶è°ƒåº¦ä¸­å¿ƒã€‚

è§‚å¯Ÿè€…æ¨¡å¼ç”±å…·ä½“ç›®æ ‡è°ƒåº¦ï¼Œæ¯ä¸ªè¢«è®¢é˜…çš„ç›®æ ‡é‡Œé¢éƒ½éœ€è¦æœ‰å¯¹è§‚å¯Ÿè€…çš„å¤„ç†ï¼Œè¿™ç§å¤„ç†æ–¹å¼æ¯”è¾ƒç›´æ¥ç²—æš´ï¼Œä½†æ˜¯ä¼šé€ æˆä»£ç çš„å†—ä½™ã€‚

è€Œå‘å¸ƒè®¢é˜…æ¨¡å¼ä¸­ç»Ÿä¸€ç”±è°ƒåº¦ä¸­å¿ƒè¿›è¡Œå¤„ç†ï¼Œè®¢é˜…è€…å’Œå‘å¸ƒè€…äº’ä¸å¹²æ‰°ï¼Œæ¶ˆé™¤äº†å‘å¸ƒè€…å’Œè®¢é˜…è€…ä¹‹é—´çš„ä¾èµ–ã€‚è¿™æ ·ä¸€æ–¹é¢å®ç°äº†è§£è€¦ï¼Œè¿˜æœ‰å°±æ˜¯å¯ä»¥å®ç°æ›´ç»†ç²’åº¦çš„ä¸€äº›æ§åˆ¶ã€‚æ¯”å¦‚å‘å¸ƒè€…å‘å¸ƒäº†å¾ˆå¤šæ¶ˆæ¯ï¼Œä½†æ˜¯ä¸æƒ³æ‰€æœ‰çš„è®¢é˜…è€…éƒ½æ¥æ”¶åˆ°ï¼Œå°±å¯ä»¥åœ¨è°ƒåº¦ä¸­å¿ƒåšä¸€äº›å¤„ç†ï¼Œç±»ä¼¼äºæƒé™æ§åˆ¶ä¹‹ç±»çš„ã€‚è¿˜å¯ä»¥åšä¸€äº›èŠ‚æµæ“ä½œã€‚



### JDK

- [java.util.Observer](http://docs.oracle.com/javase/8/docs/api/java/util/Observer.html)
- [java.util.EventListener](http://docs.oracle.com/javase/8/docs/api/java/util/EventListener.html)
- [javax.servlet.http.HttpSessionBindingListener](http://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpSessionBindingListener.html)
- [RxJava](https://github.com/ReactiveX/RxJava)



## 2 ç­–ç•¥

### Intent

 ç­–ç•¥æ¨¡å¼æ˜¯å¯¹ç®—æ³•çš„åŒ…è£…,æŠŠä½¿ç”¨ç®—æ³•çš„è´£ä»»å’Œç®—æ³•æœ¬èº«åˆ†éš”å¼€,å§”æ´¾ç»™ä¸åŒçš„å¯¹è±¡ç®¡ç†ã€‚ 

**æ ¹æ®ä¼ å…¥çš„å¯¹è±¡ç±»å‹ï¼Œå°±å¯ä»¥ç¡®å®šåœ¨ç®—æ³•åŒ…è£…ç±»ä¸­è°ƒç”¨å“ªä¸€ä¸ªç®—æ³•ã€‚æ‰€ä»¥å¦‚æœè¦å¢åŠ ä¸€ä¸ªæ–°çš„ç®—æ³•ï¼Œåªè¦è®©æ­¤ç±»å®ç°æŒ‡å®šæ¥å£å¹¶ä¸”å®ç°ç›¸åº”æ–¹æ³•å°±è¡Œäº†ã€‚**

### Class Diagram

- Strategy æ¥å£å®šä¹‰äº†ä¸€ä¸ªç®—æ³•æ—ï¼Œå®ƒä»¬éƒ½å®ç°äº†  behavior() æ–¹æ³•ã€‚
- Context æ˜¯ä½¿ç”¨åˆ°è¯¥ç®—æ³•æ—çš„ç±»ï¼Œå…¶ä¸­çš„ doSomething() æ–¹æ³•ä¼šè°ƒç”¨ behavior()ï¼ŒsetStrategy(Strategy) æ–¹æ³•å¯ä»¥åŠ¨æ€åœ°æ”¹å˜ strategy å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´èƒ½åŠ¨æ€åœ°æ”¹å˜ Context æ‰€ä½¿ç”¨çš„ç®—æ³•ã€‚

![](../assets/1.19.png)



ç­–ç•¥æ¨¡å¼ä¸»è¦æ˜¯ç”¨æ¥å°è£…ä¸€ç»„å¯ä»¥äº’ç›¸æ›¿ä»£çš„ç®—æ³•æ—ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®éœ€è¦åŠ¨æ€åœ°å»æ›¿æ¢ Context ä½¿ç”¨çš„ç®—æ³•ã€‚

### Implementation

è®¾è®¡ä¸€ä¸ªé¸­å­ï¼Œå®ƒå¯ä»¥åŠ¨æ€åœ°æ”¹å˜å«å£°ã€‚è¿™é‡Œçš„ç®—æ³•æ—æ˜¯é¸­å­çš„å«å£°è¡Œä¸ºã€‚

```java
public interface QuackBehavior {
    void quack();
}
```

```java
public class Quack implements QuackBehavior {
    @Override
    public void quack() {
        System.out.println("quack!");
    }
}
```

```java
public class Squeak implements QuackBehavior{
    @Override
    public void quack() {
        System.out.println("squeak!");
    }
}
```

```java
public class Duck {

    private QuackBehavior quackBehavior;

    public void performQuack() {
        if (quackBehavior != null) {
            quackBehavior.quack();
        }
    }

    public void setQuackBehavior(QuackBehavior quackBehavior) {
        this.quackBehavior = quackBehavior;
    }
}
```

```java
public class Client {

    public static void main(String[] args) {
        Duck duck = new Duck();
        duck.setQuackBehavior(new Squeak());
        duck.performQuack();
        duck.setQuackBehavior(new Quack());
        duck.performQuack();
    }
}
```

```html
squeak!
quack!
```

### JDK

- java.util.Comparator#compare()
- javax.servlet.http.HttpServlet
- javax.servlet.Filter#doFilter()



### åº”ç”¨åœºæ™¯

ç”µå•†ç½‘ç«™æ”¯ä»˜æ–¹å¼ï¼Œä¸€èˆ¬åˆ†ä¸ºé“¶è”ã€å¾®ä¿¡ã€æ”¯ä»˜å®ï¼Œå¯ä»¥é‡‡ç”¨ç­–ç•¥æ¨¡å¼ï¼Œä¸ºæ¯ä¸€ç§æ–¹å¼ï¼Œä½œä¸ºä¸€ç§æ”¯ä»˜æ–¹å¼çš„å®ç°ï¼Œå¦‚æœå“ªä¸€ä¸ªæ”¯ä»˜æ–¹å¼æ–¹å¼ï¼Œå‘ç”Ÿäº†å˜åŒ–ï¼Œåªè¦ä¿®æ”¹å¯¹åº”çš„å®ç°å³å¯ï¼Œä¸éœ€è¦ä¿®æ”¹è°ƒç”¨çš„å®¢æˆ·ç«¯

å¦‚æœå¼•å…¥æ–°çš„æ”¯ä»˜ï¼Œå¦‚ä¸‡é‡Œé€šæ”¯ä»˜ï¼Œå¢åŠ ä¸€ä¸ªå¯¹åº”çš„ä¸‡é‡Œé€šæ”¯ä»˜**å®ç°ç±»**ï¼Œéµå¾ªäº†å¼€é—­åŸåˆ™ã€‚



## 3 æ¨¡æ¿

### Intent

å®šä¹‰ç®—æ³•æ¡†æ¶ï¼Œå¹¶å°†ä¸€äº›æ­¥éª¤çš„å®ç°å»¶è¿Ÿåˆ°å­ç±»ï¼Œå¤ç”¨é‚£äº›ç›¸åŒæ­¥éª¤çš„ä»£ç ã€‚

é€šè¿‡æ¨¡æ¿æ–¹æ³•ï¼Œå­ç±»å¯ä»¥é‡æ–°å®šä¹‰ç®—æ³•çš„æŸäº›æ­¥éª¤ï¼Œè€Œä¸ç”¨æ”¹å˜ç®—æ³•çš„ç»“æ„ã€‚

### Class Diagram

![](../assets/1.20.png)

### Implementation

å†²å’–å•¡å’Œå†²èŒ¶éƒ½æœ‰ç±»ä¼¼çš„æµç¨‹ï¼Œä½†æ˜¯æŸäº›æ­¥éª¤ä¼šæœ‰ç‚¹ä¸ä¸€æ ·ï¼Œè¦æ±‚å¤ç”¨é‚£äº›ç›¸åŒæ­¥éª¤çš„ä»£ç ã€‚

![](../assets/1.21.png)

```java
public abstract class CaffeineBeverage {

    final void prepareRecipe() {
        boilWater();
        brew();
        pourInCup();
        addCondiments();
    }

    abstract void brew();

    abstract void addCondiments();

    void boilWater() {
        System.out.println("boilWater");
    }

    void pourInCup() {
        System.out.println("pourInCup");
    }
}
```

```java
public class Coffee extends CaffeineBeverage {
    @Override
    void brew() {
        System.out.println("Coffee.brew");
    }

    @Override
    void addCondiments() {
        System.out.println("Coffee.addCondiments");
    }
}
```

```java
public class Tea extends CaffeineBeverage {
    @Override
    void brew() {
        System.out.println("Tea.brew");
    }

    @Override
    void addCondiments() {
        System.out.println("Tea.addCondiments");
    }
}
```

```java
public class Client {
    public static void main(String[] args) {
        CaffeineBeverage caffeineBeverage = new Coffee();
        caffeineBeverage.prepareRecipe();
        System.out.println("-----------");
        caffeineBeverage = new Tea();
        caffeineBeverage.prepareRecipe();
    }
}
```

```html
boilWater
Coffee.brew
pourInCup
Coffee.addCondiments
-----------
boilWater
Tea.brew
pourInCup
Tea.addCondiments
```

### JDK

- java.util.Collections#sort()
- java.io.InputStream#skip()
- java.io.InputStream#read()
- java.util.AbstractList#indexOf()



### åº”ç”¨åœºæ™¯

AQSåœ¨å†…éƒ¨å®šä¹‰äº†é‡Šæ”¾é”å’Œè·å–é”çš„æ¨¡æ¿æ–¹æ³•ï¼Œå‘å¤–éƒ¨æä¾›äº†é’©å­å‡½æ•°ï¼Œå¯ä»¥é€šè¿‡setStateå’ŒgetStateç­‰æ”¹å˜stateï¼Œå­ç±»é€šè¿‡é‡å†™tryAcquireï¼ŒtryReleaseï¼ŒtryAcquireSharedï¼ŒtryReleaseSharedç­‰æ–¹æ³•å®ç°å…·ä½“çš„è·å–å’Œé‡Šæ”¾é”ä»£ç ã€‚ä¸éœ€è¦é©¬ä¸Šå®ç°çš„æ–¹æ³•ä¸€èˆ¬ä¼šå®šä¹‰ä¸ºæŠ½è±¡æ–¹æ³•ã€‚





# :mushroom: ç»“æ„å‹

## 1 é€‚é…å™¨ï¼ˆAdapterï¼‰

### Intent

æŠŠä¸€ä¸ªç±»çš„æ¥å£å˜æ¢æˆå®¢æˆ·ç«¯æ‰€æœŸå¾…çš„å¦ä¸€ç§æ¥å£ï¼Œä»è€Œä½¿åŸæœ¬å› æ¥å£åŸå› ä¸åŒ¹é…è€Œæ— æ³•ä¸€èµ·å·¥ä½œçš„ä¸¤ä¸ªç±»èƒ½å¤Ÿä¸€èµ·å·¥ä½œ 



### Class Diagram

![](../assets/1.25.png) 

**è§’è‰²ï¼š**

- ç›®æ ‡æ¥å£ï¼šTargetï¼Œè¯¥è§’è‰²æŠŠå…¶ä»–ç±»è½¬æ¢ä¸ºæˆ‘ä»¬æœŸæœ›çš„æ¥å£
- è¢«é€‚é…è€…: Adaptee åŸæœ‰çš„æ¥å£ï¼Œä¹Ÿæ˜¯å¸Œæœ›è¢«æ”¹å˜çš„æ¥å£
- **é€‚é…å™¨**ï¼š Adapter, å°†è¢«é€‚é…è€…å’Œç›®æ ‡æ¥å£ç»„åˆåˆ°ä¸€èµ·çš„ç±»

å°±æ˜¯å®šä¹‰äº†ä¸€ä¸ªé€‚é…å™¨ç»§æ‰¿ç›®æ ‡æ¥å£ï¼Œç„¶ååœ¨é€‚é…å™¨ä¸­è°ƒç”¨è¢«é€‚é…è€…çš„ä»£ç ã€‚



### Implementation

é¸­å­ï¼ˆDuckï¼‰å’Œç«é¸¡ï¼ˆTurkeyï¼‰æ‹¥æœ‰ä¸åŒçš„å«å£°ï¼ŒDuck çš„å«å£°è°ƒç”¨ quack() æ–¹æ³•ï¼Œè€Œ Turkey è°ƒç”¨ gobble() æ–¹æ³•ã€‚

è¦æ±‚å°† Turkey çš„ gobble() æ–¹æ³•é€‚é…æˆ Duck çš„ quack() æ–¹æ³•ï¼Œä»è€Œè®©ç«é¸¡å†’å……é¸­å­ï¼

```java
public interface Duck {
    void quack();
}
```

```java
public interface Turkey {
    void gobble();
}
```

```java
public class WildTurkey implements Turkey {
    @Override
    public void gobble() {
        System.out.println("gobble!");
    }
}
```

```java
public class TurkeyAdapter implements Duck {
    Turkey turkey;

    public TurkeyAdapter(Turkey turkey) {
        this.turkey = turkey;
    }

    @Override
    public void quack() {
        turkey.gobble();
    }
}
```

```java
public class Client {
    public static void main(String[] args) {
        Turkey turkey = new WildTurkey();
        Duck duck = new TurkeyAdapter(turkey);
        duck.quack();
    }
}
```

### JDK

- [java.util.Arrays#asList()](http://docs.oracle.com/javase/8/docs/api/java/util/Arrays.html#asList%28T...%29)
- [java.util.Collections#list()](https://docs.oracle.com/javase/8/docs/api/java/util/Collections.html#list-java.util.Enumeration-)
- [java.util.Collections#enumeration()](https://docs.oracle.com/javase/8/docs/api/java/util/Collections.html#enumeration-java.util.Collection-)
- [javax.xml.bind.annotation.adapters.XMLAdapter](http://docs.oracle.com/javase/8/docs/api/javax/xml/bind/annotation/adapters/XmlAdapter.html#marshal-BoundType-)



### åº”ç”¨åœºæ™¯

[åšå®¢ï¼Œå†™çš„è¶…çº§å¥½](https://www.imooc.com/article/15110)

é€‚é…å™¨æ¨¡å¼ä»**å®ç°æ–¹å¼**ä¸Šåˆ†ä¸ºä¸¤ç§ï¼Œ**ç±»é€‚é…å™¨å’Œå¯¹è±¡é€‚é…å™¨**ï¼Œè¿™ä¸¤ç§çš„åŒºåˆ«åœ¨äºå®ç°æ–¹å¼ä¸Šçš„ä¸åŒï¼Œä¸€ç§é‡‡ç”¨ç»§æ‰¿ï¼Œä¸€ç§é‡‡ç”¨ç»„åˆçš„æ–¹å¼ã€‚  

å¦å¤–ä»**ä½¿ç”¨ç›®çš„**ä¸Šæ¥è¯´ï¼Œä¹Ÿå¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼Œ**ç‰¹æ®Šé€‚é…å™¨å’Œç¼ºçœé€‚é…å™¨**ï¼Œä¸€ç§ä¸ºäº†å¤ç”¨åŸæœ‰çš„ä»£ç å¹¶é€‚é…å½“å‰çš„æ¥å£ï¼Œä¸€ç§ä¸ºäº†æä¾›ç¼ºçœçš„å®ç°ï¼Œé¿å…å­ç±»éœ€è¦å®ç°ä¸è¯¥å®ç°çš„æ–¹æ³•ã€‚ 



##### 1.ç‰¹æ®Šé€‚é…å™¨

> æƒ³ä½¿ç”¨ä¸€ä¸ªå·²å­˜åœ¨çš„ç±»ï¼Œä½†æ˜¯è¯¥ç±»ä¸ç¬¦åˆæ¥å£éœ€æ±‚,ä¸ºäº†å¤ç”¨åŸæœ‰çš„ä»£ç å¹¶é€‚é…å½“å‰çš„æ¥å£

ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œæ¯”å¦‚è§‚å¯Ÿè€…æ¨¡å¼çš„ä¸€ä¸ªç¼ºç‚¹ï¼Œå³å¦‚æœä¸€ä¸ªç°æœ‰çš„ç±»æ²¡æœ‰å®ç°Observeræ¥å£ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ— æ³•å°†è¿™ä¸ªç±»ä½œä¸ºè§‚å¯Ÿè€…åŠ å…¥åˆ°è¢«è§‚å¯Ÿè€…çš„è§‚å¯Ÿè€…åˆ—è¡¨ä¸­äº†ã€‚
æ¯”å¦‚æˆ‘ä»¬å¸Œæœ›å°†HashMapè¿™ä¸ªç±»åŠ åˆ°è§‚å¯Ÿè€…åˆ—è¡¨é‡Œï¼Œåœ¨è¢«è§‚å¯Ÿè€…äº§ç”Ÿå˜åŒ–æ—¶ï¼Œæˆ‘ä»¬è¦æ¸…ç©ºæ•´ä¸ªMAPã€‚ä½†æ˜¯ç°åœ¨åŠ ä¸è¿›å»ï¼Œå› ä¸ºObservableçš„è§‚å¯Ÿè€…åˆ—è¡¨åªè®¤è¯†Observerè¿™ä¸ªæ¥å£ï¼Œå®ƒä¸è®¤è¯†HashMapã€‚
è¿™ç§æƒ…å†µä¸‹å°±å¯ä»¥ä½¿ç”¨ç±»é€‚é…å™¨çš„æ–¹å¼ï¼š

```java
public class HashMapObserverAdapter<K, V> extends HashMap<K, V> implements Observer{

    public void update(Observable o, Object arg) {
        //è¢«è§‚å¯Ÿè€…å˜åŒ–æ—¶ï¼Œæ¸…ç©ºMap
        super.clear();
    }
}
```

 ç°åœ¨ç»§æ‰¿äº†æˆ‘ä»¬å¸Œæœ›å¤ç”¨å…¶åŠŸèƒ½çš„ç±»ï¼ˆå³HashMapï¼‰ï¼Œå¹¶ä¸”å®ç°äº†æƒ³é€‚é…çš„æ¥å£ï¼ˆå³Observerï¼‰ï¼Œæ‰€ä»¥è¿™ä¸ªé€‚é…å™¨ç°åœ¨å¯ä»¥åŠ å…¥åˆ°è§‚å¯Ÿè€…åˆ—è¡¨äº†ã€‚

 

##### 2.ç¼ºçœé€‚é…å™¨

> ä¸€ç§ä¸ºäº†æä¾›ç¼ºçœçš„å®ç°ï¼Œé¿å…å­ç±»éœ€è¦å®ç°ä¸è¯¥å®ç°çš„æ–¹æ³•ã€‚ 

ç¼ºçœé€‚é…å™¨æ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œä»…ä»…implementsè€Œä¸å®ç°ã€‚ç„¶åå®¢æˆ·ç«¯ç›´æ¥ä½¿ç”¨Adapterå³å¯é€‰æ‹©éœ€è¦å®ç°çš„æ–¹æ³•ï¼Œè€Œä¸ç”¨å®ç°å…¨éƒ¨ã€‚ 

```java
public abstract class DefaultJobAdapter implements Job {

    @Override
    public void programmer() {

    }

    @Override
    public void teacher() {

    }

}
```


```java
public abstract class DefaultJobAdapter implements Job {

    @Override
    public void programmer() {

    }

    @Override
    public void teacher() {

    }
}
```



```java
package com.design.adapter.defaultadapter;

public class Client {

    public static void main(String[] args){
        People people = new People();

        people.addJob(new DefaultJobAdapter() {
            @Override
            public void programmer() {
                System.out.println("å†™ä»£ç ï¼Œä¸äº§å“æ’•é€¼");
            }
        });
    }

}

class People{

    public void addJob(Job job){

    }
}
```



##### 3.å¯¹è±¡é€‚é…å™¨

> å¯¹è±¡é€‚é…å™¨æ˜¯é‡‡ç”¨ç»„åˆçš„æ–¹å¼å®ç°ï¼Œå› ä¸ºJAVAå•ç»§æ‰¿çš„åŸå› ï¼Œä¸€ä¸ªJAVAç±»åªèƒ½æœ‰ä¸€ä¸ªçˆ¶ç±»ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬è¦é€‚é…çš„å¯¹è±¡æ˜¯ä¸¤ä¸ªç±»çš„æ—¶å€™ï¼Œç±»é€‚é…å™¨æ˜¯ä¸èƒ½è§£å†³é—®é¢˜çš„ã€‚

è¿˜æ˜¯ä»¥è§‚å¯Ÿè€…æ¨¡å¼çš„é—®é¢˜ä¸ºä¾‹ï¼Œæ¯”å¦‚ç°åœ¨æœ‰ä¸€ä¸ªå†™å¥½çš„å®ä½“ç±»ï¼Œå¦‚ä¸‹ï¼š

```java
public class User extends BaseEntity{
    private Integer id;
    private String name;
    ...
}
```

 

é€‚é…ï¼š

```java
public class ObservableNx extends Observable {

        /*åŸå› åŒä¸Š*/
    @Override
    protected synchronized void clearChanged() {
        super.clearChanged();
    }

    @Override
    protected synchronized void setChanged() {
        super.setChanged();
    }
}
```

 

```java
//æˆ‘ä»¬æ‰©å±•BaseEntity,é€‚é…å‡ºæ¥ä¸€ä¸ªå¯è§‚å¯Ÿçš„å®ä½“åŸºç±»
public class BaseObservableEntity extends BaseEntity{

    private ObservableNx observable = new ObservableNx();

    public synchronized void addObserver(Observer o) {
        observable.addObserver(o);
    }

    public synchronized void deleteObserver(Observer o) {
        observable.deleteObserver(o);
    }

    public void notifyObservers() {
        observable.notifyObservers();
    }

    public void notifyObservers(Object arg) {
        observable.notifyObservers(arg);
    }

    public synchronized void deleteObservers() {
        observable.deleteObservers();
    }

    protected synchronized void setChanged() {
        observable.setChanged();
    }

    protected synchronized void clearChanged() {
        observable.clearChanged();
    }

    public synchronized boolean hasChanged() {
        return observable.hasChanged();
    }

    public synchronized int countObservers() {
        return observable.countObservers();
    }

}


```

 

 

 



 

 



 

 

 

 

 

 

 





## 2 è£…é¥°/åŒ…è£…ï¼ˆDecoratorï¼‰

### Intent

ä¸ºå¯¹è±¡åŠ¨æ€æ·»åŠ åŠŸèƒ½ã€‚

### Class Diagram

è£…é¥°æ¨¡å¼æŒ‡çš„æ˜¯åœ¨ä¸å¿…æ”¹å˜åŸç±»æ–‡ä»¶å’Œä½¿ç”¨ç»§æ‰¿çš„æƒ…å†µä¸‹ï¼ŒåŠ¨æ€åœ°æ‰©å±•ä¸€ä¸ªå¯¹è±¡çš„åŠŸèƒ½ã€‚å®ƒæ˜¯é€šè¿‡åˆ›å»ºä¸€ä¸ªåŒ…è£…å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è£…é¥°æ¥åŒ…è£¹çœŸå®çš„å¯¹è±¡ã€‚ 

![](../assets/1.32.png)

### Implementation

è®¾è®¡ä¸åŒç§ç±»çš„é¥®æ–™ï¼Œé¥®æ–™å¯ä»¥æ·»åŠ é…æ–™ï¼Œæ¯”å¦‚å¯ä»¥æ·»åŠ ç‰›å¥¶ï¼Œå¹¶ä¸”æ”¯æŒåŠ¨æ€æ·»åŠ æ–°é…æ–™ã€‚æ¯å¢åŠ ä¸€ç§é…æ–™ï¼Œè¯¥é¥®æ–™çš„ä»·æ ¼å°±ä¼šå¢åŠ ï¼Œè¦æ±‚è®¡ç®—ä¸€ç§é¥®æ–™çš„ä»·æ ¼ã€‚

ä¸‹å›¾è¡¨ç¤ºåœ¨ DarkRoast é¥®æ–™ä¸Šæ–°å¢æ–°æ·»åŠ  Mocha é…æ–™ï¼Œä¹‹ååˆæ·»åŠ äº† Whip é…æ–™ã€‚DarkRoast è¢« Mocha åŒ…è£¹ï¼ŒMocha åˆè¢« Whip åŒ…è£¹ã€‚å®ƒä»¬éƒ½ç»§æ‰¿è‡ªç›¸åŒçˆ¶ç±»ï¼Œéƒ½æœ‰ cost() æ–¹æ³•ï¼Œå¤–å±‚ç±»çš„ cost() æ–¹æ³•è°ƒç”¨äº†å†…å±‚ç±»çš„ cost() æ–¹æ³•ã€‚

<div align="center"> <img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/c9cfd600-bc91-4f3a-9f99-b42f88a5bb24.jpg" width="600"/> </div><br>

```java
public interface Beverage {
    double cost();
}
```

```java
public class DarkRoast implements Beverage {
    @Override
    public double cost() {
        return 1;
    }
}
```

```java
public class HouseBlend implements Beverage {
    @Override
    public double cost() {
        return 1;
    }
}
```

```java
public abstract class CondimentDecorator implements Beverage {
    protected Beverage beverage;
}
```

```java
public class Milk extends CondimentDecorator {

    public Milk(Beverage beverage) {
        this.beverage = beverage;
    }

    @Override
    public double cost() {
        return 1 + beverage.cost();
    }
}
```

```java
public class Mocha extends CondimentDecorator {

    public Mocha(Beverage beverage) {
        this.beverage = beverage;
    }

    @Override
    public double cost() {
        return 1 + beverage.cost();
    }
}
```

```java
public class Client {

    public static void main(String[] args) {
        Beverage beverage = new HouseBlend();
        beverage = new Mocha(beverage);
        beverage = new Milk(beverage);
        System.out.println(beverage.cost());
    }
}
```

```html
3.0
```

### è®¾è®¡åŸåˆ™

ç±»åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ï¼šä¹Ÿå°±æ˜¯æ·»åŠ æ–°åŠŸèƒ½æ—¶ä¸éœ€è¦ä¿®æ”¹ä»£ç ã€‚é¥®æ–™å¯ä»¥åŠ¨æ€æ·»åŠ æ–°çš„é…æ–™ï¼Œè€Œä¸éœ€è¦å»ä¿®æ”¹é¥®æ–™çš„ä»£ç ã€‚

ä¸å¯èƒ½æŠŠæ‰€æœ‰çš„ç±»è®¾è®¡æˆéƒ½æ»¡è¶³è¿™ä¸€åŸåˆ™ï¼Œåº”å½“æŠŠè¯¥åŸåˆ™åº”ç”¨äºæœ€æœ‰å¯èƒ½å‘ç”Ÿæ”¹å˜çš„åœ°æ–¹ã€‚





### JDK

- java.io.BufferedInputStream(InputStream)   //æ‹¬å·é‡Œçš„æ˜¯è£…é¥°ç±»ï¼ŒBufferedInputStream æ˜¯è¢«è£…é¥°è€…
- java.io.DataInputStream(InputStream)
- java.io.BufferedOutputStream(OutputStream)
- java.util.zip.ZipOutputStream(OutputStream)
- java.util.Collections#checked[List|Map|Set|SortedSet|SortedMap]()



### åº”ç”¨åœºæ™¯

è£…é¥°æ¨¡å¼åœ¨JDKä¸­æœ€ç»å…¸çš„å®ä¾‹æ˜¯Java IOã€‚



![](../assets/1.33.png)

ä»¥BufferInputStreamä¸¾ä¾‹ï¼ŒBufferedInputStreamå°±æ˜¯ä¸€ä¸ªè£…é¥°è€…ï¼Œå®ƒèƒ½ä¸ºä¸€ä¸ªåŸæœ¬æ²¡æœ‰ç¼“å†²åŠŸèƒ½çš„InputStreamæ·»åŠ ä¸Šç¼“å†²çš„åŠŸèƒ½ã€‚ 

```java
BufferedInputStream bis = new BufferedInputStream(new FileInputStream(new File("/home/user/abc.txt")));
```



InputStreamæ˜¯ä¸ªæŠ½è±¡åŸºç±»:

```java
public abstract class InputStream implements Closeable {
    
    public abstract int read() throws IOException;
    ...
    ...
}
```



å…¶ä¸­æœ‰ä¸€ä¸ªå­ç±»å’Œå…¶ä»–ç±»éƒ½ä¸åŒï¼š**FilterInputStream** 

å®ƒå†…éƒ¨åˆç»´æŠ¤äº†ä¸€ä¸ªInputStreamçš„æˆå‘˜å¯¹è±¡ï¼Œå¹¶ä¸”å®ƒçš„æ‰€æœ‰æ–¹æ³•ï¼Œéƒ½æ˜¯è°ƒç”¨è¿™ä¸ªæˆå‘˜å¯¹è±¡çš„åŒåæ–¹æ³•ã€‚ 

```java
public class FilterInputStream extends InputStream {
    protected volatile InputStream in;
    
    protected FilterInputStream(InputStream in) {
        this.in = in;
    }
    
    public int read() throws IOException {
        return in.read();
    }
    
    public int read(byte b[]) throws IOException {
        return read(b, 0, b.length);
    }
    
    public int read(byte b[], int off, int len) throws IOException {
        return in.read(b, off, len);
    }
    
    public long skip(long n) throws IOException {
        return in.skip(n);
    }
    
    public int available() throws IOException {
        return in.available();
    }
    
    public void close() throws IOException {
        in.close();
    }
    
    public synchronized void mark(int readlimit) {
        in.mark(readlimit);
    }

    public synchronized void reset() throws IOException {
        in.reset();
    }
    
    public boolean markSupported() {
        return in.markSupported();
    }
```



è€Œä»¥FilterInputStream çš„å­ç±»BufferedInputStream ä¸ºä¾‹ï¼šæä¾›äº†ç‹¬æœ‰çš„ç¼“å†²åŠŸèƒ½

```java
  public synchronized int read() throws IOException {
        if (pos >= count) {
            fill();
            if (pos >= count)
                return -1;
        }
        return getBufIfOpen()[pos++] & 0xff;
    }
```







## 3 ä»£ç†ï¼ˆProxyï¼‰

### Intent

[æ¨èåšå®¢](https://segmentfault.com/a/1190000019433930?utm_source=tag-newest)

åœ¨ç›´æ¥è®¿é—®å¯¹è±¡æ—¶å¸¦æ¥çš„é—®é¢˜ï¼Œæ¯”å¦‚è¯´ï¼šè¦è®¿é—®çš„å¯¹è±¡åœ¨è¿œç¨‹çš„æœºå™¨ä¸Šã€‚åœ¨é¢å‘å¯¹è±¡ç³»ç»Ÿä¸­ï¼Œæœ‰äº›å¯¹è±¡ç”±äºæŸäº›åŸå› ï¼ˆæ¯”å¦‚å¯¹è±¡åˆ›å»ºå¼€é”€å¾ˆå¤§ï¼Œæˆ–è€…æŸäº›æ“ä½œéœ€è¦å®‰å…¨æ§åˆ¶ï¼Œæˆ–è€…éœ€è¦è¿›ç¨‹å¤–çš„è®¿é—®ï¼‰ï¼Œç›´æ¥è®¿é—®ä¼šç»™ä½¿ç”¨è€…æˆ–è€…ç³»ç»Ÿç»“æ„å¸¦æ¥å¾ˆå¤šéº»çƒ¦ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è®¿é—®æ­¤å¯¹è±¡æ—¶åŠ ä¸Šä¸€ä¸ªå¯¹æ­¤å¯¹è±¡çš„è®¿é—®å±‚ã€‚ 



### Class Diagram

ä»£ç†æœ‰ä»¥ä¸‹å››ç±»ï¼š

- è¿œç¨‹ä»£ç†ï¼ˆRemote Proxyï¼‰ï¼šæ§åˆ¶å¯¹è¿œç¨‹å¯¹è±¡ï¼ˆä¸åŒåœ°å€ç©ºé—´ï¼‰çš„è®¿é—®ï¼Œå®ƒè´Ÿè´£å°†è¯·æ±‚åŠå…¶å‚æ•°è¿›è¡Œç¼–ç ï¼Œå¹¶å‘ä¸åŒåœ°å€ç©ºé—´ä¸­çš„å¯¹è±¡å‘é€å·²ç»ç¼–ç çš„è¯·æ±‚ã€‚
- è™šæ‹Ÿä»£ç†ï¼ˆVirtual Proxyï¼‰ï¼šæ ¹æ®éœ€è¦åˆ›å»ºå¼€é”€å¾ˆå¤§çš„å¯¹è±¡ï¼Œå®ƒå¯ä»¥ç¼“å­˜å®ä½“çš„é™„åŠ ä¿¡æ¯ï¼Œä»¥ä¾¿å»¶è¿Ÿå¯¹å®ƒçš„è®¿é—®ï¼Œä¾‹å¦‚åœ¨ç½‘ç«™åŠ è½½ä¸€ä¸ªå¾ˆå¤§å›¾ç‰‡æ—¶ï¼Œä¸èƒ½é©¬ä¸Šå®Œæˆï¼Œå¯ä»¥ç”¨è™šæ‹Ÿä»£ç†ç¼“å­˜å›¾ç‰‡çš„å¤§å°ä¿¡æ¯ï¼Œç„¶åç”Ÿæˆä¸€å¼ ä¸´æ—¶å›¾ç‰‡ä»£æ›¿åŸå§‹å›¾ç‰‡ã€‚
- ä¿æŠ¤ä»£ç†ï¼ˆProtection Proxyï¼‰ï¼šæŒ‰æƒé™æ§åˆ¶å¯¹è±¡çš„è®¿é—®ï¼Œå®ƒè´Ÿè´£æ£€æŸ¥è°ƒç”¨è€…æ˜¯å¦å…·æœ‰å®ç°ä¸€ä¸ªè¯·æ±‚æ‰€å¿…é¡»çš„è®¿é—®æƒé™ã€‚
- æ™ºèƒ½ä»£ç†ï¼ˆSmart Referenceï¼‰ï¼šå–ä»£äº†ç®€å•çš„æŒ‡é’ˆï¼Œå®ƒåœ¨è®¿é—®å¯¹è±¡æ—¶æ‰§è¡Œä¸€äº›é™„åŠ æ“ä½œï¼šè®°å½•å¯¹è±¡çš„å¼•ç”¨æ¬¡æ•°ï¼›å½“ç¬¬ä¸€æ¬¡å¼•ç”¨ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå°†å®ƒè£…å…¥å†…å­˜ï¼›åœ¨è®¿é—®ä¸€ä¸ªå®é™…å¯¹è±¡å‰ï¼Œæ£€æŸ¥æ˜¯å¦å·²ç»é”å®šäº†å®ƒï¼Œä»¥ç¡®ä¿å…¶å®ƒå¯¹è±¡ä¸èƒ½æ”¹å˜å®ƒã€‚



è§’è‰²è¯´æ˜ï¼š

* Subjectï¼šå®šä¹‰äº†RealSubjectå’ŒProxyçš„å…±ç”¨æ¥å£ï¼Œè¿™æ ·å°±åœ¨ä»»ä½•ä½¿ç”¨RealSubjectçš„åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨Porxy
* RealSubjectï¼šå®šä¹‰äº†Proxyæ‰€ä»£è¡¨çš„çš„çœŸå®å®ä½“
* Proxyï¼šä¿å­˜ä¸€ä¸ªå¼•ç”¨ä½¿å¾—ä»£ç†å¯ä»¥è®¿é—®å®ä½“ï¼Œå¹¶æä¾›ä¸€ä¸ªä¸Subjectçš„æ¥å£ç›¸åŒçš„æ¥å£ï¼Œè¿™æ ·ä»£ç†å°±å¯ä»¥ç”¨æ¥æ›¿ä»£å®ä½“



![](../assets/1.38.png)

### Implementation

ä»¥ä¸‹æ˜¯ä¸€ä¸ªè™šæ‹Ÿä»£ç†çš„å®ç°ï¼Œæ¨¡æ‹Ÿäº†å›¾ç‰‡å»¶è¿ŸåŠ è½½çš„æƒ…å†µä¸‹ä½¿ç”¨ä¸å›¾ç‰‡å¤§å°ç›¸ç­‰çš„ä¸´æ—¶å†…å®¹å»æ›¿æ¢åŸå§‹å›¾ç‰‡ï¼Œç›´åˆ°å›¾ç‰‡åŠ è½½å®Œæˆæ‰å°†å›¾ç‰‡æ˜¾ç¤ºå‡ºæ¥ã€‚

```java
public interface Image {
    void showImage();
}
```

```java
public class HighResolutionImage implements Image {

    private URL imageURL;
    private long startTime;
    private int height;
    private int width;

    public int getHeight() {
        return height;
    }

    public int getWidth() {
        return width;
    }

    public HighResolutionImage(URL imageURL) {
        this.imageURL = imageURL;
        this.startTime = System.currentTimeMillis();
        this.width = 600;
        this.height = 600;
    }

    public boolean isLoad() {
        // æ¨¡æ‹Ÿå›¾ç‰‡åŠ è½½ï¼Œå»¶è¿Ÿ 3s åŠ è½½å®Œæˆ
        long endTime = System.currentTimeMillis();
        return endTime - startTime > 3000;
    }

    @Override
    public void showImage() {
        System.out.println("Real Image: " + imageURL);
    }
}
```

```java
public class ImageProxy implements Image {

    private HighResolutionImage highResolutionImage;

    public ImageProxy(HighResolutionImage highResolutionImage) {
        this.highResolutionImage = highResolutionImage;
    }

    @Override
    public void showImage() {
        while (!highResolutionImage.isLoad()) {
            try {
                System.out.println("Temp Image: " + highResolutionImage.getWidth() + " " + highResolutionImage.getHeight());
                Thread.sleep(100);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
        highResolutionImage.showImage();
    }
}
```

```java
public class ImageViewer {

    public static void main(String[] args) throws Exception {
        String image = "http://image.jpg";
        URL url = new URL(image);
        HighResolutionImage highResolutionImage = new HighResolutionImage(url);
        ImageProxy imageProxy = new ImageProxy(highResolutionImage);
        imageProxy.showImage();
    }
}
```

### JDK

- java.lang.reflect.Proxy
- RMI
- Spring AOP



### åº”ç”¨åœºæ™¯

